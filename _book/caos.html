<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 5 Casos prácticos | Visualización y geolocalización de datos</title>
  <meta name="description" content="Máster en Data Science &amp; Business Analytics (con R Software)" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 5 Casos prácticos | Visualización y geolocalización de datos" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://mdsr-2122-visualizacion.netlify.app/" />
  
  <meta property="og:description" content="Máster en Data Science &amp; Business Analytics (con R Software)" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 5 Casos prácticos | Visualización y geolocalización de datos" />
  
  <meta name="twitter:description" content="Máster en Data Science &amp; Business Analytics (con R Software)" />
  

<meta name="author" content="Diego Hernangómez" />
<meta name="author" content="Gema Fernández-Avilés" />


<meta name="date" content="2022-02-03" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dep-esp.html"/>
<link rel="next" href="referencias.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Visualización y geolocalización de datos</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prólogo</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#por-qué-leer-este-libro"><i class="fa fa-check"></i>¿Por qué leer este libro?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#objetivos-de-aprendizaje"><i class="fa fa-check"></i>Objetivos de aprendizaje</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#estructura-del-libro"><i class="fa fa-check"></i>Estructura del libro</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#datos"><i class="fa fa-check"></i>Datos</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="la-revolución-de-los-geodatos.html"><a href="la-revolución-de-los-geodatos.html"><i class="fa fa-check"></i><b>1</b> La revolución de los geodatos</a></li>
<li class="chapter" data-level="2" data-path="datos-geográficos.html"><a href="datos-geográficos.html"><i class="fa fa-check"></i><b>2</b> Datos geográficos</a>
<ul>
<li class="chapter" data-level="2.1" data-path="datos-geográficos.html"><a href="datos-geográficos.html#contexto-general"><i class="fa fa-check"></i><b>2.1</b> Contexto general</a></li>
<li class="chapter" data-level="2.2" data-path="datos-geográficos.html"><a href="datos-geográficos.html#conceptos-clave"><i class="fa fa-check"></i><b>2.2</b> Conceptos clave</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="formatos.html"><a href="formatos.html"><i class="fa fa-check"></i><b>3</b> Formatos de datos espaciales</a>
<ul>
<li class="chapter" data-level="3.1" data-path="formatos.html"><a href="formatos.html#ficheros-de-datos-espaciales"><i class="fa fa-check"></i><b>3.1</b> Ficheros de datos espaciales</a></li>
<li class="chapter" data-level="3.2" data-path="formatos.html"><a href="formatos.html#modelo-de-datos"><i class="fa fa-check"></i><b>3.2</b> Modelo de datos</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="formatos.html"><a href="formatos.html#vec"><i class="fa fa-check"></i><b>3.2.1</b> Datos de vectores</a></li>
<li class="chapter" data-level="3.2.2" data-path="formatos.html"><a href="formatos.html#raster"><i class="fa fa-check"></i><b>3.2.2</b> Datos ráster</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="formatos.html"><a href="formatos.html#CRS"><i class="fa fa-check"></i><b>3.3</b> Sistema de Referencia de Coordenadas (CRS)</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="formatos.html"><a href="formatos.html#tipos-de-crs"><i class="fa fa-check"></i><b>3.3.1</b> Tipos de CRS</a></li>
<li class="chapter" data-level="3.3.2" data-path="formatos.html"><a href="formatos.html#trabajando-con-proyecciones-en-r"><i class="fa fa-check"></i><b>3.3.2</b> Trabajando con proyecciones en R</a></li>
<li class="chapter" data-level="3.3.3" data-path="formatos.html"><a href="formatos.html#quecrsuso"><i class="fa fa-check"></i><b>3.3.3</b> ¿Qué proyección uso?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dep-esp.html"><a href="dep-esp.html"><i class="fa fa-check"></i><b>4</b> Estadística espacial</a>
<ul>
<li class="chapter" data-level="4.1" data-path="dep-esp.html"><a href="dep-esp.html#antes-de-continuar-dependencia-espacial."><i class="fa fa-check"></i><b>4.1</b> Antes de continuar… dependencia espacial.</a></li>
<li class="chapter" data-level="4.2" data-path="dep-esp.html"><a href="dep-esp.html#datos-espaciales"><i class="fa fa-check"></i><b>4.2</b> Datos espaciales</a></li>
<li class="chapter" data-level="4.3" data-path="dep-esp.html"><a href="dep-esp.html#clasificación-de-datos-espaciales"><i class="fa fa-check"></i><b>4.3</b> Clasificación de datos espaciales</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="caos.html"><a href="caos.html"><i class="fa fa-check"></i><b>5</b> Casos prácticos</a>
<ul>
<li class="chapter" data-level="5.1" data-path="caos.html"><a href="caos.html#caso-1-temperatura-mínimas-del-aire-en-españa."><i class="fa fa-check"></i><b>5.1</b> Caso 1: Temperatura mínimas del aire en España.</a></li>
<li class="chapter" data-level="5.2" data-path="caos.html"><a href="caos.html#caso-2.-distribución-espacial-de-la-renta-media-por-municipios"><i class="fa fa-check"></i><b>5.2</b> Caso 2. Distribución espacial de la renta media por municipios</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="referencias.html"><a href="referencias.html"><i class="fa fa-check"></i>Referencias</a></li>
<li class="appendix"><span><b>Anexo</b></span></li>
<li class="chapter" data-level="A" data-path="crsproy.html"><a href="crsproy.html"><i class="fa fa-check"></i><b>A</b> Tipos de CRS proyectados</a>
<ul>
<li class="chapter" data-level="A.1" data-path="crsproy.html"><a href="crsproy.html#por-tipo-de-superficie-de-proyección"><i class="fa fa-check"></i><b>A.1</b> Por tipo de superficie de proyección</a></li>
<li class="chapter" data-level="A.2" data-path="crsproy.html"><a href="crsproy.html#por-métrica-a-preservar"><i class="fa fa-check"></i><b>A.2</b> Por métrica a preservar</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="./">Máster en Data Science & Business Analytics (con R Software)</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Visualización y geolocalización de datos</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="caos" class="section level1" number="5">
<h1><span class="header-section-number">Capítulo 5</span> Casos prácticos</h1>
<div class="infobox">
<p><strong>NOTA</strong></p>
<p>En las siguientes aplicaciones se asumen que los datos se localizan en la
carpeta <code>data</code> del proyecto de R-Studio en el que se esté trabajando.</p>
<p>Los datos pueden descargarse desde esta dirección:</p>
<p><a href="https://github.com/mdsr-espacial/datos/raw/main/01_visualizacion/datos.zip" class="uri">https://github.com/mdsr-espacial/datos/raw/main/01_visualizacion/datos.zip</a></p>
</div>
<div id="caso-1-temperatura-mínimas-del-aire-en-españa." class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Caso 1: Temperatura mínimas del aire en España.</h2>
<p><strong>Objetivo de aprendizaje</strong></p>
<p>Esta sección presenta un caso de uso en el que aprenderemos a realizar las
siguientes tareas básicas:</p>
<ol style="list-style-type: decimal">
<li><p>Leer datos espaciales en R.</p></li>
<li><p>Proyectar datos espaciales.</p></li>
<li><p>Graficar datos espaciales.</p></li>
</ol>
<p>Para ello, se va a trabajar con los datos de temperatura mínima registradas en
España por las estaciones metereológicas de la Agencia Estatal de Meteorología
(AEMET). Un conjuto de datos ya depurados y listos par trabajar se encuentra en
el fichero <code>tempmin.csv</code>. Por otra parte, la información relativa al mapeo de
España se obtendrá directamente de la librería <code>mapSpain</code>. Todo el análisis se
va a realizar empleando RStudio, por lo que se empezará abriendo el programa y
creando un nuevo proyecto.</p>
<div class="exercise">
<p><span id="exr:ex-crea" class="exercise"><strong>Ejercicio 5.1  (Creación del proyecto) </strong></span>Cree un proyecto para trabajar todo lo referente al caso.</p>
</div>
<div class="solution">
<p><span id="sol-crea" class="solution"><em>Solución</em>. </span>Para crear un proyecto siga la secuencia: <em>File&gt; New Proyect&gt; New File&gt; RMD</em></p>
</div>
<p>El conjunto de datos proporcionado <code>tempmin.csv</code> contiene el nivel de
temperatura del aire en España entre el 6 y el 10 de Enero de
2021<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. Estos datos han sido descargados usando la librería
<strong>climaemet</strong> <span class="citation">(<a href="#ref-R-climaemet" role="doc-biblioref">Pizarro, Hernangómez, and Fernández-Avilés 2021</a>)</span> y han sido posteriormente tratados para su uso en
esta práctica.</p>
<p>A continuación es necesario importar la base de datos de temperatura mínima. El
archivo está en formato csv, por lo cual, es un fichero de texto plano. Se
pueden usar varias funciones para realizar la importación. Se emplearán los
paquetes del <strong>tidyverse</strong> <span class="citation">(<a href="#ref-R-tidyverse" role="doc-biblioref">Wickham et al. 2019</a>)</span> para realizar todo el tratamiento de
datos.</p>
<div class="exercise">
<p><span id="exr:ex2" class="exercise"><strong>Ejercicio 5.2  (Importación de los datos) </strong></span>Importe los datos <code>tempmin.csv</code> y guárdelos en un objeto llamado <code>tmin</code>.</p>
</div>
<div class="solution">
<p><span id="sol2" class="solution"><em>Solución</em>. </span>Use la librería <strong>readr</strong>.</p>
</div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="caos.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cada uno debe seleccionar el directorio donde tiene los datos, de ahí</span></span>
<span id="cb22-2"><a href="caos.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co"># que sea conveniente trabajar con proyectos.</span></span>
<span id="cb22-3"><a href="caos.html#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb22-4"><a href="caos.html#cb22-4" aria-hidden="true" tabindex="-1"></a>tmin <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/tempmin.csv&quot;</span>)</span></code></pre></div>
<p>El conjunto de datos <code>tempmin</code> es un data frame que contiene 5 variables:</p>
<ul>
<li><p><code>fecha</code>: Indicando la fecha de observación.</p></li>
<li><p><code>indicativo</code>: Es el identificador de la estación de la AEMET que registró el
dato.</p></li>
<li><p><code>tmin</code>: Dato de temperatura mínima registrada en cada fecha por la estación
correspondiente en grados centígrados.</p></li>
<li><p><code>longitud, latitud</code>: Coordenadas geográficas de la estación</p></li>
</ul>
<div class="exercise">
<p><span id="exr:ex3" class="exercise"><strong>Ejercicio 5.3  (Descripción de los datos) </strong></span>Con la función <code>head()</code> describa, en forma de tabla, la información que contiene
el objeto <code>tmin</code> y compruebe que se corresponde con la descrita.</p>
</div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="caos.html#cb23-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(tmin), <span class="at">caption =</span> <span class="st">&quot;Detalle del objeto tmin&quot;</span>)</span></code></pre></div>
<table>
<caption><span id="tab:tmin-head">Tabla 5.1: </span>Detalle del objeto tmin</caption>
<thead>
<tr class="header">
<th align="left">fecha</th>
<th align="left">indicativo</th>
<th align="right">tmin</th>
<th align="right">longitud</th>
<th align="right">latitud</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2021-01-06</td>
<td align="left">4358X</td>
<td align="right">-4.7</td>
<td align="right">-5.880556</td>
<td align="right">38.95556</td>
</tr>
<tr class="even">
<td align="left">2021-01-06</td>
<td align="left">4220X</td>
<td align="right">-7.0</td>
<td align="right">-4.616389</td>
<td align="right">39.08861</td>
</tr>
<tr class="odd">
<td align="left">2021-01-06</td>
<td align="left">6106X</td>
<td align="right">4.7</td>
<td align="right">-4.748333</td>
<td align="right">37.02944</td>
</tr>
<tr class="even">
<td align="left">2021-01-06</td>
<td align="left">9698U</td>
<td align="right">-6.8</td>
<td align="right">0.865278</td>
<td align="right">42.20528</td>
</tr>
<tr class="odd">
<td align="left">2021-01-06</td>
<td align="left">4410X</td>
<td align="right">-3.4</td>
<td align="right">-6.385556</td>
<td align="right">38.91583</td>
</tr>
<tr class="even">
<td align="left">2021-01-06</td>
<td align="left">1331A</td>
<td align="right">1.0</td>
<td align="right">-7.031389</td>
<td align="right">43.52472</td>
</tr>
</tbody>
</table>
<p>Una de las clases de objetos espaciales más utilzada en R es <code>sf</code>. Sin embargo,
dependiendo del análisis que se quiera realizar hay otras muy comunes como
<code>geodata</code>, <code>spatastat</code>, etc..</p>
<p>A continuación se convertirá el objeto <code>tmin</code> (<code>data.frame</code>) a un objeto de la
clase <code>geodata</code>, una clase muy utilizada para trabajar con datos espaciales y
requerida por la librería <code>geoR</code> <span class="citation">(<a href="#ref-R-geor" role="doc-biblioref">Ribeiro Jr et al. 2020</a>)</span>. Estos objetos contienen las
coordenadas y la variable objeto de estudio. Para mayor detalle ver
<code>??as.geodata</code>. Obsérvese como varía la variable a través de los ejes longitud y
latitud. Observe tambien la forma campaniforme de la distribución de la
variable.</p>
<div class="exercise">
<p><span id="exr:ex4" class="exercise"><strong>Ejercicio 5.4  (Descripción de los datos) </strong></span>Del objeto <code>tmin</code> seleccione el día <strong>8 de enero de 2022</strong> y las variables
<code>longitud</code>, <code>latitud</code> y <code>tmin</code> para crear el objeto y llámelo <code>tmin_geoR</code>. A
continuación describa analítica y gráficamente dicho objeto.</p>
</div>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="caos.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb24-2"><a href="caos.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geoR)</span>
<span id="cb24-3"><a href="caos.html#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="caos.html#cb24-4" aria-hidden="true" tabindex="-1"></a>tmin_geoR <span class="ot">&lt;-</span> tmin <span class="sc">%&gt;%</span></span>
<span id="cb24-5"><a href="caos.html#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fecha <span class="sc">==</span> <span class="st">&quot;2021-01-08&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-6"><a href="caos.html#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Seleccionamos las columnas de interés</span></span>
<span id="cb24-7"><a href="caos.html#cb24-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(longitud, latitud, tmin) <span class="sc">%&gt;%</span></span>
<span id="cb24-8"><a href="caos.html#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Y creamos el objeto geodata</span></span>
<span id="cb24-9"><a href="caos.html#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.geodata</span>(</span>
<span id="cb24-10"><a href="caos.html#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">coords.col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb24-11"><a href="caos.html#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data.col =</span> <span class="dv">3</span></span>
<span id="cb24-12"><a href="caos.html#cb24-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-13"><a href="caos.html#cb24-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-14"><a href="caos.html#cb24-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-15"><a href="caos.html#cb24-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tmin_geoR)</span>
<span id="cb24-16"><a href="caos.html#cb24-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of data points: 211 </span></span>
<span id="cb24-17"><a href="caos.html#cb24-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb24-18"><a href="caos.html#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Coordinates summary</span></span>
<span id="cb24-19"><a href="caos.html#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      longitud  latitud</span></span>
<span id="cb24-20"><a href="caos.html#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; min -9.291389 35.27639</span></span>
<span id="cb24-21"><a href="caos.html#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; max  4.215556 43.78611</span></span>
<span id="cb24-22"><a href="caos.html#cb24-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb24-23"><a href="caos.html#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Distance summary</span></span>
<span id="cb24-24"><a href="caos.html#cb24-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         min         max </span></span>
<span id="cb24-25"><a href="caos.html#cb24-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  0.01024389 13.85144264 </span></span>
<span id="cb24-26"><a href="caos.html#cb24-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb24-27"><a href="caos.html#cb24-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Data summary</span></span>
<span id="cb24-28"><a href="caos.html#cb24-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        Min.     1st Qu.      Median        Mean     3rd Qu.        Max. </span></span>
<span id="cb24-29"><a href="caos.html#cb24-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; -14.9000000  -4.6000000  -0.5000000  -0.6293839   3.5000000  13.6000000</span></span>
<span id="cb24-30"><a href="caos.html#cb24-30" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tmin_geoR)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-10"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/unnamed-chunk-10-1.png" alt="Convertir `data.frame` a `geodata`" width="60%" />
<p class="caption">
Figura 5.1: Convertir <code>data.frame</code> a <code>geodata</code>
</p>
</div>
<p>En esta ocasión, convertiremos los datos de <code>tmin</code> en un objeto espacial <code>sf</code>,
es decir, datos espaciales de tipo vector.</p>
<p>Los datos de <code>tmin</code> contienen coordenadas geográficas longitud/latitud, así que
como se vió en la Sección <a href="formatos.html#CRS">3.3</a> el CRS a emplear ha de ser un CRS
geográfico. Usaremos el código <strong>EPSG:4326</strong>, que corresponde a coordenadas
geográficas y suele ser el habitual en este tipo de situaciones.</p>
<div class="exercise">
<p><span id="exr:ex5" class="exercise"><strong>Ejercicio 5.5  (Convertir data.frame a sf) </strong></span>Del objeto <code>tmin</code> seleccione las variables <code>longitud</code>, <code>latitud</code> y <code>tmin</code> para
crear el objeto sf y llámelo <code>tmin_sf</code>. A continuación describa el objeto
creado.</p>
</div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="caos.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb25-2"><a href="caos.html#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="caos.html#cb25-3" aria-hidden="true" tabindex="-1"></a>tmin_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(tmin,</span>
<span id="cb25-4"><a href="caos.html#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;longitud&quot;</span>, <span class="st">&quot;latitud&quot;</span>),</span>
<span id="cb25-5"><a href="caos.html#cb25-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">crs =</span> <span class="dv">4326</span></span>
<span id="cb25-6"><a href="caos.html#cb25-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb25-7"><a href="caos.html#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="caos.html#cb25-8" aria-hidden="true" tabindex="-1"></a>tmin_sf</span>
<span id="cb25-9"><a href="caos.html#cb25-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 1066 features and 3 fields</span></span>
<span id="cb25-10"><a href="caos.html#cb25-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: POINT</span></span>
<span id="cb25-11"><a href="caos.html#cb25-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb25-12"><a href="caos.html#cb25-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -9.291389 ymin: 35.27639 xmax: 4.215556 ymax: 43.78611</span></span>
<span id="cb25-13"><a href="caos.html#cb25-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb25-14"><a href="caos.html#cb25-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1,066 x 4</span></span>
<span id="cb25-15"><a href="caos.html#cb25-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    fecha      indicativo  tmin             geometry</span></span>
<span id="cb25-16"><a href="caos.html#cb25-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  * &lt;date&gt;     &lt;chr&gt;      &lt;dbl&gt;          &lt;POINT [°]&gt;</span></span>
<span id="cb25-17"><a href="caos.html#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 2021-01-06 4358X       -4.7 (-5.880556 38.95556)</span></span>
<span id="cb25-18"><a href="caos.html#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 2021-01-06 4220X       -7   (-4.616389 39.08861)</span></span>
<span id="cb25-19"><a href="caos.html#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 2021-01-06 6106X        4.7 (-4.748333 37.02944)</span></span>
<span id="cb25-20"><a href="caos.html#cb25-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 2021-01-06 9698U       -6.8  (0.865278 42.20528)</span></span>
<span id="cb25-21"><a href="caos.html#cb25-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 2021-01-06 4410X       -3.4 (-6.385556 38.91583)</span></span>
<span id="cb25-22"><a href="caos.html#cb25-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 2021-01-06 1331A        1   (-7.031389 43.52472)</span></span>
<span id="cb25-23"><a href="caos.html#cb25-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 2021-01-06 1690A       -0.1 (-7.859722 42.32528)</span></span>
<span id="cb25-24"><a href="caos.html#cb25-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 2021-01-06 8489X       -8   (-0.255833 40.43333)</span></span>
<span id="cb25-25"><a href="caos.html#cb25-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 2021-01-06 8025         2    (-0.494167 38.3725)</span></span>
<span id="cb25-26"><a href="caos.html#cb25-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 2021-01-06 9784P      -10       (0.224722 42.63)</span></span>
<span id="cb25-27"><a href="caos.html#cb25-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ... with 1,056 more rows</span></span></code></pre></div>
<p>La siguiente tarea será representar las estaciones que monitorizan la
temperatura mínima en un mapa de España.</p>
<div class="exercise">
<p><span id="exr:ex6" class="exercise"><strong>Ejercicio 5.6  (Reprsentación espacial de la clase sf) </strong></span>Represente un mapa de España, con las Comunidades Autónomas de incluidas,
excepto las Islas Canarias (por simplicidad)</p>
</div>
<div class="solution">
<p><span id="sol6" class="solution"><em>Solución</em>. </span>Una opción es utilizar un paquete API que nos proporciona esta información en
formato <code>sf</code>, el paquete <strong>mapSpain</strong>.</p>
</div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="caos.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapSpain)</span>
<span id="cb26-2"><a href="caos.html#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sf object</span></span>
<span id="cb26-3"><a href="caos.html#cb26-3" aria-hidden="true" tabindex="-1"></a>esp <span class="ot">&lt;-</span> <span class="fu">esp_get_ccaa</span>() <span class="sc">%&gt;%</span></span>
<span id="cb26-4"><a href="caos.html#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># No vamos a usar Canarias en este análisis</span></span>
<span id="cb26-5"><a href="caos.html#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ine.ccaa.name <span class="sc">!=</span> <span class="st">&quot;Canarias&quot;</span>)</span>
<span id="cb26-6"><a href="caos.html#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="caos.html#cb26-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-8"><a href="caos.html#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(esp<span class="sc">$</span>geometry) <span class="co"># Dibujamos el mapa de España menos las Islas Canarias</span></span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-12"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/unnamed-chunk-12-1.png" alt="Mapa de España (Sin Canarias)" width="60%" />
<p class="caption">
Figura 5.2: Mapa de España (Sin Canarias)
</p>
</div>
<p>Como se comentó en la Sección <a href="formatos.html#CRS">3.3</a>, cuando se emplean datos geográficos
provenientes de varias fuentes, es necesario asegurarse de que ambos objetos
están usando el mismo CRS.</p>
<div class="exercise">
<p><span id="exr:ex7" class="exercise"><strong>Ejercicio 5.7  (CRS) </strong></span>¿Tengo el Sistema de referencia de coordenadas (CRS) de las estaciones de
monitoreo en la misma proyección que el contorno de España? Compruebelo.</p>
</div>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="caos.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(tmin_sf) <span class="sc">==</span> <span class="fu">st_crs</span>(esp)</span>
<span id="cb27-2"><a href="caos.html#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>Se ha comprobado que no lo están, por lo que hay que proyectar las coordenadas a
un CRS común.</p>
<div class="exercise">
<p><span id="exr:ex8" class="exercise"><strong>Ejercicio 5.8  (CRS) </strong></span>Proyecte las coordenadas de los objetos <code>tmin_sf</code> y <code>esp</code> al CRS de referencia
de <code>tmin_sf</code>. Compruébelo.</p>
</div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="caos.html#cb28-1" aria-hidden="true" tabindex="-1"></a>esp2 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(esp, <span class="fu">st_crs</span>(tmin_sf))</span>
<span id="cb28-2"><a href="caos.html#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="caos.html#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(tmin_sf) <span class="sc">==</span> <span class="fu">st_crs</span>(esp2)</span>
<span id="cb28-4"><a href="caos.html#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Para dibujar las estaciones de monitoreo con el contorno de España, existen
varias opciones de paquetes, <strong>ggplot2</strong> <span class="citation">(<a href="#ref-R-ggplot" role="doc-biblioref">Wickham 2016</a>)</span> (paquete de referencia en
representaciones gráficas), <strong>tmap</strong> <span class="citation">(<a href="#ref-R-tmap" role="doc-biblioref">Tennekes 2018</a>)</span> o <strong>mapsf</strong> <span class="citation">(<a href="#ref-R-mapsf" role="doc-biblioref">Giraud 2022</a>)</span> (estos dos
últimos especializados en mapas temáticos).</p>
<div class="exercise">
<p><span id="exr:ex9" class="exercise"><strong>Ejercicio 5.9  (CRS) </strong></span>Represente, con el paquete <strong>ggplot2</strong>, las estaciones de monitorero de AEMET en
la Península Ibérica.</p>
</div>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="caos.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb29-2"><a href="caos.html#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="caos.html#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(esp2) <span class="sc">+</span></span>
<span id="cb29-4"><a href="caos.html#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Para graficar objetos sf debemos usar geom_sf()</span></span>
<span id="cb29-5"><a href="caos.html#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb29-6"><a href="caos.html#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> tmin_sf) <span class="sc">+</span></span>
<span id="cb29-7"><a href="caos.html#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb29-8"><a href="caos.html#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb29-9"><a href="caos.html#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb29-10"><a href="caos.html#cb29-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">12</span>,</span>
<span id="cb29-11"><a href="caos.html#cb29-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">&quot;bold&quot;</span></span>
<span id="cb29-12"><a href="caos.html#cb29-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb29-13"><a href="caos.html#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(</span>
<span id="cb29-14"><a href="caos.html#cb29-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">8</span>,</span>
<span id="cb29-15"><a href="caos.html#cb29-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">&quot;italic&quot;</span></span>
<span id="cb29-16"><a href="caos.html#cb29-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-17"><a href="caos.html#cb29-17" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-14"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/unnamed-chunk-14-1.png" alt="Estaciones de AEMET en la Península Ibérica" width="60%" />
<p class="caption">
Figura 5.3: Estaciones de AEMET en la Península Ibérica
</p>
</div>
<p>Una vez represtadas las coordenadas, es decir, las estaciones de monitoreo dónde
se ha medido la variable temperatura mínima <code>tmin</code>, el siguiente paso será
representar el valor que toma la variable en esas coodenadas. La base <code>tmin</code>
contiene información temporal para para varios días, por lo que, como este
análisis es meramente espacial se elegirá un día que se fijará para todo el
análisis.</p>
<div class="exercise">
<p><span id="exr:ex10" class="exercise"><strong>Ejercicio 5.10  (plot-sp1) </strong></span>Representamos la variable temperatura mínima <code>tmin</code> para el día <strong>8 de enero de
2021</strong>. Guarde la base de datos espacial para ese día en un objeto de nombre
<code>tmin_8enero</code>.</p>
</div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="caos.html#cb30-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-2"><a href="caos.html#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleccionaremos los datos correspondientes al 8 de enero de 2021</span></span>
<span id="cb30-3"><a href="caos.html#cb30-3" aria-hidden="true" tabindex="-1"></a>tmin_8enero <span class="ot">&lt;-</span> tmin_sf <span class="sc">%&gt;%</span></span>
<span id="cb30-4"><a href="caos.html#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fecha <span class="sc">==</span> <span class="st">&quot;2021-01-08&quot;</span>)</span>
<span id="cb30-5"><a href="caos.html#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="caos.html#cb30-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-7"><a href="caos.html#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapa temático en el que se representan los valores de temperatura mínima</span></span>
<span id="cb30-8"><a href="caos.html#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="co"># registrados en cada estación mediante un código de colores</span></span>
<span id="cb30-9"><a href="caos.html#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tmin_8enero[<span class="st">&quot;tmin&quot;</span>],</span>
<span id="cb30-10"><a href="caos.html#cb30-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">8</span></span>
<span id="cb30-11"><a href="caos.html#cb30-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:plot-base-tmin"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/plot-base-tmin-1.png" alt="Mapa de puntos con temperatura mínima (8-enero-2021)" width="60%" />
<p class="caption">
Figura 5.4: Mapa de puntos con temperatura mínima (8-enero-2021)
</p>
</div>
<p>El mapa ha quedado muy bien, pero quizá los colores y el formato elegido no sean
los más adecuados para este tipo de representaciones…</p>
<div class="exercise">
<p><span id="exr:unlabeled-div-1" class="exercise"><strong>Ejercicio 5.11  (plot-sp2) </strong></span>Utilice los parámetros espaciales de los que dispone, las coordenadas y el
contorno de España para graficar y contar la historia de <strong>Filomena</strong>
adecuadamente.</p>
</div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:spatial-plots"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/spatial-plots-1.png" alt="Mapa completo con temperatura mínima (8-enero-2021)" width="60%" />
<p class="caption">
Figura 5.5: Mapa completo con temperatura mínima (8-enero-2021)
</p>
</div>
<p>La visión que ofrece el la Fig. <a href="caos.html#fig:spatial-plots">5.5</a> de Filomena es muy
informativa, vemos como los datos nos cuentan la historia de lo que ocurrió ese
día. La pena es que no existan estaciones de monitoreo en todos los puntos de
España para conocer el valor de la temperatura mínima en cualquier lugar del
país. ¿Podríamos tener un mapa de interpolación para tener una estimación de la
temperatura mínima en las partes donde la AEMET no tiene estación de monitoreo?</p>
<p>Tal y como se avanzó en el Capítulo <a href="dep-esp.html#dep-esp">4</a>, parece lógico pensar que
aquellos puntos que estén cerca tendrán valores similares. Por tanto, tomemos
ventaja de las propiedades de la dependencia espacial y utilicemos un método de
interpolación sencillo, en este caso un método determinista, la Distancia
Inversa Ponderada, comúnmente conocido por su acrónimo inglés IDW (Inverse
distance weighted), el cual es uno de los métodos más simples para llevar para
llevar a cabo una interpolación espacial.</p>
<p>En este tipo de análisis espacial, es crucial que el CRS sea el apropiado. En
este caso, ya se definió el CRS como un CRS geográfico (es decir, usando
coordenadas de longitud y latitud). Sin embargo, para el ejercicio de
interpolación es más adecuado usar un CRS local (que provoca pocas deformaciones
en la proyección de España) y en alguna unidad de distancia, como metros (ya se
vio en la Sección <a href="formatos.html#CRS">3.3</a> que en los CRS geográficos las unidades son
grados).</p>
<div class="exercise">
<p><span id="exr:ex11" class="exercise"><strong>Ejercicio 5.12  (Obtención de CRS sugerido para un conjuto de datos) </strong></span>Utilice el paquete <strong>crsuggest</strong> para observar los CRS sugeridos y, si es
necesario, transforme la proyección de los datos.</p>
</div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="caos.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(crsuggest)</span>
<span id="cb31-2"><a href="caos.html#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="caos.html#cb31-3" aria-hidden="true" tabindex="-1"></a>sugiere <span class="ot">&lt;-</span> <span class="fu">suggest_crs</span>(tmin_8enero, <span class="at">units =</span> <span class="st">&quot;m&quot;</span>, <span class="at">limit =</span> <span class="dv">5</span>)</span>
<span id="cb31-4"><a href="caos.html#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="caos.html#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Usamos la sugerencia del paquete</span></span>
<span id="cb31-6"><a href="caos.html#cb31-6" aria-hidden="true" tabindex="-1"></a>crs_sugerido <span class="ot">&lt;-</span> <span class="fu">st_crs</span>(sugiere[<span class="dv">1</span>, ]<span class="sc">$</span>crs_proj4) <span class="co"># Madrid</span></span>
<span id="cb31-7"><a href="caos.html#cb31-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-8"><a href="caos.html#cb31-8" aria-hidden="true" tabindex="-1"></a>esp3 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(esp2, crs_sugerido)</span>
<span id="cb31-9"><a href="caos.html#cb31-9" aria-hidden="true" tabindex="-1"></a>tmin_8enero3 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(tmin_8enero, crs_sugerido)</span></code></pre></div>
<p>Una vez solucionado el problema de las proyecciones, antes de llevar a cabo la
interpolación, es necesario generar una malla que representará las celdas de las
que queremos obtener el valor interpolado. Dado que hemos proyectado nuestros
datos a un CRS cuya unidad son los metros, podemos definir el tamaño de cada
celda en metros cuadrados. En este caso vamos a usar celdas de 100 kms cuadrados
(10 x 10 kms).</p>
<div class="exercise">
<p><span id="exr:ex12" class="exercise"><strong>Ejercicio 5.13  (Creación y representación de una malla de interpolación) </strong></span>Genere un grid y llámelo <code>malla_sf</code> (puede fijar una semilla si lo desea) y
grafíque la superficie construida.</p>
</div>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="caos.html#cb32-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-2"><a href="caos.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Generación de la superficie a interpolar</span></span>
<span id="cb32-3"><a href="caos.html#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">9876</span>) <span class="co"># Aseguramos que el grid generado siempre es igual</span></span>
<span id="cb32-4"><a href="caos.html#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="caos.html#cb32-5" aria-hidden="true" tabindex="-1"></a>malla_sf <span class="ot">&lt;-</span> <span class="fu">st_make_grid</span>(</span>
<span id="cb32-6"><a href="caos.html#cb32-6" aria-hidden="true" tabindex="-1"></a>  esp3,</span>
<span id="cb32-7"><a href="caos.html#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cellsize =</span> <span class="dv">10000</span></span>
<span id="cb32-8"><a href="caos.html#cb32-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-9"><a href="caos.html#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="caos.html#cb32-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Representación de la superficie construida añadiendo el contorno de España</span></span>
<span id="cb32-11"><a href="caos.html#cb32-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(esp3) <span class="sc">+</span></span>
<span id="cb32-12"><a href="caos.html#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb32-13"><a href="caos.html#cb32-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb32-14"><a href="caos.html#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> malla_sf,</span>
<span id="cb32-15"><a href="caos.html#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.1</span>,</span>
<span id="cb32-16"><a href="caos.html#cb32-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb32-17"><a href="caos.html#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="cn">NA</span></span>
<span id="cb32-18"><a href="caos.html#cb32-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb32-19"><a href="caos.html#cb32-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb32-20"><a href="caos.html#cb32-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> tmin_8enero3,</span>
<span id="cb32-21"><a href="caos.html#cb32-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> <span class="st">&quot;AEMET Stations&quot;</span>), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb32-22"><a href="caos.html#cb32-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;blue&quot;</span></span>
<span id="cb32-23"><a href="caos.html#cb32-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb32-24"><a href="caos.html#cb32-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">adjustcolor</span>(<span class="st">&quot;blue&quot;</span>, <span class="at">alpha.f =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb32-25"><a href="caos.html#cb32-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb32-26"><a href="caos.html#cb32-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:create-grid2"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/create-grid2-1.png" alt="Malla de puntos para interpolación" width="60%" />
<p class="caption">
Figura 5.6: Malla de puntos para interpolación
</p>
</div>
<p>Se puede observar claramente cada una de las celdas que se han creado. La
interpolación asignará un valor a cada uno de ellas.</p>
<p>A continuación podemos llevar a cabo la interpolación usando el paquete
<strong>gstat</strong> <span class="citation">(<a href="#ref-R-gstat" role="doc-biblioref">Pebesma 2004</a>)</span>. Además, en lugar de celdas (polígonos) es necesario usar
puntos en la interpolación. Calcularemos, por tanto, un punto representativo de
cada celda creada en la superficie anterior <code>malla_sf</code>, el centroide, que es el
punto resultante de realizar la media arimética de las coordenadas de los puntos
que componen los lados de cada celda.</p>
<div class="exercise">
<p><span id="exr:ex13" class="exercise"><strong>Ejercicio 5.14  (Interpolación a través de la Distancia Inversa Ponderada) </strong></span>Calcule los centroides de los polígonos de la malla construida en el Ejercicio
<a href="caos.html#exr:ex12">5.13</a> con la función <code>st_centroid()</code> y realice una interpolación de la
variable temperatura mínima <code>tmin</code> para el día 8 de enero de 2021 con el método
IDW usando la librería <strong>gstat</strong> y la función <code>idw</code>. Guarde el resultado
obtenido en un objeto llamado <code>tmin_idw</code>. Utilice la función <code>help(idw)</code> si
requiere información sobre cómo introducir los parámetros en la función.</p>
<p>Examine la información del objeto <code>tmin_idw</code>, a través de la función <code>head()</code>,</p>
</div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="caos.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculamos una malla con centroides</span></span>
<span id="cb33-2"><a href="caos.html#cb33-2" aria-hidden="true" tabindex="-1"></a>malla_sf_cent <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(malla_sf, <span class="at">of_largest_polygon =</span> <span class="cn">TRUE</span>)</span>
<span id="cb33-3"><a href="caos.html#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="caos.html#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gstat)</span>
<span id="cb33-5"><a href="caos.html#cb33-5" aria-hidden="true" tabindex="-1"></a>tmin_idw <span class="ot">&lt;-</span> <span class="fu">idw</span>(</span>
<span id="cb33-6"><a href="caos.html#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Indicamos la variable que queremos interpolar</span></span>
<span id="cb33-7"><a href="caos.html#cb33-7" aria-hidden="true" tabindex="-1"></a>  tmin <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb33-8"><a href="caos.html#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Indicamos el conjunto de datos donde está la variable</span></span>
<span id="cb33-9"><a href="caos.html#cb33-9" aria-hidden="true" tabindex="-1"></a>  tmin_8enero3,</span>
<span id="cb33-10"><a href="caos.html#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Indicamos la malla de destino, en sf</span></span>
<span id="cb33-11"><a href="caos.html#cb33-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> malla_sf_cent,</span>
<span id="cb33-12"><a href="caos.html#cb33-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">idp =</span> <span class="fl">2.0</span> <span class="co"># Especifica la potencia de la IDW</span></span>
<span id="cb33-13"><a href="caos.html#cb33-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-14"><a href="caos.html#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [inverse distance weighted interpolation]</span></span>
<span id="cb33-15"><a href="caos.html#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tmin_idw)</span>
<span id="cb33-16"><a href="caos.html#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 6 features and 2 fields</span></span>
<span id="cb33-17"><a href="caos.html#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: POINT</span></span>
<span id="cb33-18"><a href="caos.html#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb33-19"><a href="caos.html#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: 147290.9 ymin: 70457.31 xmax: 197290.9 ymax: 70457.31</span></span>
<span id="cb33-20"><a href="caos.html#cb33-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; CRS:           +proj=lcc +lat_1=40 +lat_0=40 +lon_0=0 +k_0=0.9988085293 +x_0=600000 +y_0=600000 +a=6378298.3 +rf=294.73 +pm=madrid +units=m +no_defs</span></span>
<span id="cb33-21"><a href="caos.html#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   var1.pred var1.var                  geometry</span></span>
<span id="cb33-22"><a href="caos.html#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  2.529082       NA POINT (147290.9 70457.31)</span></span>
<span id="cb33-23"><a href="caos.html#cb33-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  2.615255       NA POINT (157290.9 70457.31)</span></span>
<span id="cb33-24"><a href="caos.html#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  2.703976       NA POINT (167290.9 70457.31)</span></span>
<span id="cb33-25"><a href="caos.html#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  2.795295       NA POINT (177290.9 70457.31)</span></span>
<span id="cb33-26"><a href="caos.html#cb33-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5  2.889262       NA POINT (187290.9 70457.31)</span></span>
<span id="cb33-27"><a href="caos.html#cb33-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6  2.985925       NA POINT (197290.9 70457.31)</span></span></code></pre></div>
<p>Un tipo de mapas muy utilizado cuando se trabaja con datos espaciales son los
mapas de contorno. Es muy visual y ayuda a interpretar el mapa interpolado,
añadir unas lineas de contorno al mapa interpolado.</p>
<div class="exercise">
<p><span id="exr:ex14" class="exercise"><strong>Ejercicio 5.15  (Mapa de interpolación y contorno con raster) </strong></span>Represente los valores interpolados, <code>tmin_idw</code>, y añada unas lineas de
contorno. Utilice el paquete <strong>raster</strong> para convertir el objeto interpolado a
pixeles.</p>
</div>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="caos.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertimos de sf a SpatiaPixels</span></span>
<span id="cb34-2"><a href="caos.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Esto funciona porque nuestros puntos sf están espaciados regularmente</span></span>
<span id="cb34-3"><a href="caos.html#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="caos.html#cb34-4" aria-hidden="true" tabindex="-1"></a>tmin_pixels <span class="ot">&lt;-</span> tmin_idw <span class="sc">%&gt;%</span></span>
<span id="cb34-5"><a href="caos.html#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as</span>(<span class="st">&quot;Spatial&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="caos.html#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as</span>(<span class="st">&quot;SpatialPixels&quot;</span>)</span>
<span id="cb34-7"><a href="caos.html#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="caos.html#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="caos.html#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb34-10"><a href="caos.html#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos un raster de nuestros pixels</span></span>
<span id="cb34-11"><a href="caos.html#cb34-11" aria-hidden="true" tabindex="-1"></a>rast_esp <span class="ot">&lt;-</span> <span class="fu">raster</span>(tmin_pixels)</span>
<span id="cb34-12"><a href="caos.html#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="caos.html#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Transferimos valores del objeto sf al raster</span></span>
<span id="cb34-14"><a href="caos.html#cb34-14" aria-hidden="true" tabindex="-1"></a>rast_esp2 <span class="ot">&lt;-</span> <span class="fu">rasterize</span>(</span>
<span id="cb34-15"><a href="caos.html#cb34-15" aria-hidden="true" tabindex="-1"></a>  tmin_idw,</span>
<span id="cb34-16"><a href="caos.html#cb34-16" aria-hidden="true" tabindex="-1"></a>  rast_esp,</span>
<span id="cb34-17"><a href="caos.html#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">field =</span> <span class="st">&quot;var1.pred&quot;</span>, <span class="do">## valores de predicción idw</span></span>
<span id="cb34-18"><a href="caos.html#cb34-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun =</span> mean</span>
<span id="cb34-19"><a href="caos.html#cb34-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-20"><a href="caos.html#cb34-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-21"><a href="caos.html#cb34-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Además, podemos recortar el raster a la forma de España</span></span>
<span id="cb34-22"><a href="caos.html#cb34-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-23"><a href="caos.html#cb34-23" aria-hidden="true" tabindex="-1"></a>rast_esp_mask <span class="ot">&lt;-</span> <span class="fu">mask</span>(rast_esp2, esp3)</span>
<span id="cb34-24"><a href="caos.html#cb34-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-25"><a href="caos.html#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rast_esp_mask, <span class="at">col =</span> colores)</span>
<span id="cb34-26"><a href="caos.html#cb34-26" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(rast_esp2, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-17"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/unnamed-chunk-17-1.png" alt="Mapa raster con lineas de nivel" width="60%" />
<p class="caption">
Figura 5.7: Mapa raster con lineas de nivel
</p>
</div>
<div class="exercise">
<p><span id="exr:ex15" class="exercise"><strong>Ejercicio 5.16  (Mapa de interpolación con `ggplot`) </strong></span>Repita el mapa de <a href="caos.html#exr:ex14">5.15</a> usando <strong>ggplot2</strong> y la función
<code>geom_contour_filled()</code>.</p>
</div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="caos.html#cb35-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-2"><a href="caos.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Creo una tabla para geom contour</span></span>
<span id="cb35-3"><a href="caos.html#cb35-3" aria-hidden="true" tabindex="-1"></a>coordenadas <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(tmin_idw)</span>
<span id="cb35-4"><a href="caos.html#cb35-4" aria-hidden="true" tabindex="-1"></a>valor <span class="ot">&lt;-</span> tmin_idw<span class="sc">$</span>var1.pred</span>
<span id="cb35-5"><a href="caos.html#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="caos.html#cb35-6" aria-hidden="true" tabindex="-1"></a>idw_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb35-7"><a href="caos.html#cb35-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Necesitamos redondear las coordenadas</span></span>
<span id="cb35-8"><a href="caos.html#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">latitud =</span> <span class="fu">round</span>(coordenadas[, <span class="dv">2</span>], <span class="dv">6</span>),</span>
<span id="cb35-9"><a href="caos.html#cb35-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">longitud =</span> <span class="fu">round</span>(coordenadas[, <span class="dv">1</span>], <span class="dv">6</span>),</span>
<span id="cb35-10"><a href="caos.html#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">tmin =</span> valor</span>
<span id="cb35-11"><a href="caos.html#cb35-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb35-12"><a href="caos.html#cb35-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-13"><a href="caos.html#cb35-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb35-14"><a href="caos.html#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour_filled</span>(</span>
<span id="cb35-15"><a href="caos.html#cb35-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> idw_df,</span>
<span id="cb35-16"><a href="caos.html#cb35-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> longitud, <span class="at">y =</span> latitud, <span class="at">z =</span> tmin),</span>
<span id="cb35-17"><a href="caos.html#cb35-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-18"><a href="caos.html#cb35-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> cortes</span>
<span id="cb35-19"><a href="caos.html#cb35-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb35-20"><a href="caos.html#cb35-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reajustamos la escala de colores</span></span>
<span id="cb35-21"><a href="caos.html#cb35-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colores) <span class="sc">+</span></span>
<span id="cb35-22"><a href="caos.html#cb35-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># CCAA</span></span>
<span id="cb35-23"><a href="caos.html#cb35-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> esp3, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb35-24"><a href="caos.html#cb35-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb35-25"><a href="caos.html#cb35-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb35-26"><a href="caos.html#cb35-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb35-27"><a href="caos.html#cb35-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Temp. (º)&quot;</span></span>
<span id="cb35-28"><a href="caos.html#cb35-28" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-18"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/unnamed-chunk-18-1.png" alt="Temperatura mínima interpolada. 8 de Enero 2021. " width="60%" />
<p class="caption">
Figura 5.8: Temperatura mínima interpolada. 8 de Enero 2021.
</p>
</div>
</div>
<div id="caso-2.-distribución-espacial-de-la-renta-media-por-municipios" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Caso 2. Distribución espacial de la renta media por municipios</h2>
<p><strong>Objetivos de aprendizaje</strong></p>
<p>Esta sección presenta un caso de uso en el que aprenderemos a realizar las
siguientes tareas básicas:</p>
<ul>
<li><p>Importar datos tabulares y datos espaciales.</p></li>
<li><p>Realizar un tratamiento de limpieza de datos y cruzar tablas.</p></li>
<li><p>Hacer mapas temáticos. Aprenderemos también algunas nociones básicas sobre
cómo crear diferentes clases para un conjunto de datos continuo.</p></li>
</ul>
<p>Para ello, partiremos de dos ficheros:</p>
<ol style="list-style-type: decimal">
<li><p>Fichero <code>renta_municipio.csv</code>: Este fichero contiene información de la Renta
Neta per cápita por municipios (en euros), distritos y secciones censales.
Esta información se ha extraído del <a href="https://www.ine.es/experimental/atlas/experimental_atlas.htm">Atlas de distribución de renta de los
hogares</a>
proporcionado por el INE, y ha sido tratado previamente para adaptar la
información al presente ejercicio.</p></li>
<li><p>Fichero <code>municipios.gpkg</code>: Es un fichero que contiene datos espaciales
(polígonos) de los municipios en España en el año 2019. Se ha extraído del
Instituto Geográfico Nacional (IGN) usando el paquete <strong>mapSpain</strong>.</p></li>
</ol>
<p>El primer paso en cualquier tipo de análisis de datos es importar los datos al
software de tratamiento (en nuestro caso, R) y analizarlos para conocer el tipo
de información que contiene.</p>
<div class="exercise">
<p><span id="exr:ex16" class="exercise"><strong>Ejercicio 5.17  (Importación y análisis del los datos objeto de estudio) </strong></span>Importe el fichero de datos <code>renta_municipio.csv</code> y <code>municipios.gpkg</code> y guárdelo
en un objeto llamado <code>renta</code> y <code>munis</code>, respectivamente. Observe la información
que contienen. Puede ayudarse de la función <code>head.</code> Use las librerías oportunas
para importar los datos en los distintos formatos.</p>
</div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="caos.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Usaremos paquetes del tidyverse</span></span>
<span id="cb36-2"><a href="caos.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb36-3"><a href="caos.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb36-4"><a href="caos.html#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="caos.html#cb36-5" aria-hidden="true" tabindex="-1"></a>renta <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/renta_municipio.csv&quot;</span>, <span class="at">na =</span> <span class="st">&quot;.&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="caos.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb37-2"><a href="caos.html#cb37-2" aria-hidden="true" tabindex="-1"></a>munis <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;data/municipios.gpkg&quot;</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="caos.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(renta)</span>
<span id="cb38-2"><a href="caos.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 x 6</span></span>
<span id="cb38-3"><a href="caos.html#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Unidad                          `2019` `2018` `2017` `2016` `2015`</span></span>
<span id="cb38-4"><a href="caos.html#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                            &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb38-5"><a href="caos.html#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 44001 Ababuj                        NA     NA     NA     NA     NA</span></span>
<span id="cb38-6"><a href="caos.html#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 4400101 Ababuj distrito 01          NA     NA     NA     NA     NA</span></span>
<span id="cb38-7"><a href="caos.html#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 4400101001 Ababuj sección 01001     NA     NA     NA     NA     NA</span></span>
<span id="cb38-8"><a href="caos.html#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 40001 Abades                     11429  10731  10314   9816   9904</span></span>
<span id="cb38-9"><a href="caos.html#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 4000101 Abades distrito 01       11429  10731  10314   9816   9904</span></span>
<span id="cb38-10"><a href="caos.html#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 4000101001 Abades sección 01001  11429  10731  10314   9816   9904</span></span></code></pre></div>
<p>Se puede comprobar que tenemos información para el periodo 2015-2019. Además, la
columna <code>Unidad</code> contiene un literal con el municipio o sección correspondiente.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="caos.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(munis)</span>
<span id="cb39-2"><a href="caos.html#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 6 features and 7 fields</span></span>
<span id="cb39-3"><a href="caos.html#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb39-4"><a href="caos.html#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb39-5"><a href="caos.html#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -3.140179 ymin: 36.73817 xmax: -2.057058 ymax: 37.54579</span></span>
<span id="cb39-6"><a href="caos.html#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  ETRS89</span></span>
<span id="cb39-7"><a href="caos.html#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   codauto ine.ccaa.name cpro ine.prov.name cmun      name LAU_CODE                           geom</span></span>
<span id="cb39-8"><a href="caos.html#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1      01     Andalucía   04       Almería  001      Abla    04001 MULTIPOLYGON (((-2.775594 3...</span></span>
<span id="cb39-9"><a href="caos.html#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2      01     Andalucía   04       Almería  002  Abrucena    04002 MULTIPOLYGON (((-2.787566 3...</span></span>
<span id="cb39-10"><a href="caos.html#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3      01     Andalucía   04       Almería  003      Adra    04003 MULTIPOLYGON (((-3.051988 3...</span></span>
<span id="cb39-11"><a href="caos.html#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4      01     Andalucía   04       Almería  004 Albanchez    04004 MULTIPOLYGON (((-2.181086 3...</span></span>
<span id="cb39-12"><a href="caos.html#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5      01     Andalucía   04       Almería  005 Alboloduy    04005 MULTIPOLYGON (((-2.572442 3...</span></span>
<span id="cb39-13"><a href="caos.html#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6      01     Andalucía   04       Almería  006     Albox    04006 MULTIPOLYGON (((-2.128106 3...</span></span></code></pre></div>
<p>El objeto <code>munis</code> contiene polígonos y varias columnas, entre ellas dos
especialmente relevantes: <code>cpro</code> y <code>cmun</code>, que corresponden a los códigos de
provincia y de municipio respectivamente. Podemos comprobar que este código
también se encuentra en el dataset <code>renta</code>.</p>
<div class="exercise">
<p><span id="exr:ex17" class="exercise"><strong>Ejercicio 5.18  (Comprobación de campos en común para un municipio: Noblejas) </strong></span>Para comprobar que efectivamente disponemos de dos campos en común en los
ficheros, que serán de vital importancia para posteriormente unirlos, se
selecciona un municipio al azar, el municipio de Noblejas en la provincia de
Toledo y comprobamos.</p>
</div>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="caos.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Miro un municipio: Noblejas</span></span>
<span id="cb40-2"><a href="caos.html#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="caos.html#cb40-3" aria-hidden="true" tabindex="-1"></a>renta[<span class="fu">grep</span>(<span class="st">&quot;Noblejas&quot;</span>, renta<span class="sc">$</span>Unidad), ]</span>
<span id="cb40-4"><a href="caos.html#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 x 6</span></span>
<span id="cb40-5"><a href="caos.html#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Unidad                            `2019` `2018` `2017` `2016` `2015`</span></span>
<span id="cb40-6"><a href="caos.html#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                              &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb40-7"><a href="caos.html#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 45115 Noblejas                     10591  10314   9751   9484   9124</span></span>
<span id="cb40-8"><a href="caos.html#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 4511501 Noblejas distrito 01       11039  10717  10135   9711   9386</span></span>
<span id="cb40-9"><a href="caos.html#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 4511501001 Noblejas sección 01001  11039  10717  10135   9711   9386</span></span>
<span id="cb40-10"><a href="caos.html#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 4511502 Noblejas distrito 02       10276  10029   9475   9319   8938</span></span>
<span id="cb40-11"><a href="caos.html#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 4511502001 Noblejas sección 02001  10276  10029   9475   9319   8938</span></span>
<span id="cb40-12"><a href="caos.html#cb40-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-13"><a href="caos.html#cb40-13" aria-hidden="true" tabindex="-1"></a>munis[<span class="fu">grep</span>(<span class="st">&quot;Noblejas&quot;</span>, munis<span class="sc">$</span>name), <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;cpro&quot;</span>, <span class="st">&quot;cmun&quot;</span>)]</span>
<span id="cb40-14"><a href="caos.html#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 1 feature and 3 fields</span></span>
<span id="cb40-15"><a href="caos.html#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb40-16"><a href="caos.html#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb40-17"><a href="caos.html#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -3.489824 ymin: 39.93003 xmax: -3.372611 ymax: 40.05017</span></span>
<span id="cb40-18"><a href="caos.html#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  ETRS89</span></span>
<span id="cb40-19"><a href="caos.html#cb40-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          name cpro cmun                           geom</span></span>
<span id="cb40-20"><a href="caos.html#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4985 Noblejas   45  115 MULTIPOLYGON (((-3.44681 40...</span></span></code></pre></div>
<p>En el caso de Noblejas, el código completo es 45115. Sin embargo, en el caso de
la tabla <code>renta</code>, debemos extraer ese valor del literal. Para ello debemos
manipular la columna y extraer la primera palabra de la columna <code>Unidad</code>:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="caos.html#cb41-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-2"><a href="caos.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Creo una función y la aplico a toda la columna</span></span>
<span id="cb41-3"><a href="caos.html#cb41-3" aria-hidden="true" tabindex="-1"></a>extrae_codigo <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb41-4"><a href="caos.html#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>(<span class="fu">strsplit</span>(x, <span class="st">&quot; &quot;</span>))[<span class="dv">1</span>]</span>
<span id="cb41-5"><a href="caos.html#cb41-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-6"><a href="caos.html#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="caos.html#cb41-7" aria-hidden="true" tabindex="-1"></a>renta<span class="sc">$</span>codigo_ine <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">as.character</span>(renta<span class="sc">$</span>Unidad), extrae_codigo)</span>
<span id="cb41-8"><a href="caos.html#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="caos.html#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(renta[<span class="fu">c</span>(<span class="st">&quot;Unidad&quot;</span>, <span class="st">&quot;codigo_ine&quot;</span>)])</span>
<span id="cb41-10"><a href="caos.html#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 x 2</span></span>
<span id="cb41-11"><a href="caos.html#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Unidad                          codigo_ine</span></span>
<span id="cb41-12"><a href="caos.html#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                           &lt;chr&gt;     </span></span>
<span id="cb41-13"><a href="caos.html#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 44001 Ababuj                    44001     </span></span>
<span id="cb41-14"><a href="caos.html#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 4400101 Ababuj distrito 01      4400101   </span></span>
<span id="cb41-15"><a href="caos.html#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 4400101001 Ababuj sección 01001 4400101001</span></span>
<span id="cb41-16"><a href="caos.html#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 40001 Abades                    40001     </span></span>
<span id="cb41-17"><a href="caos.html#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 4000101 Abades distrito 01      4000101   </span></span>
<span id="cb41-18"><a href="caos.html#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 4000101001 Abades sección 01001 4000101001</span></span></code></pre></div>
<p>Ahora, es necesario crear la misma variable en <code>munis</code> para poder realizar el
cruce:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="caos.html#cb42-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-2"><a href="caos.html#cb42-2" aria-hidden="true" tabindex="-1"></a>munis<span class="sc">$</span>codigo_ine <span class="ot">&lt;-</span> <span class="fu">paste0</span>(munis<span class="sc">$</span>cpro, munis<span class="sc">$</span>cmun)</span>
<span id="cb42-3"><a href="caos.html#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="caos.html#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(munis[, <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;codigo_ine&quot;</span>)])</span>
<span id="cb42-5"><a href="caos.html#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 6 features and 2 fields</span></span>
<span id="cb42-6"><a href="caos.html#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb42-7"><a href="caos.html#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb42-8"><a href="caos.html#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -3.140179 ymin: 36.73817 xmax: -2.057058 ymax: 37.54579</span></span>
<span id="cb42-9"><a href="caos.html#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  ETRS89</span></span>
<span id="cb42-10"><a href="caos.html#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        name codigo_ine                           geom</span></span>
<span id="cb42-11"><a href="caos.html#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1      Abla      04001 MULTIPOLYGON (((-2.775594 3...</span></span>
<span id="cb42-12"><a href="caos.html#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  Abrucena      04002 MULTIPOLYGON (((-2.787566 3...</span></span>
<span id="cb42-13"><a href="caos.html#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3      Adra      04003 MULTIPOLYGON (((-3.051988 3...</span></span>
<span id="cb42-14"><a href="caos.html#cb42-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Albanchez      04004 MULTIPOLYGON (((-2.181086 3...</span></span>
<span id="cb42-15"><a href="caos.html#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Alboloduy      04005 MULTIPOLYGON (((-2.572442 3...</span></span>
<span id="cb42-16"><a href="caos.html#cb42-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6     Albox      04006 MULTIPOLYGON (((-2.128106 3...</span></span></code></pre></div>
<p>Ya estamos listos para realizar el cruce. Además, seleccionaremos sólo las
columnas que vamos a usar, en este caso la del año 2019.</p>
<div class="exercise">
<p><span id="exr:ex18" class="exercise"><strong>Ejercicio 5.19  (Unión de objetos renta y mapas) </strong></span>Realice la unión de los objetos con la función <code>left_join()</code> y seleccione las
variables <code>name</code>, <code>cpro</code>, <code>cmun</code>, <code>2019</code>. Guarde el resultado obtenido en un
nuevo objeto llamado <code>munis_renta</code>.</p>
</div>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="caos.html#cb43-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-2"><a href="caos.html#cb43-2" aria-hidden="true" tabindex="-1"></a>munis_renta <span class="ot">&lt;-</span> munis <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="caos.html#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(renta) <span class="sc">%&gt;%</span></span>
<span id="cb43-4"><a href="caos.html#cb43-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name, cpro, cmun, <span class="st">`</span><span class="at">2019</span><span class="st">`</span>)</span></code></pre></div>
<p><strong>Cuando crucemos datos espaciales con datos no espaciales en R, es importante
que el primer dataset sea el que contiene los datos espaciales</strong>. Esto es así
porque el objeto resultante “hereda” la clase del primer objeto.</p>
<p>A modo de ejemplo, si realizáramos el proceso poniendo los datos espaciales en
el lado derecho del join, los datos finales no serán espaciales:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="caos.html#cb44-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-2"><a href="caos.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Miramos la clase de munis_renta</span></span>
<span id="cb44-3"><a href="caos.html#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="caos.html#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(munis_renta)</span>
<span id="cb44-5"><a href="caos.html#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;sf&quot;         &quot;data.frame&quot;</span></span>
<span id="cb44-6"><a href="caos.html#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="caos.html#cb44-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Es un sf, por tanto espacial</span></span>
<span id="cb44-8"><a href="caos.html#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="caos.html#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Que pasa si realizamos el cruce de la otra manera?</span></span>
<span id="cb44-10"><a href="caos.html#cb44-10" aria-hidden="true" tabindex="-1"></a>renta <span class="sc">%&gt;%</span></span>
<span id="cb44-11"><a href="caos.html#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(munis) <span class="sc">%&gt;%</span></span>
<span id="cb44-12"><a href="caos.html#cb44-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name, cpro, cmun, <span class="st">`</span><span class="at">2019</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-13"><a href="caos.html#cb44-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>()</span>
<span id="cb44-14"><a href="caos.html#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span></span></code></pre></div>
<p>El resultado es un tibble o data.frame, <strong>¡pero no es espacial!</strong></p>
<p>Una vez que tenemos los datos unidos podemos realizar algunos análisis básicos,
como la realización de un histograma.</p>
<div class="exercise">
<p><span id="exr:ex19" class="exercise"><strong>Ejercicio 5.20  (Histograma de la variable Renta neta media por persona (€)) </strong></span>A través de un histograma represente la distribución de la variable Renta neta
media por persona del objeto <code>munis_renta</code> para el año 2019.</p>
</div>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="caos.html#cb45-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-2"><a href="caos.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb45-3"><a href="caos.html#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="caos.html#cb45-4" aria-hidden="true" tabindex="-1"></a>munis_renta <span class="sc">%&gt;%</span></span>
<span id="cb45-5"><a href="caos.html#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">2019</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb45-6"><a href="caos.html#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb45-7"><a href="caos.html#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_auto</span>()) <span class="sc">+</span></span>
<span id="cb45-8"><a href="caos.html#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb45-9"><a href="caos.html#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb45-10"><a href="caos.html#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb45-11"><a href="caos.html#cb45-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Renta neta media por persona (€)&quot;</span></span>
<span id="cb45-12"><a href="caos.html#cb45-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:basic"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/basic-1.png" alt="Histograma de la variable Renta neta media por persona (€) en 2019" width="60%" />
<p class="caption">
Figura 5.9: Histograma de la variable Renta neta media por persona (€) en 2019
</p>
</div>
<p>Se puede observar que la renta presenta una distribución Gamma con un gran
número de municipios concentrados en zonas medias de renta y pocos municipios en
tramos de rentas altas. Como se verá en el Ejercicio XXX (<strong>GEMA?</strong>), esta
distribución va a afectar a la información que transmite el mapa.</p>
<div class="exercise">
<p><span id="exr:ex20" class="exercise"><strong>Ejercicio 5.21  (Mapa de coropletas de la distribución de la renta) </strong></span>Realice un mapa de coropletas mostrando la distribución de la renta usando los
valores brutos de renta sin modificar</p>
</div>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="caos.html#cb46-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-2"><a href="caos.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(munis_renta) <span class="sc">+</span></span>
<span id="cb46-3"><a href="caos.html#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Usamos geom_sf, y como aes() lo que queremos mostrar, en este caso, el</span></span>
<span id="cb46-4"><a href="caos.html#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># color del polígono representa la renta. Vamos a retirar los bordes con</span></span>
<span id="cb46-5"><a href="caos.html#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># color = NA</span></span>
<span id="cb46-6"><a href="caos.html#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="st">`</span><span class="at">2019</span><span class="st">`</span>), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb46-7"><a href="caos.html#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb46-8"><a href="caos.html#cb46-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(</span>
<span id="cb46-9"><a href="caos.html#cb46-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">big.mark =</span> <span class="st">&quot;.&quot;</span>,</span>
<span id="cb46-10"><a href="caos.html#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimal.mark =</span> <span class="st">&quot;,&quot;</span>,</span>
<span id="cb46-11"><a href="caos.html#cb46-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">suffix =</span> <span class="st">&quot; €&quot;</span></span>
<span id="cb46-12"><a href="caos.html#cb46-12" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb46-13"><a href="caos.html#cb46-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:maparenta1"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/maparenta1-1.png" alt="Renta neta media por persona en España (2019)" width="60%" />
<p class="caption">
Figura 5.10: Renta neta media por persona en España (2019)
</p>
</div>
<p>Este primer mapa no es demasiado informativo, por los siguientes motivos:</p>
<ul>
<li><p>Existe una serie de municipios para los que no tenemos datos.</p></li>
<li><p>La escala de color no es la más adecuada.</p></li>
<li><p>Dada la distribución de los datos, puede ser adecuado crear grupos de renta
para que el mapa sea más interpretable.</p></li>
</ul>
<div class="exercise">
<p><span id="exr:ex21" class="exercise"><strong>Ejercicio 5.22  (Adecuacion de los datos al la visualización) </strong></span>Elimine los municipios sin datos y a cambie la escala de color para ver si
mejora la visualización de la variable Renta neta media por persona.</p>
</div>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="caos.html#cb47-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2"><a href="caos.html#cb47-2" aria-hidden="true" tabindex="-1"></a>munis_renta_clean <span class="ot">&lt;-</span> munis_renta <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">2019</span><span class="st">`</span>))</span>
<span id="cb47-3"><a href="caos.html#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="caos.html#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(munis_renta_clean) <span class="sc">+</span></span>
<span id="cb47-5"><a href="caos.html#cb47-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="st">`</span><span class="at">2019</span><span class="st">`</span>), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb47-6"><a href="caos.html#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cambiamos la paleta de colores, vamos a usar una paleta denominada Inferno,</span></span>
<span id="cb47-7"><a href="caos.html#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ya incluida en base R con hcl.colors</span></span>
<span id="cb47-8"><a href="caos.html#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="caos.html#cb47-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Como son datos continuos, puedo usar Inferno</span></span>
<span id="cb47-10"><a href="caos.html#cb47-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(</span>
<span id="cb47-11"><a href="caos.html#cb47-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">colours =</span> <span class="fu">hcl.colors</span>(<span class="dv">20</span>, <span class="st">&quot;Inferno&quot;</span>, <span class="at">rev =</span> <span class="cn">TRUE</span>),</span>
<span id="cb47-12"><a href="caos.html#cb47-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(</span>
<span id="cb47-13"><a href="caos.html#cb47-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">big.mark =</span> <span class="st">&quot;.&quot;</span>,</span>
<span id="cb47-14"><a href="caos.html#cb47-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">decimal.mark =</span> <span class="st">&quot;,&quot;</span>,</span>
<span id="cb47-15"><a href="caos.html#cb47-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">suffix =</span> <span class="st">&quot; €&quot;</span></span>
<span id="cb47-16"><a href="caos.html#cb47-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb47-17"><a href="caos.html#cb47-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb47-18"><a href="caos.html#cb47-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:maparenta2"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/maparenta2-1.png" alt="Renta neta media por persona en España (2019)" width="60%" />
<p class="caption">
Figura 5.11: Renta neta media por persona en España (2019)
</p>
</div>
<p>Este mapa proporciona algo más de información, y parece intuirse que las rentas
más altas se encuentran en zonas de País Vasco, Madrid y Cataluña. Sin embargo,
el hecho de que la distribución de los datos no sea normal está afectando a la
visualización.</p>
<p>Para intentar atajar este problema, se puede dividir los datos en clases, por
ejemplo, cuartiles o deciles. Existen varios métodos de clasificación de datos,
que en R se encuentran implementados en el paquete <strong>classInt</strong> <span class="citation">(<a href="#ref-R-classint" role="doc-biblioref">Bivand 2020</a>)</span>. A
continuación se van a plantear diversos métodos de clasificación y se observará
cómo la “historia” que cuenta el mapa varía en función de dichas clases. Se
proponen siguientes métodos de clasificación:</p>
<ul>
<li><p><strong>El método de deciles</strong>: consiste en crear 10 categorías incluyendo el
mismo número de registros en cada una de ellas.</p></li>
<li><p><strong>El método de intervalos equivalentes</strong>: divide el rango de valores en un
número de grupos definido. La distancia de todos los intervalos es idéntica,
por lo que este método no tiene en cuenta la distribución de los registros.</p></li>
<li><p><strong>El método de Fisher-Jenks</strong>: desarrollado específicamente para la
clasificación de datos espaciales y su visualización en mapas. Produce
agrupaciones de tal manera que los datos de cada grupo son “cercanas” entre
sí y sustancialmente distintas de los valores de otros grupos.</p></li>
</ul>
<div class="exercise">
<p><span id="exr:ex22" class="exercise"><strong>Ejercicio 5.23  (División de los datos en clases) </strong></span>Utilice la función <code>classIntervals()</code> del paquete <strong>classInt</strong> y cambie el
parámetro <code>style</code> para obtener los métodos de clasificación: Deciles, tramos de
Renta equidistantes y Fisher and Jenks.</p>
<p>Realice un <code>plot</code> de las clases obtenidas y compárelas.</p>
</div>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="caos.html#cb48-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-2"><a href="caos.html#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(classInt)</span>
<span id="cb48-3"><a href="caos.html#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="caos.html#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># División en deciles</span></span>
<span id="cb48-5"><a href="caos.html#cb48-5" aria-hidden="true" tabindex="-1"></a>deciles <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(munis_renta_clean<span class="sc">$</span><span class="st">`</span><span class="at">2019</span><span class="st">`</span>,</span>
<span id="cb48-6"><a href="caos.html#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">style =</span> <span class="st">&quot;quantile&quot;</span>, <span class="at">n =</span> <span class="dv">10</span></span>
<span id="cb48-7"><a href="caos.html#cb48-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-8"><a href="caos.html#cb48-8" aria-hidden="true" tabindex="-1"></a>deciles</span>
<span id="cb48-9"><a href="caos.html#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; style: quantile</span></span>
<span id="cb48-10"><a href="caos.html#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     [5898,8935.6)   [8935.6,9662.2)  [9662.2,10352.8)   [10352.8,10918)     [10918,11462) </span></span>
<span id="cb48-11"><a href="caos.html#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               656               656               655               654               655 </span></span>
<span id="cb48-12"><a href="caos.html#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   [11462,11998.6) [11998.6,12651.4) [12651.4,13475.8) [13475.8,14618.4)   [14618.4,26367] </span></span>
<span id="cb48-13"><a href="caos.html#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               658               656               655               656               656</span></span>
<span id="cb48-14"><a href="caos.html#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(deciles, <span class="at">pal =</span> <span class="fu">hcl.colors</span>(<span class="dv">20</span>, <span class="st">&quot;Inferno&quot;</span>), <span class="at">main =</span> <span class="st">&quot;Deciles&quot;</span>)</span></code></pre></div>
<p><img src="Visualización_geolocalización_datos_files/figure-html/classint-1.png" width="60%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="caos.html#cb49-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-2"><a href="caos.html#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="caos.html#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Tramos equidistantes en términos de renta</span></span>
<span id="cb49-4"><a href="caos.html#cb49-4" aria-hidden="true" tabindex="-1"></a>equal <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(munis_renta_clean<span class="sc">$</span><span class="st">`</span><span class="at">2019</span><span class="st">`</span>,</span>
<span id="cb49-5"><a href="caos.html#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">style =</span> <span class="st">&quot;equal&quot;</span>, <span class="at">n =</span> <span class="dv">10</span></span>
<span id="cb49-6"><a href="caos.html#cb49-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-7"><a href="caos.html#cb49-7" aria-hidden="true" tabindex="-1"></a>equal</span>
<span id="cb49-8"><a href="caos.html#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; style: equal</span></span>
<span id="cb49-9"><a href="caos.html#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     [5898,7944.9)   [7944.9,9991.8)  [9991.8,12038.7) [12038.7,14085.6) [14085.6,16132.5) </span></span>
<span id="cb49-10"><a href="caos.html#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               103              1510              2374              1637               702 </span></span>
<span id="cb49-11"><a href="caos.html#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [16132.5,18179.4) [18179.4,20226.3) [20226.3,22273.2) [22273.2,24320.1)   [24320.1,26367] </span></span>
<span id="cb49-12"><a href="caos.html#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               161                52                14                 3                 1</span></span>
<span id="cb49-13"><a href="caos.html#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(equal, <span class="at">pal =</span> <span class="fu">hcl.colors</span>(<span class="dv">20</span>, <span class="st">&quot;Inferno&quot;</span>), <span class="at">main =</span> <span class="st">&quot;Equidistantes&quot;</span>)</span></code></pre></div>
<p><img src="Visualización_geolocalización_datos_files/figure-html/classint-2.png" width="60%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="caos.html#cb50-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-2"><a href="caos.html#cb50-2" aria-hidden="true" tabindex="-1"></a>fisher <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(munis_renta_clean<span class="sc">$</span><span class="st">`</span><span class="at">2019</span><span class="st">`</span>,</span>
<span id="cb50-3"><a href="caos.html#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">style =</span> <span class="st">&quot;fisher&quot;</span>,</span>
<span id="cb50-4"><a href="caos.html#cb50-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fuerzo para mejorar la comparación entre métodos</span></span>
<span id="cb50-5"><a href="caos.html#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">10</span></span>
<span id="cb50-6"><a href="caos.html#cb50-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-7"><a href="caos.html#cb50-7" aria-hidden="true" tabindex="-1"></a>fisher</span>
<span id="cb50-8"><a href="caos.html#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; style: fisher</span></span>
<span id="cb50-9"><a href="caos.html#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       [5898,8743)     [8743,9770.5)    [9770.5,10754)     [10754,11689)     [11689,12668) </span></span>
<span id="cb50-10"><a href="caos.html#cb50-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               505               904              1005              1159              1032 </span></span>
<span id="cb50-11"><a href="caos.html#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     [12668,13803)   [13803,15222.5) [15222.5,17196.5) [17196.5,20063.5)   [20063.5,26367] </span></span>
<span id="cb50-12"><a href="caos.html#cb50-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               874               651               305               103                19</span></span>
<span id="cb50-13"><a href="caos.html#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fisher,</span>
<span id="cb50-14"><a href="caos.html#cb50-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> <span class="fu">hcl.colors</span>(<span class="dv">20</span>, <span class="st">&quot;Inferno&quot;</span>),</span>
<span id="cb50-15"><a href="caos.html#cb50-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Fisher-Jenks&quot;</span></span>
<span id="cb50-16"><a href="caos.html#cb50-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="Visualización_geolocalización_datos_files/figure-html/classint-3.png" width="60%" style="display: block; margin: auto;" /></p>
<p>Se puede observar lo siguiente:</p>
<ul>
<li><p>El último decil de renta se corresponde a un rango de entre 15.000 y 25.000
€.</p></li>
<li><p>El método por deciles proporciona unos grupos con valores de renta muy
parecidos entre sí en los valores medios. Esto es debido a la propia
distribución de la variable.</p></li>
<li><p>El método de rangos equidistantes proporciona algunos grupos con un número
muy reducido de municipios.</p></li>
<li><p>El método de Fisher-Jenks puede proporcionar unas clases con unos rangos más
apropiados para los tramos altos de renta.</p></li>
</ul>
<div class="exercise">
<p><span id="exr:ex23" class="exercise"><strong>Ejercicio 5.24  (Representación de los mapas según las clases obtenidas) </strong></span>Realice tres mapas distintos, creando clases de renta según cada uno de los
métodos anteriormente mostrados y coméntelos.</p>
</div>
<p><strong>Deciles</strong></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="caos.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracción de los valores de corte</span></span>
<span id="cb51-2"><a href="caos.html#cb51-2" aria-hidden="true" tabindex="-1"></a>breaks_d <span class="ot">&lt;-</span> deciles<span class="sc">$</span>brks</span>
<span id="cb51-3"><a href="caos.html#cb51-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-4"><a href="caos.html#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Creación de etiquetas básicas para cada clase</span></span>
<span id="cb51-5"><a href="caos.html#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Creación de una función específica para crear etiquetas formateadas</span></span>
<span id="cb51-6"><a href="caos.html#cb51-6" aria-hidden="true" tabindex="-1"></a>label_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb51-7"><a href="caos.html#cb51-7" aria-hidden="true" tabindex="-1"></a>  l <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb51-8"><a href="caos.html#cb51-8" aria-hidden="true" tabindex="-1"></a>  eur <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">prettyNum</span>(<span class="fu">round</span>(x, <span class="dv">0</span>),</span>
<span id="cb51-9"><a href="caos.html#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimal.mark =</span> <span class="st">&quot;,&quot;</span>,</span>
<span id="cb51-10"><a href="caos.html#cb51-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">big.mark =</span> <span class="st">&quot;.&quot;</span></span>
<span id="cb51-11"><a href="caos.html#cb51-11" aria-hidden="true" tabindex="-1"></a>  ), <span class="st">&quot; €&quot;</span>)</span>
<span id="cb51-12"><a href="caos.html#cb51-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-13"><a href="caos.html#cb51-13" aria-hidden="true" tabindex="-1"></a>  labels <span class="ot">&lt;-</span> <span class="fu">paste</span>(eur[<span class="sc">-</span>l], <span class="st">&quot;-&quot;</span>, eur[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb51-14"><a href="caos.html#cb51-14" aria-hidden="true" tabindex="-1"></a>  labels[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;&lt;&quot;</span>, eur[<span class="dv">1</span>])</span>
<span id="cb51-15"><a href="caos.html#cb51-15" aria-hidden="true" tabindex="-1"></a>  labels[l <span class="sc">-</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;&gt;&quot;</span>, eur[l <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb51-16"><a href="caos.html#cb51-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(labels)</span>
<span id="cb51-17"><a href="caos.html#cb51-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb51-18"><a href="caos.html#cb51-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-19"><a href="caos.html#cb51-19" aria-hidden="true" tabindex="-1"></a>labels_d <span class="ot">&lt;-</span> <span class="fu">label_fun</span>(breaks_d)</span>
<span id="cb51-20"><a href="caos.html#cb51-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-21"><a href="caos.html#cb51-21" aria-hidden="true" tabindex="-1"></a>munis_renta_clean<span class="sc">$</span>Deciles <span class="ot">&lt;-</span> <span class="fu">cut</span>(munis_renta_clean<span class="sc">$</span><span class="st">`</span><span class="at">2019</span><span class="st">`</span>,</span>
<span id="cb51-22"><a href="caos.html#cb51-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> breaks_d,</span>
<span id="cb51-23"><a href="caos.html#cb51-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> labels_d,</span>
<span id="cb51-24"><a href="caos.html#cb51-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">include.lowest =</span> <span class="cn">TRUE</span></span>
<span id="cb51-25"><a href="caos.html#cb51-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-26"><a href="caos.html#cb51-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-27"><a href="caos.html#cb51-27" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(munis_renta_clean) <span class="sc">+</span></span>
<span id="cb51-28"><a href="caos.html#cb51-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cambio la variable a representar para crear el mapa</span></span>
<span id="cb51-29"><a href="caos.html#cb51-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Deciles), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb51-30"><a href="caos.html#cb51-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cambio el scale, ya no es continua</span></span>
<span id="cb51-31"><a href="caos.html#cb51-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">hcl.colors</span>(<span class="fu">length</span>(labels_d),</span>
<span id="cb51-32"><a href="caos.html#cb51-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Inferno&quot;</span>,</span>
<span id="cb51-33"><a href="caos.html#cb51-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">rev =</span> <span class="cn">TRUE</span></span>
<span id="cb51-34"><a href="caos.html#cb51-34" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb51-35"><a href="caos.html#cb51-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:mapa-deciles"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/mapa-deciles-1.png" alt="Mapa por deciles de renta media por persona (2019)" width="60%" />
<p class="caption">
Figura 5.12: Mapa por deciles de renta media por persona (2019)
</p>
</div>
<p>El mapa de la Fig. <a href="caos.html#fig:mapa-deciles">5.12</a> ya permite observar patrones
geográficos, donde se ve una clara diferencia entre la Comunidades Autónomas del
Norte y las del Sur. Veamos una representación distina usando otras clases
diferentes</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="caos.html#cb52-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-2"><a href="caos.html#cb52-2" aria-hidden="true" tabindex="-1"></a>breaks_e <span class="ot">&lt;-</span> equal<span class="sc">$</span>brks</span>
<span id="cb52-3"><a href="caos.html#cb52-3" aria-hidden="true" tabindex="-1"></a>labels_e <span class="ot">&lt;-</span> <span class="fu">label_fun</span>(breaks_e)</span>
<span id="cb52-4"><a href="caos.html#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="caos.html#cb52-5" aria-hidden="true" tabindex="-1"></a>munis_renta_clean<span class="sc">$</span>Equal <span class="ot">&lt;-</span> <span class="fu">cut</span>(munis_renta_clean<span class="sc">$</span><span class="st">`</span><span class="at">2019</span><span class="st">`</span>,</span>
<span id="cb52-6"><a href="caos.html#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> breaks_e,</span>
<span id="cb52-7"><a href="caos.html#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> labels_e,</span>
<span id="cb52-8"><a href="caos.html#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">include.lowest =</span> <span class="cn">TRUE</span></span>
<span id="cb52-9"><a href="caos.html#cb52-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-10"><a href="caos.html#cb52-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-11"><a href="caos.html#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(munis_renta_clean) <span class="sc">+</span></span>
<span id="cb52-12"><a href="caos.html#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cambiamos la variable que usamos para crear el mapa</span></span>
<span id="cb52-13"><a href="caos.html#cb52-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Equal), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb52-14"><a href="caos.html#cb52-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">hcl.colors</span>(<span class="fu">length</span>(labels_e),</span>
<span id="cb52-15"><a href="caos.html#cb52-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Inferno&quot;</span>,</span>
<span id="cb52-16"><a href="caos.html#cb52-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">rev =</span> <span class="cn">TRUE</span></span>
<span id="cb52-17"><a href="caos.html#cb52-17" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb52-18"><a href="caos.html#cb52-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:mapa-equal"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/mapa-equal-1.png" alt="Mapa por tramos de renta equidistantes de renta media por persona (2019)" width="60%" />
<p class="caption">
Figura 5.13: Mapa por tramos de renta equidistantes de renta media por persona (2019)
</p>
</div>
<p>El mapa de la Fig. <a href="caos.html#fig:mapa-deciles">5.12</a>, sin embargo, se parece más al mapa
de la Fig. <a href="caos.html#fig:maparenta2">5.11</a> con los datos sin clasificar, donde el peso
visual se concentra más bien en los municipios con rentas mucho más altas que el
resto (por encima de 18.000 €).</p>
<p>Véase a continuación el mismo mapa usando la clasificación Fisher-Jenks:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="caos.html#cb53-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-2"><a href="caos.html#cb53-2" aria-hidden="true" tabindex="-1"></a>breaks_f <span class="ot">&lt;-</span> fisher<span class="sc">$</span>brks</span>
<span id="cb53-3"><a href="caos.html#cb53-3" aria-hidden="true" tabindex="-1"></a>labels_f <span class="ot">&lt;-</span> <span class="fu">label_fun</span>(breaks_f)</span>
<span id="cb53-4"><a href="caos.html#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="caos.html#cb53-5" aria-hidden="true" tabindex="-1"></a>munis_renta_clean<span class="sc">$</span><span class="st">`</span><span class="at">Fisher-Jenks</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">cut</span>(munis_renta_clean<span class="sc">$</span><span class="st">`</span><span class="at">2019</span><span class="st">`</span>,</span>
<span id="cb53-6"><a href="caos.html#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> breaks_f,</span>
<span id="cb53-7"><a href="caos.html#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> labels_f,</span>
<span id="cb53-8"><a href="caos.html#cb53-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">include.lowest =</span> <span class="cn">TRUE</span></span>
<span id="cb53-9"><a href="caos.html#cb53-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-10"><a href="caos.html#cb53-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-11"><a href="caos.html#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(munis_renta_clean) <span class="sc">+</span></span>
<span id="cb53-12"><a href="caos.html#cb53-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cambiamos la variable que usamos para crear el mapa</span></span>
<span id="cb53-13"><a href="caos.html#cb53-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="st">`</span><span class="at">Fisher-Jenks</span><span class="st">`</span>), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb53-14"><a href="caos.html#cb53-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">hcl.colors</span>(<span class="fu">length</span>(labels_f),</span>
<span id="cb53-15"><a href="caos.html#cb53-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Inferno&quot;</span>,</span>
<span id="cb53-16"><a href="caos.html#cb53-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">rev =</span> <span class="cn">TRUE</span></span>
<span id="cb53-17"><a href="caos.html#cb53-17" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb53-18"><a href="caos.html#cb53-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:mapa-fisher"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/mapa-fisher-1.png" alt="Mapa por tramos según Fisher-Jenks" width="60%" />
<p class="caption">
Figura 5.14: Mapa por tramos según Fisher-Jenks
</p>
</div>
<p>En el mapa de la Fig. <a href="caos.html#fig:mapa-fisher">5.14</a> se puede observar de una manera más
clara un cluster adicional de renta en la zona de Asturias y el norte de León.
Además, gracias a la escala de colores puede intuirse que este clúster de renta
no presenta valores tan altos como los observados en País Vasco o Madrid.</p>
<p>En conclusión, en el momento de realizar una visualización de datos es
importante conocer el dato a representar, así como entender algunas propiedades
básicas de la distribución subyacente. También se ha podido observar que hay
ciertas decisiones estéticas (datos continuos vs. agrupados, escala de colores)
que tienen una influencia significativa en cómo se percibe la información
representada. Es responsabilidad del investigador encargado de crear de la
visualización el conocer todos estos factores y aplicarlos de manera
conveniente.</p>

</div>
</div>
<h3>Referencias</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-R-classint" class="csl-entry">
Bivand, Roger. 2020. <em><span class="nocase">classInt</span>: Choose Univariate Class Intervals</em>. <a href="https://CRAN.R-project.org/package=classInt">https://CRAN.R-project.org/package=classInt</a>.
</div>
<div id="ref-R-mapsf" class="csl-entry">
Giraud, Timothée. 2022. <em><span class="nocase">mapsf</span>: Thematic Cartography</em>. <a href="https://CRAN.R-project.org/package=mapsf">https://CRAN.R-project.org/package=mapsf</a>.
</div>
<div id="ref-R-gstat" class="csl-entry">
Pebesma, Edzer. 2004. <span>“Multivariable Geostatistics in <span>S</span>: The <span class="nocase">gstat</span> Package.”</span> <em>Computers &amp; Geosciences</em> 30: 683–91.
</div>
<div id="ref-R-climaemet" class="csl-entry">
Pizarro, Manuel, Diego Hernangómez, and Gema Fernández-Avilés. 2021. <em><span class="nocase">climaemet</span>: Climate <span>AEMET</span> Tools</em>. <a href="https://doi.org/10.5281/zenodo.5205573">https://doi.org/10.5281/zenodo.5205573</a>.
</div>
<div id="ref-R-geor" class="csl-entry">
Ribeiro Jr, Paulo J., Peter J. Diggle, Martin Schlather, Roger Bivand, and Brian Ripley. 2020. <em><span class="nocase">geoR</span>: Analysis of Geostatistical Data</em>. <a href="https://CRAN.R-project.org/package=geoR">https://CRAN.R-project.org/package=geoR</a>.
</div>
<div id="ref-R-tmap" class="csl-entry">
Tennekes, Martijn. 2018. <span>“<span class="nocase">tmap</span>: Thematic Maps in <span>R</span>.”</span> <em>Journal of Statistical Software</em> 84 (6): 1–39. <a href="https://doi.org/10.18637/jss.v084.i06">https://doi.org/10.18637/jss.v084.i06</a>.
</div>
<div id="ref-R-ggplot" class="csl-entry">
Wickham, Hadley. 2016. <em><span class="nocase">ggplot2</span>: Elegant Graphics for Data Analysis</em>. Springer-Verlag New York. <a href="https://ggplot2.tidyverse.org">https://ggplot2.tidyverse.org</a>.
</div>
<div id="ref-R-tidyverse" class="csl-entry">
Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. <span>“Welcome to the <span class="nocase">tidyverse</span>.”</span> <em>Journal of Open Source Software</em> 4 (43): 1686. <a href="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</a>.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>Las fechas seleccionadas coinciden con el periodo en el
que la tormenta Filomena tuvo su auge en la Península Ibérica.<a href="caos.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dep-esp.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="referencias.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Visualización_geolocalización_datos.pdf", "Visualización_geolocalización_datos.epub"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
