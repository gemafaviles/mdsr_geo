<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 5 Casos prácticos | Visualización y geolocalización de datos con R</title>
  <meta name="description" content="Máster en Data Science &amp; Business Analytics (con R Software)" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 5 Casos prácticos | Visualización y geolocalización de datos con R" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://mdsr-2122-visualizacion.netlify.app/" />
  
  <meta property="og:description" content="Máster en Data Science &amp; Business Analytics (con R Software)" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 5 Casos prácticos | Visualización y geolocalización de datos con R" />
  
  <meta name="twitter:description" content="Máster en Data Science &amp; Business Analytics (con R Software)" />
  

<meta name="author" content="Diego Hernangómez" />
<meta name="author" content="Gema Fernández-Avilés" />


<meta name="date" content="2022-02-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="dep-esp.html"/>
<link rel="next" href="referencias.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-33KQ1S5ZCJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-33KQ1S5ZCJ');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Visualización y geolocalización de datos con <strong>R</strong></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prólogo</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#sobre-este-libro"><i class="fa fa-check"></i>Sobre este libro</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#datos"><i class="fa fa-check"></i>Datos</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="1" data-path="la-revolución-de-los-geodatos.html"><a href="la-revolución-de-los-geodatos.html"><i class="fa fa-check"></i><b>1</b> La revolución de los geodatos</a></li>
<li class="chapter" data-level="2" data-path="datos-geográficos.html"><a href="datos-geográficos.html"><i class="fa fa-check"></i><b>2</b> Datos geográficos</a>
<ul>
<li class="chapter" data-level="2.1" data-path="datos-geográficos.html"><a href="datos-geográficos.html#contexto-general"><i class="fa fa-check"></i><b>2.1</b> Contexto general</a></li>
<li class="chapter" data-level="2.2" data-path="datos-geográficos.html"><a href="datos-geográficos.html#conceptos-clave"><i class="fa fa-check"></i><b>2.2</b> Conceptos clave</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="formatos.html"><a href="formatos.html"><i class="fa fa-check"></i><b>3</b> Formatos de datos espaciales</a>
<ul>
<li class="chapter" data-level="3.1" data-path="formatos.html"><a href="formatos.html#ficheros-de-datos-espaciales"><i class="fa fa-check"></i><b>3.1</b> Ficheros de datos espaciales</a></li>
<li class="chapter" data-level="3.2" data-path="formatos.html"><a href="formatos.html#modelo-de-datos"><i class="fa fa-check"></i><b>3.2</b> Modelo de datos</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="formatos.html"><a href="formatos.html#vec"><i class="fa fa-check"></i><b>3.2.1</b> Datos de vectores</a></li>
<li class="chapter" data-level="3.2.2" data-path="formatos.html"><a href="formatos.html#raster"><i class="fa fa-check"></i><b>3.2.2</b> Datos ráster</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="formatos.html"><a href="formatos.html#CRS"><i class="fa fa-check"></i><b>3.3</b> Sistema de Referencia de Coordenadas (CRS)</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="formatos.html"><a href="formatos.html#tipos-de-crs"><i class="fa fa-check"></i><b>3.3.1</b> Tipos de CRS</a></li>
<li class="chapter" data-level="3.3.2" data-path="formatos.html"><a href="formatos.html#trabajando-con-proyecciones-en-r"><i class="fa fa-check"></i><b>3.3.2</b> Trabajando con proyecciones en <strong>R</strong></a></li>
<li class="chapter" data-level="3.3.3" data-path="formatos.html"><a href="formatos.html#quecrsuso"><i class="fa fa-check"></i><b>3.3.3</b> ¿Qué proyección uso?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="dep-esp.html"><a href="dep-esp.html"><i class="fa fa-check"></i><b>4</b> Estadística espacial</a>
<ul>
<li class="chapter" data-level="4.1" data-path="dep-esp.html"><a href="dep-esp.html#antes-de-continuar-dependencia-espacial"><i class="fa fa-check"></i><b>4.1</b> Antes de continuar… dependencia espacial</a></li>
<li class="chapter" data-level="4.2" data-path="dep-esp.html"><a href="dep-esp.html#datos-espaciales"><i class="fa fa-check"></i><b>4.2</b> Datos espaciales</a></li>
<li class="chapter" data-level="4.3" data-path="dep-esp.html"><a href="dep-esp.html#clasificación-de-datos-espaciales"><i class="fa fa-check"></i><b>4.3</b> Clasificación de datos espaciales</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="casos.html"><a href="casos.html"><i class="fa fa-check"></i><b>5</b> Casos prácticos</a>
<ul>
<li class="chapter" data-level="5.1" data-path="casos.html"><a href="casos.html#tempmin"><i class="fa fa-check"></i><b>5.1</b> Caso 1: Temperatura mínima en España</a></li>
<li class="chapter" data-level="5.2" data-path="casos.html"><a href="casos.html#caso-2.-distribución-de-la-renta-por-municipios"><i class="fa fa-check"></i><b>5.2</b> Caso 2. Distribución de la renta por municipios</a></li>
<li class="chapter" data-level="5.3" data-path="casos.html"><a href="casos.html#caso-3.-delitos-cometidos-en-valencia-en-el-año-2010"><i class="fa fa-check"></i><b>5.3</b> Caso 3. Delitos cometidos en Valencia en el año 2010</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="referencias.html"><a href="referencias.html"><i class="fa fa-check"></i>Referencias</a></li>
<li class="appendix"><span><b>Anexo</b></span></li>
<li class="chapter" data-level="A" data-path="crsproy.html"><a href="crsproy.html"><i class="fa fa-check"></i><b>A</b> Tipos de CRS proyectados</a>
<ul>
<li class="chapter" data-level="A.1" data-path="crsproy.html"><a href="crsproy.html#por-tipo-de-superficie-de-proyección"><i class="fa fa-check"></i><b>A.1</b> Por tipo de superficie de proyección</a></li>
<li class="chapter" data-level="A.2" data-path="crsproy.html"><a href="crsproy.html#por-métrica-a-preservar"><i class="fa fa-check"></i><b>A.2</b> Por métrica a preservar</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://blog.uclm.es/tp-mbsba/">Máster en Data Science & Business Analytics (con R Software)</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Visualización y geolocalización de datos con R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="casos" class="section level1" number="5">
<h1><span class="header-section-number">Capítulo 5</span> Casos prácticos</h1>
<div class="infobox">
<p><strong>NOTA</strong></p>
<p>En las siguientes aplicaciones se asume que los datos se localizan en la carpeta
<code>data</code> del proyecto de R-Studio en el que se esté trabajando.</p>
<p>Los datos pueden descargarse desde esta dirección:</p>
<p><a href="https://github.com/mdsr-espacial/datos/raw/main/01_visualizacion/datos-ejercicios.zip" class="uri">https://github.com/mdsr-espacial/datos/raw/main/01_visualizacion/datos-ejercicios.zip</a></p>
</div>
<div id="tempmin" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Caso 1: Temperatura mínima en España</h2>
<p><strong>Objetivo de aprendizaje</strong></p>
<p>Esta sección presenta un caso de uso en el que aprenderemos a realizar las
siguientes tareas básicas:</p>
<ol style="list-style-type: decimal">
<li><p>Leer datos espaciales en <strong>R</strong>.</p></li>
<li><p>Proyectar datos espaciales.</p></li>
<li><p>Graficar datos espaciales.</p></li>
</ol>
<p>Para ello, se va a trabajar con los datos de temperatura mínima registradas en
España por las estaciones meteorológicas de la Agencia Estatal de Meteorología
(AEMET). Un conjunto de datos ya depurados y listos para trabajar se encuentra
en el fichero <code>tempmin.csv</code>. Por otra parte, la información relativa al mapeo de
España se obtendrá directamente de la librería <strong>mapSpain</strong>. Todo el análisis se
va a realizar empleando RStudio, por lo que se empezará abriendo el programa y
creando un nuevo proyecto.</p>
<div class="exercise">
<p><span id="exr:ex-crea" class="exercise"><strong>Ejercicio 5.1  (Temperaturas mínimas: Creación del proyecto) </strong></span>Cree un proyecto para trabajar todo lo referente al caso.</p>
</div>
<div class="solution">
<p><span id="sol-crea" class="solution"><em>Solución</em>. </span>Para crear un proyecto siga la secuencia: <em>File&gt; New Proyect</em> y a continuación
<em>New File&gt; R Markdown</em></p>
</div>
<p>El conjunto de datos proporcionado <code>tempmin.csv</code> contiene el nivel de
temperatura del aire en España entre el 6 y el 10 de Enero de
2021<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. Estos datos han sido descargados usando la librería
<strong>climaemet</strong> <span class="citation">(<a href="#ref-R-climaemet" role="doc-biblioref">Pizarro, Hernangómez, and Fernández-Avilés 2021</a>)</span> y han sido posteriormente tratados para su uso en
esta práctica.</p>
<p>A continuación es necesario importar la base de datos de temperatura mínima. El
archivo está en formato csv, por lo cual, es un fichero de texto plano. Se
pueden usar varias funciones para realizar la importación. Se emplearán los
paquetes del <strong>tidyverse</strong> <span class="citation">(<a href="#ref-R-tidyverse" role="doc-biblioref">Wickham et al. 2019</a>)</span> para realizar todo el tratamiento de
datos.</p>
<div class="exercise">
<p><span id="exr:ex2" class="exercise"><strong>Ejercicio 5.2  (Importación de los datos) </strong></span>Importe los datos <code>tempmin.csv</code> y guárdelos en un objeto llamado <code>tmin</code>.</p>
</div>
<div class="solution">
<p><span id="sol2" class="solution"><em>Solución</em>. </span>Use la librería <strong>readr</strong>.</p>
</div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="casos.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cada uno debe seleccionar el directorio donde tiene los datos, de ahí</span></span>
<span id="cb21-2"><a href="casos.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># que sea conveniente trabajar con proyectos.</span></span>
<span id="cb21-3"><a href="casos.html#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb21-4"><a href="casos.html#cb21-4" aria-hidden="true" tabindex="-1"></a>tmin <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/tempmin.csv&quot;</span>)</span></code></pre></div>
<p>El conjunto de datos <code>tempmin</code> es un data frame que contiene 5 variables:</p>
<ul>
<li><p><code>fecha</code>: Indicando la fecha de observación.</p></li>
<li><p><code>indicativo</code>: Es el identificador de la estación de la AEMET que registró el
dato.</p></li>
<li><p><code>tmin</code>: Dato de temperatura mínima registrada en cada fecha por la estación
correspondiente en grados centígrados.</p></li>
<li><p><code>longitud, latitud</code>: Coordenadas geográficas de la estación</p></li>
</ul>
<div class="exercise">
<p><span id="exr:ex3" class="exercise"><strong>Ejercicio 5.3  (Descripción de los datos) </strong></span>Con la función <code>head()</code> describa, en forma de tabla, la información que contiene
el objeto <code>tmin</code> y compruebe que se corresponde con la descrita.</p>
</div>
<table>
<caption><span id="tab:tmin-head">Tabla 5.1: </span>Detalle del objeto tmin</caption>
<thead>
<tr class="header">
<th align="left">fecha</th>
<th align="left">indicativo</th>
<th align="right">tmin</th>
<th align="right">longitud</th>
<th align="right">latitud</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2021-01-06</td>
<td align="left">4358X</td>
<td align="right">-4.7</td>
<td align="right">-5.880556</td>
<td align="right">38.95556</td>
</tr>
<tr class="even">
<td align="left">2021-01-06</td>
<td align="left">4220X</td>
<td align="right">-7.0</td>
<td align="right">-4.616389</td>
<td align="right">39.08861</td>
</tr>
<tr class="odd">
<td align="left">2021-01-06</td>
<td align="left">6106X</td>
<td align="right">4.7</td>
<td align="right">-4.748333</td>
<td align="right">37.02944</td>
</tr>
<tr class="even">
<td align="left">2021-01-06</td>
<td align="left">9698U</td>
<td align="right">-6.8</td>
<td align="right">0.865278</td>
<td align="right">42.20528</td>
</tr>
<tr class="odd">
<td align="left">2021-01-06</td>
<td align="left">4410X</td>
<td align="right">-3.4</td>
<td align="right">-6.385556</td>
<td align="right">38.91583</td>
</tr>
<tr class="even">
<td align="left">2021-01-06</td>
<td align="left">1331A</td>
<td align="right">1.0</td>
<td align="right">-7.031389</td>
<td align="right">43.52472</td>
</tr>
</tbody>
</table>
<p>Una de las clases de objetos espaciales más utilizada en <strong>R</strong> es <code>sf</code>. Sin
embargo, dependiendo del análisis que se quiera realizar hay otras muy comunes
como <code>geodata</code>, <code>spatstat</code>, etc..</p>
<p>A continuación se convertirá el objeto <code>tmin</code> (<code>data.frame</code>) a un objeto de la
clase <code>geodata</code>, una clase muy utilizada para trabajar con datos espaciales y
requerida por la librería <code>geoR</code> <span class="citation">(<a href="#ref-R-geor" role="doc-biblioref">Ribeiro Jr et al. 2020</a>)</span>. Estos objetos contienen las
coordenadas y la variable objeto de estudio. Para mayor detalle ver
<code>??as.geodata</code>. Obsérvese como varía la variable a través de los ejes longitud y
latitud. Observe también la forma campaniforme de la distribución de la
variable.</p>
<div class="exercise">
<p><span id="exr:ex4" class="exercise"><strong>Ejercicio 5.4  (Descripción de los datos (II)) </strong></span>Del objeto <code>tmin</code> seleccione el día <strong>8 de enero de 2022</strong> y las variables
<code>longitud</code>, <code>latitud</code> y <code>tmin</code> para crear el objeto y llámelo <code>tmin_geoR</code>. A
continuación describa analítica y gráficamente dicho objeto.</p>
</div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="casos.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb22-2"><a href="casos.html#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geoR)</span>
<span id="cb22-3"><a href="casos.html#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="casos.html#cb22-4" aria-hidden="true" tabindex="-1"></a>tmin_geoR <span class="ot">&lt;-</span> tmin <span class="sc">%&gt;%</span></span>
<span id="cb22-5"><a href="casos.html#cb22-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fecha <span class="sc">==</span> <span class="st">&quot;2021-01-08&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb22-6"><a href="casos.html#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Seleccionamos las columnas de interés</span></span>
<span id="cb22-7"><a href="casos.html#cb22-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(longitud, latitud, tmin) <span class="sc">%&gt;%</span></span>
<span id="cb22-8"><a href="casos.html#cb22-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Y creamos el objeto geodata</span></span>
<span id="cb22-9"><a href="casos.html#cb22-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.geodata</span>(</span>
<span id="cb22-10"><a href="casos.html#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">coords.col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb22-11"><a href="casos.html#cb22-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data.col =</span> <span class="dv">3</span></span>
<span id="cb22-12"><a href="casos.html#cb22-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb22-13"><a href="casos.html#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="casos.html#cb22-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-15"><a href="casos.html#cb22-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tmin_geoR)</span>
<span id="cb22-16"><a href="casos.html#cb22-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of data points: 211 </span></span>
<span id="cb22-17"><a href="casos.html#cb22-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb22-18"><a href="casos.html#cb22-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Coordinates summary</span></span>
<span id="cb22-19"><a href="casos.html#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      longitud  latitud</span></span>
<span id="cb22-20"><a href="casos.html#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; min -9.291389 35.27639</span></span>
<span id="cb22-21"><a href="casos.html#cb22-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; max  4.215556 43.78611</span></span>
<span id="cb22-22"><a href="casos.html#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb22-23"><a href="casos.html#cb22-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Distance summary</span></span>
<span id="cb22-24"><a href="casos.html#cb22-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         min         max </span></span>
<span id="cb22-25"><a href="casos.html#cb22-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  0.01024389 13.85144264 </span></span>
<span id="cb22-26"><a href="casos.html#cb22-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb22-27"><a href="casos.html#cb22-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Data summary</span></span>
<span id="cb22-28"><a href="casos.html#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        Min.     1st Qu.      Median        Mean     3rd Qu.        Max. </span></span>
<span id="cb22-29"><a href="casos.html#cb22-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; -14.9000000  -4.6000000  -0.5000000  -0.6293839   3.5000000  13.6000000</span></span>
<span id="cb22-30"><a href="casos.html#cb22-30" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tmin_geoR)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-13"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/unnamed-chunk-13-1.png" alt="Convertir `data.frame` a `geodata`" width="60%" />
<p class="caption">
Figura 5.1: Convertir <code>data.frame</code> a <code>geodata</code>
</p>
</div>
<p>En esta ocasión, convertiremos los datos de <code>tmin</code> en un objeto espacial <code>sf</code>,
es decir, datos espaciales de tipo vector.</p>
<p>Los datos de <code>tmin</code> contienen coordenadas geográficas longitud/latitud, así que
como se vió en la Sección <a href="formatos.html#CRS">3.3</a> el CRS a emplear ha de ser un CRS
geográfico. Usaremos el código <strong>EPSG:4326</strong>, que corresponde a coordenadas
geográficas y suele ser el habitual en este tipo de situaciones.</p>
<div class="exercise">
<p><span id="exr:ex5" class="exercise"><strong>Ejercicio 5.5  (Convertir data.frame a sf) </strong></span>Del objeto <code>tmin</code> seleccione las variables <code>longitud</code>, <code>latitud</code> y <code>tmin</code> para
crear el objeto sf y llámelo <code>tmin_sf</code>. A continuación describa el objeto
creado.</p>
</div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="casos.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb23-2"><a href="casos.html#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="casos.html#cb23-3" aria-hidden="true" tabindex="-1"></a>tmin_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(tmin,</span>
<span id="cb23-4"><a href="casos.html#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;longitud&quot;</span>, <span class="st">&quot;latitud&quot;</span>),</span>
<span id="cb23-5"><a href="casos.html#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">crs =</span> <span class="dv">4326</span></span>
<span id="cb23-6"><a href="casos.html#cb23-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-7"><a href="casos.html#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="casos.html#cb23-8" aria-hidden="true" tabindex="-1"></a>tmin_sf</span>
<span id="cb23-9"><a href="casos.html#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 1066 features and 3 fields</span></span>
<span id="cb23-10"><a href="casos.html#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: POINT</span></span>
<span id="cb23-11"><a href="casos.html#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb23-12"><a href="casos.html#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -9.291389 ymin: 35.27639 xmax: 4.215556 ymax: 43.78611</span></span>
<span id="cb23-13"><a href="casos.html#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb23-14"><a href="casos.html#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1,066 x 4</span></span>
<span id="cb23-15"><a href="casos.html#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    fecha      indicativo  tmin             geometry</span></span>
<span id="cb23-16"><a href="casos.html#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  * &lt;date&gt;     &lt;chr&gt;      &lt;dbl&gt;          &lt;POINT [°]&gt;</span></span>
<span id="cb23-17"><a href="casos.html#cb23-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 2021-01-06 4358X       -4.7 (-5.880556 38.95556)</span></span>
<span id="cb23-18"><a href="casos.html#cb23-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 2021-01-06 4220X       -7   (-4.616389 39.08861)</span></span>
<span id="cb23-19"><a href="casos.html#cb23-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 2021-01-06 6106X        4.7 (-4.748333 37.02944)</span></span>
<span id="cb23-20"><a href="casos.html#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 2021-01-06 9698U       -6.8  (0.865278 42.20528)</span></span>
<span id="cb23-21"><a href="casos.html#cb23-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 2021-01-06 4410X       -3.4 (-6.385556 38.91583)</span></span>
<span id="cb23-22"><a href="casos.html#cb23-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 2021-01-06 1331A        1   (-7.031389 43.52472)</span></span>
<span id="cb23-23"><a href="casos.html#cb23-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 2021-01-06 1690A       -0.1 (-7.859722 42.32528)</span></span>
<span id="cb23-24"><a href="casos.html#cb23-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 2021-01-06 8489X       -8   (-0.255833 40.43333)</span></span>
<span id="cb23-25"><a href="casos.html#cb23-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 2021-01-06 8025         2    (-0.494167 38.3725)</span></span>
<span id="cb23-26"><a href="casos.html#cb23-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 2021-01-06 9784P      -10       (0.224722 42.63)</span></span>
<span id="cb23-27"><a href="casos.html#cb23-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ... with 1,056 more rows</span></span></code></pre></div>
<p>La siguiente tarea será representar las estaciones que monitorizan la
temperatura mínima en un mapa de España.</p>
<div class="exercise">
<p><span id="exr:ex6" class="exercise"><strong>Ejercicio 5.6  (Representación espacial de la clase sf) </strong></span>Represente un mapa de España, con las Comunidades Autónomas de incluidas,
excepto las Islas Canarias (por simplicidad)</p>
</div>
<div class="solution">
<p><span id="sol6" class="solution"><em>Solución</em>. </span>Una opción es utilizar un paquete API que nos proporciona esta información en
formato <code>sf</code>, el paquete <strong>mapSpain</strong>.</p>
</div>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="casos.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapSpain)</span>
<span id="cb24-2"><a href="casos.html#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sf object</span></span>
<span id="cb24-3"><a href="casos.html#cb24-3" aria-hidden="true" tabindex="-1"></a>esp <span class="ot">&lt;-</span> <span class="fu">esp_get_ccaa</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-4"><a href="casos.html#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># No vamos a usar Canarias en este análisis</span></span>
<span id="cb24-5"><a href="casos.html#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ine.ccaa.name <span class="sc">!=</span> <span class="st">&quot;Canarias&quot;</span>)</span>
<span id="cb24-6"><a href="casos.html#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="casos.html#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="casos.html#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(esp<span class="sc">$</span>geometry) <span class="co"># Dibujamos el mapa de España menos las Islas Canarias</span></span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-15"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/unnamed-chunk-15-1.png" alt="Mapa de España (Sin Canarias)" width="60%" />
<p class="caption">
Figura 5.2: Mapa de España (Sin Canarias)
</p>
</div>
<p>Como se comentó en la Sección <a href="formatos.html#CRS">3.3</a>, cuando se emplean datos geográficos
provenientes de varias fuentes, es necesario asegurarse de que ambos objetos
están usando el mismo CRS.</p>
<div class="exercise">
<p><span id="exr:ex7" class="exercise"><strong>Ejercicio 5.7  (Comprobar el CRS de los datos) </strong></span>¿Tengo el Sistema de referencia de coordenadas (CRS) de las estaciones de
monitoreo en la misma proyección que el contorno de España? Compruébelo.</p>
</div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="casos.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(tmin_sf) <span class="sc">==</span> <span class="fu">st_crs</span>(esp)</span>
<span id="cb25-2"><a href="casos.html#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>Se ha comprobado que no lo están, por lo que hay que proyectar las coordenadas a
un CRS común.</p>
<div class="exercise">
<p><span id="exr:ex8" class="exercise"><strong>Ejercicio 5.8  (Cambiar (proyectar) CRS) </strong></span>Proyecte las coordenadas de los objetos <code>tmin_sf</code> y <code>esp</code> al CRS de referencia
de <code>tmin_sf</code>. Compruébelo.</p>
</div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="casos.html#cb26-1" aria-hidden="true" tabindex="-1"></a>esp2 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(esp, <span class="fu">st_crs</span>(tmin_sf))</span>
<span id="cb26-2"><a href="casos.html#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="casos.html#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(tmin_sf) <span class="sc">==</span> <span class="fu">st_crs</span>(esp2)</span>
<span id="cb26-4"><a href="casos.html#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Para dibujar las estaciones de monitoreo con el contorno de España, existen
varias opciones de paquetes, <strong>ggplot2</strong> <span class="citation">(<a href="#ref-R-ggplot" role="doc-biblioref">Wickham 2016</a>)</span> (paquete de referencia en
representaciones gráficas), <strong>tmap</strong> <span class="citation">(<a href="#ref-R-tmap" role="doc-biblioref">Tennekes 2018</a>)</span> o <strong>mapsf</strong> <span class="citation">(<a href="#ref-R-mapsf" role="doc-biblioref">Giraud 2022</a>)</span> (estos dos
últimos especializados en mapas temáticos).</p>
<div class="exercise">
<p><span id="exr:ex9" class="exercise"><strong>Ejercicio 5.9  (Mapa con ggplot2) </strong></span>Represente, con el paquete <strong>ggplot2</strong>, las estaciones de monitorero de AEMET en
la Península Ibérica.</p>
</div>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="casos.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb27-2"><a href="casos.html#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="casos.html#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(esp2) <span class="sc">+</span></span>
<span id="cb27-4"><a href="casos.html#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Para graficar objetos sf debemos usar geom_sf()</span></span>
<span id="cb27-5"><a href="casos.html#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb27-6"><a href="casos.html#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> tmin_sf) <span class="sc">+</span></span>
<span id="cb27-7"><a href="casos.html#cb27-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb27-8"><a href="casos.html#cb27-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb27-9"><a href="casos.html#cb27-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb27-10"><a href="casos.html#cb27-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">12</span>,</span>
<span id="cb27-11"><a href="casos.html#cb27-11" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">&quot;bold&quot;</span></span>
<span id="cb27-12"><a href="casos.html#cb27-12" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb27-13"><a href="casos.html#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(</span>
<span id="cb27-14"><a href="casos.html#cb27-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">8</span>,</span>
<span id="cb27-15"><a href="casos.html#cb27-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">&quot;italic&quot;</span></span>
<span id="cb27-16"><a href="casos.html#cb27-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb27-17"><a href="casos.html#cb27-17" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-17"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/unnamed-chunk-17-1.png" alt="Estaciones de AEMET en la Península Ibérica" width="60%" />
<p class="caption">
Figura 5.3: Estaciones de AEMET en la Península Ibérica
</p>
</div>
<p>Una vez representadas las coordenadas, es decir, las estaciones de monitoreo
dónde se ha medido la variable temperatura mínima <code>tmin</code>, el siguiente paso será
representar el valor que toma la variable en esas coordenadas. La base <code>tmin</code>
contiene información temporal para para varios días, por lo que, como este
análisis es meramente espacial se elegirá un día que se fijará para todo el
análisis.</p>
<div class="exercise">
<p><span id="exr:ex10" class="exercise"><strong>Ejercicio 5.10  (Representar la temperatura mínima en España) </strong></span>Representamos la variable temperatura mínima <code>tmin</code> para el día <strong>8 de enero de
2021</strong>. Guarde la base de datos espacial para ese día en un objeto de nombre
<code>tmin_8enero</code>.</p>
</div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="casos.html#cb28-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-2"><a href="casos.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Seleccionaremos los datos correspondientes al 8 de enero de 2021</span></span>
<span id="cb28-3"><a href="casos.html#cb28-3" aria-hidden="true" tabindex="-1"></a>tmin_8enero <span class="ot">&lt;-</span> tmin_sf <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="casos.html#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fecha <span class="sc">==</span> <span class="st">&quot;2021-01-08&quot;</span>)</span>
<span id="cb28-5"><a href="casos.html#cb28-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-6"><a href="casos.html#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="casos.html#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Mapa temático en el que se representan los valores de temperatura mínima</span></span>
<span id="cb28-8"><a href="casos.html#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"># registrados en cada estación mediante un código de colores</span></span>
<span id="cb28-9"><a href="casos.html#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tmin_8enero[<span class="st">&quot;tmin&quot;</span>],</span>
<span id="cb28-10"><a href="casos.html#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">8</span></span>
<span id="cb28-11"><a href="casos.html#cb28-11" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:plot-base-tmin"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/plot-base-tmin-1.png" alt="Mapa de puntos con temperatura mínima (8-enero-2021)" width="60%" />
<p class="caption">
Figura 5.4: Mapa de puntos con temperatura mínima (8-enero-2021)
</p>
</div>
<p>El mapa ha quedado muy bien, pero quizá los colores y el formato elegido no sean
los más adecuados para este tipo de representaciones…</p>
<div class="exercise">
<p><span id="exr:unlabeled-div-1" class="exercise"><strong>Ejercicio 5.11  (Representar la temperatura mínima con ggplot2) </strong></span>Utilice los parámetros espaciales de los que dispone, las coordenadas y el
contorno de España para graficar y contar la historia de <strong>Filomena</strong>
adecuadamente.</p>
</div>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="casos.html#cb29-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-2"><a href="casos.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Especificamos la paleta de color a utilizar</span></span>
<span id="cb29-3"><a href="casos.html#cb29-3" aria-hidden="true" tabindex="-1"></a>cortes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="cn">Inf</span>, <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">20</span>, <span class="dv">20</span>, <span class="fl">2.5</span>), <span class="cn">Inf</span>)</span>
<span id="cb29-4"><a href="casos.html#cb29-4" aria-hidden="true" tabindex="-1"></a>colores <span class="ot">&lt;-</span> <span class="fu">hcl.colors</span>(<span class="dv">15</span>, <span class="st">&quot;PuOr&quot;</span>, <span class="at">rev =</span> <span class="cn">TRUE</span>)</span>
<span id="cb29-5"><a href="casos.html#cb29-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-6"><a href="casos.html#cb29-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-7"><a href="casos.html#cb29-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb29-8"><a href="casos.html#cb29-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb29-9"><a href="casos.html#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> esp2,</span>
<span id="cb29-10"><a href="casos.html#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;grey99&quot;</span></span>
<span id="cb29-11"><a href="casos.html#cb29-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-12"><a href="casos.html#cb29-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb29-13"><a href="casos.html#cb29-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> tmin_8enero,</span>
<span id="cb29-14"><a href="casos.html#cb29-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">color =</span> tmin),</span>
<span id="cb29-15"><a href="casos.html#cb29-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">4</span>,</span>
<span id="cb29-16"><a href="casos.html#cb29-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> .<span class="dv">7</span></span>
<span id="cb29-17"><a href="casos.html#cb29-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-18"><a href="casos.html#cb29-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">&quot;Temp. mín&quot;</span>) <span class="sc">+</span></span>
<span id="cb29-19"><a href="casos.html#cb29-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradientn</span>(</span>
<span id="cb29-20"><a href="casos.html#cb29-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">colours =</span> colores,</span>
<span id="cb29-21"><a href="casos.html#cb29-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> cortes,</span>
<span id="cb29-22"><a href="casos.html#cb29-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="cf">function</span>(x) {</span>
<span id="cb29-23"><a href="casos.html#cb29-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste0</span>(x, <span class="st">&quot;º&quot;</span>)</span>
<span id="cb29-24"><a href="casos.html#cb29-24" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb29-25"><a href="casos.html#cb29-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">guide =</span> <span class="st">&quot;legend&quot;</span></span>
<span id="cb29-26"><a href="casos.html#cb29-26" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-27"><a href="casos.html#cb29-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb29-28"><a href="casos.html#cb29-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb29-29"><a href="casos.html#cb29-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb29-30"><a href="casos.html#cb29-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">12</span>,</span>
<span id="cb29-31"><a href="casos.html#cb29-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">&quot;bold&quot;</span></span>
<span id="cb29-32"><a href="casos.html#cb29-32" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb29-33"><a href="casos.html#cb29-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(</span>
<span id="cb29-34"><a href="casos.html#cb29-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">8</span>,</span>
<span id="cb29-35"><a href="casos.html#cb29-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">&quot;italic&quot;</span></span>
<span id="cb29-36"><a href="casos.html#cb29-36" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb29-37"><a href="casos.html#cb29-37" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:spatial-plots"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/spatial-plots-1.png" alt="Mapa completo con temperatura mínima (8-enero-2021)" width="60%" />
<p class="caption">
Figura 5.5: Mapa completo con temperatura mínima (8-enero-2021)
</p>
</div>
<p>La visión que ofrece el la Fig. <a href="casos.html#fig:spatial-plots">5.5</a> de Filomena es muy
informativa, vemos como los datos nos cuentan la historia de lo que ocurrió ese
día. La pena es que no existan estaciones de monitoreo en todos los puntos de
España para conocer el valor de la temperatura mínima en cualquier lugar del
país. ¿Podríamos tener un mapa de interpolación para tener una estimación de la
temperatura mínima en las partes donde la AEMET no tiene estación de monitoreo?</p>
<p>Tal y como se avanzó en el Capítulo <a href="dep-esp.html#dep-esp">4</a>, parece lógico pensar que
aquellos puntos que estén cerca tendrán valores similares. Por tanto, tomemos
ventaja de las propiedades de la dependencia espacial y utilicemos un método de
interpolación sencillo, en este caso un método determinista, la Distancia
Inversa Ponderada, comúnmente conocido por su acrónimo inglés IDW (<em>Inverse
Distance Weighted</em>), el cual es uno de los métodos más simples para llevar para
llevar a cabo una interpolación espacial.</p>
<p>En este tipo de análisis espacial, es crucial que el CRS sea el apropiado. En
este caso, ya se definió el CRS como un CRS geográfico (es decir, usando
coordenadas de longitud y latitud). Sin embargo, para el ejercicio de
interpolación es más adecuado usar un CRS local (que provoca pocas deformaciones
en la proyección de España) y en alguna unidad de distancia, como metros (ya se
vio en la Sección <a href="formatos.html#CRS">3.3</a> que en los CRS geográficos las unidades son
grados).</p>
<div class="exercise">
<p><span id="exr:ex11" class="exercise"><strong>Ejercicio 5.12  (Obtención de CRS sugerido para un conjunto de datos) </strong></span>Utilice el paquete <strong>crsuggest</strong> para observar los CRS sugeridos y, si es
necesario, transforme la proyección de los datos.</p>
</div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="casos.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(crsuggest)</span>
<span id="cb30-2"><a href="casos.html#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="casos.html#cb30-3" aria-hidden="true" tabindex="-1"></a>sugiere <span class="ot">&lt;-</span> <span class="fu">suggest_crs</span>(tmin_8enero, <span class="at">units =</span> <span class="st">&quot;m&quot;</span>, <span class="at">limit =</span> <span class="dv">5</span>)</span>
<span id="cb30-4"><a href="casos.html#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="casos.html#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Usamos la sugerencia del paquete</span></span>
<span id="cb30-6"><a href="casos.html#cb30-6" aria-hidden="true" tabindex="-1"></a>crs_sugerido <span class="ot">&lt;-</span> <span class="fu">st_crs</span>(sugiere[<span class="dv">1</span>, ]<span class="sc">$</span>crs_proj4) <span class="co"># Madrid</span></span>
<span id="cb30-7"><a href="casos.html#cb30-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-8"><a href="casos.html#cb30-8" aria-hidden="true" tabindex="-1"></a>esp3 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(esp2, crs_sugerido)</span>
<span id="cb30-9"><a href="casos.html#cb30-9" aria-hidden="true" tabindex="-1"></a>tmin_8enero3 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(tmin_8enero, crs_sugerido)</span></code></pre></div>
<p>Una vez solucionado el problema de las proyecciones, antes de llevar a cabo la
interpolación, es necesario generar una malla que representará las celdas de las
que queremos obtener el valor interpolado. Dado que hemos proyectado nuestros
datos a un CRS cuya unidad son los metros, podemos definir el tamaño de cada
celda en metros cuadrados. En este caso vamos a usar celdas de 100 km cuadrados
(10 x 10 km).</p>
<div class="exercise">
<p><span id="exr:ex12" class="exercise"><strong>Ejercicio 5.13  (Creación y representación de una malla de interpolación) </strong></span>Genere un grid y llámelo <code>malla_sf</code> (puede fijar una semilla si lo desea) y
grafique la superficie construida.</p>
</div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="casos.html#cb31-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-2"><a href="casos.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Generación de la superficie a interpolar</span></span>
<span id="cb31-3"><a href="casos.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">9876</span>) <span class="co"># Aseguramos que el grid generado siempre es igual</span></span>
<span id="cb31-4"><a href="casos.html#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="casos.html#cb31-5" aria-hidden="true" tabindex="-1"></a>malla_sf <span class="ot">&lt;-</span> <span class="fu">st_make_grid</span>(</span>
<span id="cb31-6"><a href="casos.html#cb31-6" aria-hidden="true" tabindex="-1"></a>  esp3,</span>
<span id="cb31-7"><a href="casos.html#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cellsize =</span> <span class="dv">10000</span></span>
<span id="cb31-8"><a href="casos.html#cb31-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-9"><a href="casos.html#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="casos.html#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Representación de la superficie construida añadiendo el contorno de España</span></span>
<span id="cb31-11"><a href="casos.html#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(esp3) <span class="sc">+</span></span>
<span id="cb31-12"><a href="casos.html#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb31-13"><a href="casos.html#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb31-14"><a href="casos.html#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> malla_sf,</span>
<span id="cb31-15"><a href="casos.html#cb31-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.1</span>,</span>
<span id="cb31-16"><a href="casos.html#cb31-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb31-17"><a href="casos.html#cb31-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="cn">NA</span></span>
<span id="cb31-18"><a href="casos.html#cb31-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-19"><a href="casos.html#cb31-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb31-20"><a href="casos.html#cb31-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> tmin_8enero3,</span>
<span id="cb31-21"><a href="casos.html#cb31-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> <span class="st">&quot;AEMET Stations&quot;</span>), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb31-22"><a href="casos.html#cb31-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;blue&quot;</span></span>
<span id="cb31-23"><a href="casos.html#cb31-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-24"><a href="casos.html#cb31-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">adjustcolor</span>(<span class="st">&quot;blue&quot;</span>, <span class="at">alpha.f =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb31-25"><a href="casos.html#cb31-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb31-26"><a href="casos.html#cb31-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:create-grid2"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/create-grid2-1.png" alt="Malla de puntos para interpolación" width="60%" />
<p class="caption">
Figura 5.6: Malla de puntos para interpolación
</p>
</div>
<p>Se puede observar claramente cada una de las celdas que se han creado. La
interpolación asignará un valor a cada uno de ellas.</p>
<p>A continuación podemos llevar a cabo la interpolación usando el paquete
<strong>gstat</strong> <span class="citation">(<a href="#ref-R-gstat" role="doc-biblioref">Pebesma 2004</a>)</span>. Además, en lugar de celdas (polígonos) es necesario usar
puntos en la interpolación. Calcularemos, por tanto, un punto representativo de
cada celda creada en la superficie anterior <code>malla_sf</code>, el centroide, que es el
punto resultante de realizar la media aritmética de las coordenadas de los
puntos que componen los lados de cada celda.</p>
<div class="exercise">
<p><span id="exr:ex13" class="exercise"><strong>Ejercicio 5.14  (Interpolación a través de la Distancia Inversa Ponderada) </strong></span>Calcule los centroides de los polígonos de la malla construida en el Ejercicio
<a href="casos.html#exr:ex12">5.13</a> con la función <code>st_centroid()</code> y realice una interpolación de la
variable temperatura mínima <code>tmin</code> para el día 8 de enero de 2021 con el método
IDW usando la librería <strong>gstat</strong> y la función <code>idw</code>. Guarde el resultado
obtenido en un objeto llamado <code>tmin_idw</code>. Utilice la función <code>help(idw)</code> si
requiere información sobre cómo introducir los parámetros en la función.</p>
<p>Examine la información del objeto <code>tmin_idw</code>, a través de la función <code>head()</code>,</p>
</div>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="casos.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculamos una malla con centroides</span></span>
<span id="cb32-2"><a href="casos.html#cb32-2" aria-hidden="true" tabindex="-1"></a>malla_sf_cent <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(malla_sf, <span class="at">of_largest_polygon =</span> <span class="cn">TRUE</span>)</span>
<span id="cb32-3"><a href="casos.html#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="casos.html#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gstat)</span>
<span id="cb32-5"><a href="casos.html#cb32-5" aria-hidden="true" tabindex="-1"></a>tmin_idw <span class="ot">&lt;-</span> <span class="fu">idw</span>(</span>
<span id="cb32-6"><a href="casos.html#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Indicamos la variable que queremos interpolar</span></span>
<span id="cb32-7"><a href="casos.html#cb32-7" aria-hidden="true" tabindex="-1"></a>  tmin <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb32-8"><a href="casos.html#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Indicamos el conjunto de datos donde está la variable</span></span>
<span id="cb32-9"><a href="casos.html#cb32-9" aria-hidden="true" tabindex="-1"></a>  tmin_8enero3,</span>
<span id="cb32-10"><a href="casos.html#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Indicamos la malla de destino, en sf</span></span>
<span id="cb32-11"><a href="casos.html#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> malla_sf_cent,</span>
<span id="cb32-12"><a href="casos.html#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">idp =</span> <span class="fl">2.0</span> <span class="co"># Especifica la potencia de la IDW</span></span>
<span id="cb32-13"><a href="casos.html#cb32-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-14"><a href="casos.html#cb32-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [inverse distance weighted interpolation]</span></span>
<span id="cb32-15"><a href="casos.html#cb32-15" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tmin_idw)</span>
<span id="cb32-16"><a href="casos.html#cb32-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 6 features and 2 fields</span></span>
<span id="cb32-17"><a href="casos.html#cb32-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: POINT</span></span>
<span id="cb32-18"><a href="casos.html#cb32-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb32-19"><a href="casos.html#cb32-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: 147290.9 ymin: 70457.31 xmax: 197290.9 ymax: 70457.31</span></span>
<span id="cb32-20"><a href="casos.html#cb32-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; CRS:           +proj=lcc +lat_1=40 +lat_0=40 +lon_0=0 +k_0=0.9988085293 +x_0=600000 +y_0=600000 +a=6378298.3 +rf=294.73 +pm=madrid +units=m +no_defs</span></span>
<span id="cb32-21"><a href="casos.html#cb32-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   var1.pred var1.var                  geometry</span></span>
<span id="cb32-22"><a href="casos.html#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  2.529082       NA POINT (147290.9 70457.31)</span></span>
<span id="cb32-23"><a href="casos.html#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  2.615255       NA POINT (157290.9 70457.31)</span></span>
<span id="cb32-24"><a href="casos.html#cb32-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  2.703976       NA POINT (167290.9 70457.31)</span></span>
<span id="cb32-25"><a href="casos.html#cb32-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  2.795295       NA POINT (177290.9 70457.31)</span></span>
<span id="cb32-26"><a href="casos.html#cb32-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5  2.889262       NA POINT (187290.9 70457.31)</span></span>
<span id="cb32-27"><a href="casos.html#cb32-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6  2.985925       NA POINT (197290.9 70457.31)</span></span></code></pre></div>
<p>Un tipo de mapas muy utilizado cuando se trabaja con datos espaciales son los
mapas de contorno. Es muy visual y ayuda a interpretar el mapa interpolado,
añadir unas líneas de contorno al mapa interpolado.</p>
<div class="exercise">
<p><span id="exr:ex14" class="exercise"><strong>Ejercicio 5.15  (Mapa de interpolación y contorno con ráster) </strong></span>Represente los valores interpolados, <code>tmin_idw</code>, y añada unas líneas de
contorno. Utilice el paquete <strong>raster</strong> para convertir el objeto interpolado a
pixeles.</p>
</div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="casos.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertimos de sf a SpatiaPixels</span></span>
<span id="cb33-2"><a href="casos.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Esto funciona porque nuestros puntos sf están espaciados regularmente</span></span>
<span id="cb33-3"><a href="casos.html#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="casos.html#cb33-4" aria-hidden="true" tabindex="-1"></a>tmin_pixels <span class="ot">&lt;-</span> tmin_idw <span class="sc">%&gt;%</span></span>
<span id="cb33-5"><a href="casos.html#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as</span>(<span class="st">&quot;Spatial&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb33-6"><a href="casos.html#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as</span>(<span class="st">&quot;SpatialPixels&quot;</span>)</span>
<span id="cb33-7"><a href="casos.html#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="casos.html#cb33-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-9"><a href="casos.html#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb33-10"><a href="casos.html#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos un ráster de nuestros pixels</span></span>
<span id="cb33-11"><a href="casos.html#cb33-11" aria-hidden="true" tabindex="-1"></a>rast_esp <span class="ot">&lt;-</span> <span class="fu">raster</span>(tmin_pixels)</span>
<span id="cb33-12"><a href="casos.html#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="casos.html#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Transferimos valores del objeto sf al ráster</span></span>
<span id="cb33-14"><a href="casos.html#cb33-14" aria-hidden="true" tabindex="-1"></a>rast_esp2 <span class="ot">&lt;-</span> <span class="fu">rasterize</span>(</span>
<span id="cb33-15"><a href="casos.html#cb33-15" aria-hidden="true" tabindex="-1"></a>  tmin_idw,</span>
<span id="cb33-16"><a href="casos.html#cb33-16" aria-hidden="true" tabindex="-1"></a>  rast_esp,</span>
<span id="cb33-17"><a href="casos.html#cb33-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">field =</span> <span class="st">&quot;var1.pred&quot;</span>, <span class="do">## valores de predicción idw</span></span>
<span id="cb33-18"><a href="casos.html#cb33-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun =</span> mean</span>
<span id="cb33-19"><a href="casos.html#cb33-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb33-20"><a href="casos.html#cb33-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-21"><a href="casos.html#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Además, podemos recortar el ráster a la forma de España</span></span>
<span id="cb33-22"><a href="casos.html#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="casos.html#cb33-23" aria-hidden="true" tabindex="-1"></a>rast_esp_mask <span class="ot">&lt;-</span> <span class="fu">mask</span>(rast_esp2, esp3)</span>
<span id="cb33-24"><a href="casos.html#cb33-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-25"><a href="casos.html#cb33-25" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rast_esp_mask, <span class="at">col =</span> colores)</span>
<span id="cb33-26"><a href="casos.html#cb33-26" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(rast_esp2, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-20"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/unnamed-chunk-20-1.png" alt="Mapa ráster con líneas de nivel" width="60%" />
<p class="caption">
Figura 5.7: Mapa ráster con líneas de nivel
</p>
</div>
<div class="exercise">
<p><span id="exr:ex15" class="exercise"><strong>Ejercicio 5.16  (Mapa de interpolación con ggplot2) </strong></span>Repita el mapa de <a href="casos.html#exr:ex14">5.15</a> usando <strong>ggplot2</strong> y la función
<code>geom_contour_filled()</code>.</p>
</div>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="casos.html#cb34-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-2"><a href="casos.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos una tabla para geom contour</span></span>
<span id="cb34-3"><a href="casos.html#cb34-3" aria-hidden="true" tabindex="-1"></a>coordenadas <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(tmin_idw)</span>
<span id="cb34-4"><a href="casos.html#cb34-4" aria-hidden="true" tabindex="-1"></a>valor <span class="ot">&lt;-</span> tmin_idw<span class="sc">$</span>var1.pred</span>
<span id="cb34-5"><a href="casos.html#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="casos.html#cb34-6" aria-hidden="true" tabindex="-1"></a>idw_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb34-7"><a href="casos.html#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Necesitamos redondear las coordenadas</span></span>
<span id="cb34-8"><a href="casos.html#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">latitud =</span> <span class="fu">round</span>(coordenadas[, <span class="dv">2</span>], <span class="dv">6</span>),</span>
<span id="cb34-9"><a href="casos.html#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">longitud =</span> <span class="fu">round</span>(coordenadas[, <span class="dv">1</span>], <span class="dv">6</span>),</span>
<span id="cb34-10"><a href="casos.html#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">tmin =</span> valor</span>
<span id="cb34-11"><a href="casos.html#cb34-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb34-12"><a href="casos.html#cb34-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-13"><a href="casos.html#cb34-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb34-14"><a href="casos.html#cb34-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour_filled</span>(</span>
<span id="cb34-15"><a href="casos.html#cb34-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> idw_df,</span>
<span id="cb34-16"><a href="casos.html#cb34-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> longitud, <span class="at">y =</span> latitud, <span class="at">z =</span> tmin),</span>
<span id="cb34-17"><a href="casos.html#cb34-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb34-18"><a href="casos.html#cb34-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> cortes</span>
<span id="cb34-19"><a href="casos.html#cb34-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-20"><a href="casos.html#cb34-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reajustamos la escala de colores</span></span>
<span id="cb34-21"><a href="casos.html#cb34-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colores) <span class="sc">+</span></span>
<span id="cb34-22"><a href="casos.html#cb34-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># CCAA</span></span>
<span id="cb34-23"><a href="casos.html#cb34-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> esp3, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb34-24"><a href="casos.html#cb34-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-25"><a href="casos.html#cb34-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb34-26"><a href="casos.html#cb34-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-27"><a href="casos.html#cb34-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Temp. (º)&quot;</span></span>
<span id="cb34-28"><a href="casos.html#cb34-28" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-21"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/unnamed-chunk-21-1.png" alt="Temperatura mínima interpolada. 8 de Enero 2021. " width="60%" />
<p class="caption">
Figura 5.8: Temperatura mínima interpolada. 8 de Enero 2021.
</p>
</div>
</div>
<div id="caso-2.-distribución-de-la-renta-por-municipios" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Caso 2. Distribución de la renta por municipios</h2>
<p><strong>Objetivos de aprendizaje</strong></p>
<p>Esta sección presenta un caso de uso en el que aprenderemos a realizar las
siguientes tareas básicas:</p>
<ul>
<li><p>Importar datos tabulares y datos espaciales.</p></li>
<li><p>Realizar un tratamiento de limpieza de datos y cruzar tablas.</p></li>
<li><p>Hacer mapas temáticos. Aprenderemos también algunas nociones básicas sobre
cómo crear diferentes clases para un conjunto de datos continuo.</p></li>
</ul>
<p>Para ello, partiremos de dos ficheros:</p>
<ol style="list-style-type: decimal">
<li><p>Fichero <code>renta_municipio.csv</code>: Este fichero contiene información de la Renta
Neta per cápita por municipios (en euros), distritos y secciones censales.
Esta información se ha extraído del <a href="https://www.ine.es/experimental/atlas/experimental_atlas.htm">Atlas de distribución de renta de los
hogares</a>
proporcionado por el INE, y ha sido tratado previamente para adaptar la
información al presente ejercicio.</p></li>
<li><p>Fichero <code>municipios.gpkg</code>: Es un fichero que contiene datos espaciales
(polígonos) de los municipios en España en el año 2019. Se ha extraído del
Instituto Geográfico Nacional (IGN) usando el paquete <strong>mapSpain</strong>.</p></li>
</ol>
<div class="exercise">
<p><span id="exr:ex-crearenta" class="exercise"><strong>Ejercicio 5.17  (Renta: Creación del proyecto) </strong></span>Cree un proyecto para trabajar todo lo referente al caso.</p>
</div>
<div class="solution">
<p><span id="sol-crearenta" class="solution"><em>Solución</em>. </span>Véase la solución del Ejercicio <a href="casos.html#exr:ex-crea">5.1</a></p>
</div>
<p>El primer paso en cualquier tipo de análisis de datos es importar los datos al
software de tratamiento (en nuestro caso, <strong>R</strong>) y analizarlos para conocer el
tipo de información que contiene.</p>
<div class="exercise">
<p><span id="exr:ex16" class="exercise"><strong>Ejercicio 5.18  (Importación y análisis de los datos objeto de estudio) </strong></span>Importe el fichero de datos <code>renta_municipio.csv</code> y <code>municipios.gpkg</code> y guárdelo
en un objeto llamado <code>renta</code> y <code>munis</code>, respectivamente. Observe la información
que contienen. Puede ayudarse de la función <code>head.</code> Use las librerías oportunas
para importar los datos en los distintos formatos.</p>
</div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="casos.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Usaremos paquetes del tidyverse</span></span>
<span id="cb35-2"><a href="casos.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb35-3"><a href="casos.html#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb35-4"><a href="casos.html#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="casos.html#cb35-5" aria-hidden="true" tabindex="-1"></a>renta <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/renta_municipio.csv&quot;</span>, <span class="at">na =</span> <span class="st">&quot;.&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="casos.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb36-2"><a href="casos.html#cb36-2" aria-hidden="true" tabindex="-1"></a>munis <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;data/municipios.gpkg&quot;</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="casos.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(renta)</span>
<span id="cb37-2"><a href="casos.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 x 6</span></span>
<span id="cb37-3"><a href="casos.html#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Unidad                          `2019` `2018` `2017` `2016` `2015`</span></span>
<span id="cb37-4"><a href="casos.html#cb37-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                            &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb37-5"><a href="casos.html#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 44001 Ababuj                        NA     NA     NA     NA     NA</span></span>
<span id="cb37-6"><a href="casos.html#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 4400101 Ababuj distrito 01          NA     NA     NA     NA     NA</span></span>
<span id="cb37-7"><a href="casos.html#cb37-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 4400101001 Ababuj sección 01001     NA     NA     NA     NA     NA</span></span>
<span id="cb37-8"><a href="casos.html#cb37-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 40001 Abades                     11429  10731  10314   9816   9904</span></span>
<span id="cb37-9"><a href="casos.html#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 4000101 Abades distrito 01       11429  10731  10314   9816   9904</span></span>
<span id="cb37-10"><a href="casos.html#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 4000101001 Abades sección 01001  11429  10731  10314   9816   9904</span></span></code></pre></div>
<p>Se puede comprobar que tenemos información para el periodo 2015-2019. Además, la
columna <code>Unidad</code> contiene un literal con el municipio o sección correspondiente.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="casos.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(munis)</span>
<span id="cb38-2"><a href="casos.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 6 features and 7 fields</span></span>
<span id="cb38-3"><a href="casos.html#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb38-4"><a href="casos.html#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb38-5"><a href="casos.html#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -3.140179 ymin: 36.73817 xmax: -2.057058 ymax: 37.54579</span></span>
<span id="cb38-6"><a href="casos.html#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  ETRS89</span></span>
<span id="cb38-7"><a href="casos.html#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   codauto ine.ccaa.name cpro ine.prov.name cmun      name LAU_CODE</span></span>
<span id="cb38-8"><a href="casos.html#cb38-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1      01     Andalucía   04       Almería  001      Abla    04001</span></span>
<span id="cb38-9"><a href="casos.html#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2      01     Andalucía   04       Almería  002  Abrucena    04002</span></span>
<span id="cb38-10"><a href="casos.html#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3      01     Andalucía   04       Almería  003      Adra    04003</span></span>
<span id="cb38-11"><a href="casos.html#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4      01     Andalucía   04       Almería  004 Albanchez    04004</span></span>
<span id="cb38-12"><a href="casos.html#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5      01     Andalucía   04       Almería  005 Alboloduy    04005</span></span>
<span id="cb38-13"><a href="casos.html#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6      01     Andalucía   04       Almería  006     Albox    04006</span></span>
<span id="cb38-14"><a href="casos.html#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                             geom</span></span>
<span id="cb38-15"><a href="casos.html#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 MULTIPOLYGON (((-2.775594 3...</span></span>
<span id="cb38-16"><a href="casos.html#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 MULTIPOLYGON (((-2.787566 3...</span></span>
<span id="cb38-17"><a href="casos.html#cb38-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 MULTIPOLYGON (((-3.051988 3...</span></span>
<span id="cb38-18"><a href="casos.html#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 MULTIPOLYGON (((-2.181086 3...</span></span>
<span id="cb38-19"><a href="casos.html#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 MULTIPOLYGON (((-2.572442 3...</span></span>
<span id="cb38-20"><a href="casos.html#cb38-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 MULTIPOLYGON (((-2.128106 3...</span></span></code></pre></div>
<p>El objeto <code>munis</code> contiene polígonos y varias columnas, entre ellas dos
especialmente relevantes: <code>cpro</code> y <code>cmun</code>, que corresponden a los códigos de
provincia y de municipio respectivamente. Podemos comprobar que este código
también se encuentra en el dataset <code>renta</code>.</p>
<div class="exercise">
<p><span id="exr:ex17" class="exercise"><strong>Ejercicio 5.19  (Comprobación de campos en común para un municipio: Noblejas) </strong></span>Para comprobar que efectivamente disponemos de dos campos en común en los
ficheros, que serán de vital importancia para posteriormente unirlos, se
selecciona un municipio al azar, el municipio de Noblejas en la provincia de
Toledo y comprobamos.</p>
</div>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="casos.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Miramos un municipio: Noblejas</span></span>
<span id="cb39-2"><a href="casos.html#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="casos.html#cb39-3" aria-hidden="true" tabindex="-1"></a>renta[<span class="fu">grep</span>(<span class="st">&quot;Noblejas&quot;</span>, renta<span class="sc">$</span>Unidad), ]</span>
<span id="cb39-4"><a href="casos.html#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 x 6</span></span>
<span id="cb39-5"><a href="casos.html#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Unidad                            `2019` `2018` `2017` `2016` `2015`</span></span>
<span id="cb39-6"><a href="casos.html#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                              &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb39-7"><a href="casos.html#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 45115 Noblejas                     10591  10314   9751   9484   9124</span></span>
<span id="cb39-8"><a href="casos.html#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 4511501 Noblejas distrito 01       11039  10717  10135   9711   9386</span></span>
<span id="cb39-9"><a href="casos.html#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 4511501001 Noblejas sección 01001  11039  10717  10135   9711   9386</span></span>
<span id="cb39-10"><a href="casos.html#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 4511502 Noblejas distrito 02       10276  10029   9475   9319   8938</span></span>
<span id="cb39-11"><a href="casos.html#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 4511502001 Noblejas sección 02001  10276  10029   9475   9319   8938</span></span>
<span id="cb39-12"><a href="casos.html#cb39-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-13"><a href="casos.html#cb39-13" aria-hidden="true" tabindex="-1"></a>munis[<span class="fu">grep</span>(<span class="st">&quot;Noblejas&quot;</span>, munis<span class="sc">$</span>name), <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;cpro&quot;</span>, <span class="st">&quot;cmun&quot;</span>)]</span>
<span id="cb39-14"><a href="casos.html#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 1 feature and 3 fields</span></span>
<span id="cb39-15"><a href="casos.html#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb39-16"><a href="casos.html#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb39-17"><a href="casos.html#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -3.489824 ymin: 39.93003 xmax: -3.372611 ymax: 40.05017</span></span>
<span id="cb39-18"><a href="casos.html#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  ETRS89</span></span>
<span id="cb39-19"><a href="casos.html#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          name cpro cmun                           geom</span></span>
<span id="cb39-20"><a href="casos.html#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4985 Noblejas   45  115 MULTIPOLYGON (((-3.44681 40...</span></span></code></pre></div>
<p>En el caso de Noblejas, el código completo es <strong>45115</strong>. Sin embargo, en el caso
de la tabla <code>renta</code>, debemos extraer ese valor del literal, ya que no tenemos
este valor directamente, sino en combinación con otros valores (“<strong>45115
Noblejas</strong>”). Para conseguir extraer un campo adecuado para el cruce en la tabla
<code>renta</code> que contenga únicamente el código numérico vamos a hacer la siguiente
manipulación de datos:</p>
<ul>
<li><p>Para cada valor de la columna <code>Unidad</code>, dividiremos el texto usando los
espacios como delimitadores (<code>"45115 Noblejas"</code> pasará a ser
<code>c("45115", "Noblejas")</code>) y extraeremos el código como el primer valor del
vector (<code>c("45115", "Noblejas")[1]</code> extrae el primer valor del vector, es
decir, <code>"45115"</code>).</p></li>
<li><p>Usaremos ese resultado para crear una nueva columna <code>codigo_ine</code> que
usaremos como campo para realizar el cruce.</p></li>
</ul>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="casos.html#cb40-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-2"><a href="casos.html#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Creo una función y la aplico a toda la columna</span></span>
<span id="cb40-3"><a href="casos.html#cb40-3" aria-hidden="true" tabindex="-1"></a>extrae_codigo <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb40-4"><a href="casos.html#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>(<span class="fu">strsplit</span>(x, <span class="st">&quot; &quot;</span>))[<span class="dv">1</span>]</span>
<span id="cb40-5"><a href="casos.html#cb40-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb40-6"><a href="casos.html#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="casos.html#cb40-7" aria-hidden="true" tabindex="-1"></a>renta<span class="sc">$</span>codigo_ine <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">as.character</span>(renta<span class="sc">$</span>Unidad), extrae_codigo)</span>
<span id="cb40-8"><a href="casos.html#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="casos.html#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(renta[<span class="fu">c</span>(<span class="st">&quot;Unidad&quot;</span>, <span class="st">&quot;codigo_ine&quot;</span>)])</span>
<span id="cb40-10"><a href="casos.html#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 x 2</span></span>
<span id="cb40-11"><a href="casos.html#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Unidad                          codigo_ine</span></span>
<span id="cb40-12"><a href="casos.html#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                           &lt;chr&gt;     </span></span>
<span id="cb40-13"><a href="casos.html#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 44001 Ababuj                    44001     </span></span>
<span id="cb40-14"><a href="casos.html#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 4400101 Ababuj distrito 01      4400101   </span></span>
<span id="cb40-15"><a href="casos.html#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 4400101001 Ababuj sección 01001 4400101001</span></span>
<span id="cb40-16"><a href="casos.html#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 40001 Abades                    40001     </span></span>
<span id="cb40-17"><a href="casos.html#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 4000101 Abades distrito 01      4000101   </span></span>
<span id="cb40-18"><a href="casos.html#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 4000101001 Abades sección 01001 4000101001</span></span></code></pre></div>
<p>Ahora, es necesario crear la misma variable en <code>munis</code> para poder realizar el
cruce:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="casos.html#cb41-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-2"><a href="casos.html#cb41-2" aria-hidden="true" tabindex="-1"></a>munis<span class="sc">$</span>codigo_ine <span class="ot">&lt;-</span> <span class="fu">paste0</span>(munis<span class="sc">$</span>cpro, munis<span class="sc">$</span>cmun)</span>
<span id="cb41-3"><a href="casos.html#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="casos.html#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(munis[, <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;codigo_ine&quot;</span>)])</span>
<span id="cb41-5"><a href="casos.html#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 6 features and 2 fields</span></span>
<span id="cb41-6"><a href="casos.html#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb41-7"><a href="casos.html#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb41-8"><a href="casos.html#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -3.140179 ymin: 36.73817 xmax: -2.057058 ymax: 37.54579</span></span>
<span id="cb41-9"><a href="casos.html#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  ETRS89</span></span>
<span id="cb41-10"><a href="casos.html#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        name codigo_ine                           geom</span></span>
<span id="cb41-11"><a href="casos.html#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1      Abla      04001 MULTIPOLYGON (((-2.775594 3...</span></span>
<span id="cb41-12"><a href="casos.html#cb41-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  Abrucena      04002 MULTIPOLYGON (((-2.787566 3...</span></span>
<span id="cb41-13"><a href="casos.html#cb41-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3      Adra      04003 MULTIPOLYGON (((-3.051988 3...</span></span>
<span id="cb41-14"><a href="casos.html#cb41-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Albanchez      04004 MULTIPOLYGON (((-2.181086 3...</span></span>
<span id="cb41-15"><a href="casos.html#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Alboloduy      04005 MULTIPOLYGON (((-2.572442 3...</span></span>
<span id="cb41-16"><a href="casos.html#cb41-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6     Albox      04006 MULTIPOLYGON (((-2.128106 3...</span></span></code></pre></div>
<p>Ya estamos listos para realizar el cruce. Además, seleccionaremos sólo las
columnas que vamos a usar, en este caso la del año 2019.</p>
<div class="exercise">
<p><span id="exr:ex18" class="exercise"><strong>Ejercicio 5.20  (Unión de objetos renta y mapas) </strong></span>Realice la unión de los objetos con la función <code>left_join()</code> y seleccione las
variables <code>name</code>, <code>cpro</code>, <code>cmun</code>, <code>2019</code>. Guarde el resultado obtenido en un
nuevo objeto llamado <code>munis_renta</code>.</p>
</div>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="casos.html#cb42-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-2"><a href="casos.html#cb42-2" aria-hidden="true" tabindex="-1"></a>munis_renta <span class="ot">&lt;-</span> munis <span class="sc">%&gt;%</span></span>
<span id="cb42-3"><a href="casos.html#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(renta) <span class="sc">%&gt;%</span></span>
<span id="cb42-4"><a href="casos.html#cb42-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name, cpro, cmun, <span class="st">`</span><span class="at">2019</span><span class="st">`</span>)</span></code></pre></div>
<p><strong>Cuando crucemos datos espaciales con datos no espaciales en</strong> R<strong>, es
importante que el primer dataset sea el que contiene los datos espaciales</strong>.
Esto es así porque el objeto resultante “hereda” la clase del primer objeto.</p>
<p>A modo de ejemplo, si realizáramos el proceso poniendo los datos espaciales en
el lado derecho del join, los datos finales no serán espaciales:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="casos.html#cb43-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-2"><a href="casos.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Miramos la clase de munis_renta</span></span>
<span id="cb43-3"><a href="casos.html#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="casos.html#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(munis_renta)</span>
<span id="cb43-5"><a href="casos.html#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;sf&quot;         &quot;data.frame&quot;</span></span>
<span id="cb43-6"><a href="casos.html#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="casos.html#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Es un sf, por tanto espacial</span></span>
<span id="cb43-8"><a href="casos.html#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="casos.html#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Que pasa si realizamos el cruce de la otra manera?</span></span>
<span id="cb43-10"><a href="casos.html#cb43-10" aria-hidden="true" tabindex="-1"></a>renta <span class="sc">%&gt;%</span></span>
<span id="cb43-11"><a href="casos.html#cb43-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(munis) <span class="sc">%&gt;%</span></span>
<span id="cb43-12"><a href="casos.html#cb43-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name, cpro, cmun, <span class="st">`</span><span class="at">2019</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-13"><a href="casos.html#cb43-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>()</span>
<span id="cb43-14"><a href="casos.html#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span></span></code></pre></div>
<p>El resultado es un tibble o data.frame, <strong>¡pero no es espacial!</strong></p>
<p>Una vez que tenemos los datos unidos podemos realizar algunos análisis básicos,
como la realización de un histograma.</p>
<div class="exercise">
<p><span id="exr:ex19" class="exercise"><strong>Ejercicio 5.21  (Histograma de la variable Renta neta media por persona (€)) </strong></span>A través de un histograma represente la distribución de la variable Renta neta
media por persona del objeto <code>munis_renta</code> para el año 2019.</p>
</div>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="casos.html#cb44-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-2"><a href="casos.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb44-3"><a href="casos.html#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="casos.html#cb44-4" aria-hidden="true" tabindex="-1"></a>munis_renta <span class="sc">%&gt;%</span></span>
<span id="cb44-5"><a href="casos.html#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">2019</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb44-6"><a href="casos.html#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb44-7"><a href="casos.html#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_auto</span>()) <span class="sc">+</span></span>
<span id="cb44-8"><a href="casos.html#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb44-9"><a href="casos.html#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb44-10"><a href="casos.html#cb44-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb44-11"><a href="casos.html#cb44-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Renta neta media por persona (€)&quot;</span></span>
<span id="cb44-12"><a href="casos.html#cb44-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:basic"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/basic-1.png" alt="Histograma de la variable Renta neta media por persona (€) en 2019" width="60%" />
<p class="caption">
Figura 5.9: Histograma de la variable Renta neta media por persona (€) en 2019
</p>
</div>
<p>Se puede observar que la renta presenta una distribución Gamma con un gran
número de municipios concentrados en zonas medias de renta y pocos municipios en
tramos de rentas altas. Como se verá en el Ejercicio <a href="casos.html#exr:ex20">5.22</a>, esta
distribución va a afectar a la información que transmite el mapa.</p>
<div class="exercise">
<p><span id="exr:ex20" class="exercise"><strong>Ejercicio 5.22  (Mapa de coropletas de la distribución de la renta) </strong></span>Realice un mapa de coropletas mostrando la distribución de la renta usando los
valores brutos de renta sin modificar</p>
</div>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="casos.html#cb45-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-2"><a href="casos.html#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(munis_renta) <span class="sc">+</span></span>
<span id="cb45-3"><a href="casos.html#cb45-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Usamos geom_sf, y como aes() lo que queremos mostrar, en este caso, el</span></span>
<span id="cb45-4"><a href="casos.html#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># color del polígono representa la renta. Vamos a retirar los bordes con</span></span>
<span id="cb45-5"><a href="casos.html#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># color = NA</span></span>
<span id="cb45-6"><a href="casos.html#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="st">`</span><span class="at">2019</span><span class="st">`</span>), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb45-7"><a href="casos.html#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb45-8"><a href="casos.html#cb45-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(</span>
<span id="cb45-9"><a href="casos.html#cb45-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">big.mark =</span> <span class="st">&quot;.&quot;</span>,</span>
<span id="cb45-10"><a href="casos.html#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimal.mark =</span> <span class="st">&quot;,&quot;</span>,</span>
<span id="cb45-11"><a href="casos.html#cb45-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">suffix =</span> <span class="st">&quot; €&quot;</span></span>
<span id="cb45-12"><a href="casos.html#cb45-12" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb45-13"><a href="casos.html#cb45-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:maparenta1"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/maparenta1-1.png" alt="Renta neta media por persona en España (2019)" width="60%" />
<p class="caption">
Figura 5.10: Renta neta media por persona en España (2019)
</p>
</div>
<p>Este primer mapa (Fig. <a href="casos.html#fig:maparenta1">5.10</a>) no es demasiado informativo, por
los siguientes motivos:</p>
<ul>
<li><p>Existe una serie de municipios para los que no tenemos datos.</p></li>
<li><p>La escala de color no es la más adecuada.</p></li>
<li><p>Dada la distribución de los datos, puede ser adecuado crear grupos de renta
para que el mapa sea más interpretable.</p></li>
</ul>
<div class="exercise">
<p><span id="exr:ex21" class="exercise"><strong>Ejercicio 5.23  (Adecuación de los datos a la visualización) </strong></span>Elimine los municipios sin datos y a cambie la escala de color para ver si
mejora la visualización de la variable Renta neta media por persona.</p>
</div>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="casos.html#cb46-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-2"><a href="casos.html#cb46-2" aria-hidden="true" tabindex="-1"></a>munis_renta_clean <span class="ot">&lt;-</span> munis_renta <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">2019</span><span class="st">`</span>))</span>
<span id="cb46-3"><a href="casos.html#cb46-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-4"><a href="casos.html#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(munis_renta_clean) <span class="sc">+</span></span>
<span id="cb46-5"><a href="casos.html#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="st">`</span><span class="at">2019</span><span class="st">`</span>), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb46-6"><a href="casos.html#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cambiamos la paleta de colores, vamos a usar una paleta denominada Inferno,</span></span>
<span id="cb46-7"><a href="casos.html#cb46-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ya incluida en base R con hcl.colors</span></span>
<span id="cb46-8"><a href="casos.html#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="casos.html#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Como son datos continuos, puedo usar Inferno</span></span>
<span id="cb46-10"><a href="casos.html#cb46-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(</span>
<span id="cb46-11"><a href="casos.html#cb46-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">colours =</span> <span class="fu">hcl.colors</span>(<span class="dv">20</span>, <span class="st">&quot;Inferno&quot;</span>, <span class="at">rev =</span> <span class="cn">TRUE</span>),</span>
<span id="cb46-12"><a href="casos.html#cb46-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(</span>
<span id="cb46-13"><a href="casos.html#cb46-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">big.mark =</span> <span class="st">&quot;.&quot;</span>,</span>
<span id="cb46-14"><a href="casos.html#cb46-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">decimal.mark =</span> <span class="st">&quot;,&quot;</span>,</span>
<span id="cb46-15"><a href="casos.html#cb46-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">suffix =</span> <span class="st">&quot; €&quot;</span></span>
<span id="cb46-16"><a href="casos.html#cb46-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb46-17"><a href="casos.html#cb46-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb46-18"><a href="casos.html#cb46-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:maparenta2"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/maparenta2-1.png" alt="Renta neta media por persona en España (2019)" width="60%" />
<p class="caption">
Figura 5.11: Renta neta media por persona en España (2019)
</p>
</div>
<p>Este mapa (Fig. <a href="casos.html#fig:maparenta2">5.11</a>) proporciona algo más de información, y
parece intuirse que las rentas más altas se encuentran en zonas de País Vasco,
Madrid y Cataluña. Sin embargo, el hecho de que la distribución de los datos no
sea normal está afectando a la visualización.</p>
<p>Para intentar atajar este problema, se puede dividir los datos en clases, por
ejemplo, cuartiles o deciles. Existen varios métodos de clasificación de datos,
que en <strong>R</strong> se encuentran implementados en el paquete <strong>classInt</strong>
<span class="citation">(<a href="#ref-R-classint" role="doc-biblioref">R. Bivand 2020</a>)</span>. A continuación se van a plantear diversos métodos de
clasificación y se observará cómo la “historia” que cuenta el mapa varía en
función de dichas clases. Se proponen siguientes métodos de clasificación:</p>
<ul>
<li><p><strong>El método de deciles</strong>: consiste en crear 10 categorías incluyendo el
mismo número de registros en cada una de ellas.</p></li>
<li><p><strong>El método de intervalos equivalentes</strong>: divide el rango de valores en un
número de grupos definido. La distancia de todos los intervalos es idéntica,
por lo que este método no tiene en cuenta la distribución de los registros.</p></li>
<li><p><strong>El método de Fisher-Jenks</strong>: desarrollado específicamente para la
clasificación de datos espaciales y su visualización en mapas. Produce
agrupaciones de tal manera que los datos de cada grupo son “cercanas” entre
sí y sustancialmente distintas de los valores de otros grupos.</p></li>
</ul>
<div class="exercise">
<p><span id="exr:ex22" class="exercise"><strong>Ejercicio 5.24  (División de los datos en clases) </strong></span>Utilice la función <code>classIntervals()</code> del paquete <strong>classInt</strong> y cambie el
parámetro <code>style</code> para obtener los métodos de clasificación: Deciles, tramos de
Renta equidistantes y Fisher and Jenks.</p>
<p>Realice un <code>plot</code> de las clases obtenidas y compárelas.</p>
</div>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="casos.html#cb47-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2"><a href="casos.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(classInt)</span>
<span id="cb47-3"><a href="casos.html#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="casos.html#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="co"># División en deciles</span></span>
<span id="cb47-5"><a href="casos.html#cb47-5" aria-hidden="true" tabindex="-1"></a>deciles <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(munis_renta_clean<span class="sc">$</span><span class="st">`</span><span class="at">2019</span><span class="st">`</span>,</span>
<span id="cb47-6"><a href="casos.html#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">style =</span> <span class="st">&quot;quantile&quot;</span>, <span class="at">n =</span> <span class="dv">10</span></span>
<span id="cb47-7"><a href="casos.html#cb47-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb47-8"><a href="casos.html#cb47-8" aria-hidden="true" tabindex="-1"></a>deciles</span>
<span id="cb47-9"><a href="casos.html#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; style: quantile</span></span>
<span id="cb47-10"><a href="casos.html#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     [5898,8935.6)   [8935.6,9662.2)  [9662.2,10352.8)   [10352.8,10918) </span></span>
<span id="cb47-11"><a href="casos.html#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               656               656               655               654 </span></span>
<span id="cb47-12"><a href="casos.html#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     [10918,11462)   [11462,11998.6) [11998.6,12651.4) [12651.4,13475.8) </span></span>
<span id="cb47-13"><a href="casos.html#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               655               658               656               655 </span></span>
<span id="cb47-14"><a href="casos.html#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [13475.8,14618.4)   [14618.4,26367] </span></span>
<span id="cb47-15"><a href="casos.html#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               656               656</span></span>
<span id="cb47-16"><a href="casos.html#cb47-16" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(deciles, <span class="at">pal =</span> <span class="fu">hcl.colors</span>(<span class="dv">20</span>, <span class="st">&quot;Inferno&quot;</span>), <span class="at">main =</span> <span class="st">&quot;Deciles&quot;</span>)</span></code></pre></div>
<p><img src="Visualización_geolocalización_datos_files/figure-html/classint-1.png" width="60%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="casos.html#cb48-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-2"><a href="casos.html#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="casos.html#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Tramos equidistantes en términos de renta</span></span>
<span id="cb48-4"><a href="casos.html#cb48-4" aria-hidden="true" tabindex="-1"></a>equal <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(munis_renta_clean<span class="sc">$</span><span class="st">`</span><span class="at">2019</span><span class="st">`</span>,</span>
<span id="cb48-5"><a href="casos.html#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">style =</span> <span class="st">&quot;equal&quot;</span>, <span class="at">n =</span> <span class="dv">10</span></span>
<span id="cb48-6"><a href="casos.html#cb48-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-7"><a href="casos.html#cb48-7" aria-hidden="true" tabindex="-1"></a>equal</span>
<span id="cb48-8"><a href="casos.html#cb48-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; style: equal</span></span>
<span id="cb48-9"><a href="casos.html#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     [5898,7944.9)   [7944.9,9991.8)  [9991.8,12038.7) [12038.7,14085.6) </span></span>
<span id="cb48-10"><a href="casos.html#cb48-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               103              1510              2374              1637 </span></span>
<span id="cb48-11"><a href="casos.html#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [14085.6,16132.5) [16132.5,18179.4) [18179.4,20226.3) [20226.3,22273.2) </span></span>
<span id="cb48-12"><a href="casos.html#cb48-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               702               161                52                14 </span></span>
<span id="cb48-13"><a href="casos.html#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [22273.2,24320.1)   [24320.1,26367] </span></span>
<span id="cb48-14"><a href="casos.html#cb48-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                 3                 1</span></span>
<span id="cb48-15"><a href="casos.html#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(equal, <span class="at">pal =</span> <span class="fu">hcl.colors</span>(<span class="dv">20</span>, <span class="st">&quot;Inferno&quot;</span>), <span class="at">main =</span> <span class="st">&quot;Equidistantes&quot;</span>)</span></code></pre></div>
<p><img src="Visualización_geolocalización_datos_files/figure-html/classint-2.png" width="60%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="casos.html#cb49-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-2"><a href="casos.html#cb49-2" aria-hidden="true" tabindex="-1"></a>fisher <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(munis_renta_clean<span class="sc">$</span><span class="st">`</span><span class="at">2019</span><span class="st">`</span>,</span>
<span id="cb49-3"><a href="casos.html#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">style =</span> <span class="st">&quot;fisher&quot;</span>,</span>
<span id="cb49-4"><a href="casos.html#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fuerzo para mejorar la comparación entre métodos</span></span>
<span id="cb49-5"><a href="casos.html#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">10</span></span>
<span id="cb49-6"><a href="casos.html#cb49-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-7"><a href="casos.html#cb49-7" aria-hidden="true" tabindex="-1"></a>fisher</span>
<span id="cb49-8"><a href="casos.html#cb49-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; style: fisher</span></span>
<span id="cb49-9"><a href="casos.html#cb49-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       [5898,8743)     [8743,9770.5)    [9770.5,10754)     [10754,11689) </span></span>
<span id="cb49-10"><a href="casos.html#cb49-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               505               904              1005              1159 </span></span>
<span id="cb49-11"><a href="casos.html#cb49-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     [11689,12668)     [12668,13803)   [13803,15222.5) [15222.5,17196.5) </span></span>
<span id="cb49-12"><a href="casos.html#cb49-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;              1032               874               651               305 </span></span>
<span id="cb49-13"><a href="casos.html#cb49-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [17196.5,20063.5)   [20063.5,26367] </span></span>
<span id="cb49-14"><a href="casos.html#cb49-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               103                19</span></span>
<span id="cb49-15"><a href="casos.html#cb49-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fisher,</span>
<span id="cb49-16"><a href="casos.html#cb49-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> <span class="fu">hcl.colors</span>(<span class="dv">20</span>, <span class="st">&quot;Inferno&quot;</span>),</span>
<span id="cb49-17"><a href="casos.html#cb49-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Fisher-Jenks&quot;</span></span>
<span id="cb49-18"><a href="casos.html#cb49-18" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="Visualización_geolocalización_datos_files/figure-html/classint-3.png" width="60%" style="display: block; margin: auto;" /></p>
<p>Se puede observar lo siguiente:</p>
<ul>
<li><p>El último decil de renta se corresponde a un rango de entre 15.000 y 25.000
€.</p></li>
<li><p>El método por deciles proporciona unos grupos con valores de renta muy
parecidos entre sí en los valores medios. Esto es debido a la propia
distribución de la variable.</p></li>
<li><p>El método de rangos equidistantes proporciona algunos grupos con un número
muy reducido de municipios.</p></li>
<li><p>El método de Fisher-Jenks puede proporcionar unas clases con unos rangos más
apropiados para los tramos altos de renta.</p></li>
</ul>
<div class="exercise">
<p><span id="exr:ex23" class="exercise"><strong>Ejercicio 5.25  (Representación de los mapas según las clases obtenidas) </strong></span>Realice tres mapas distintos, creando clases de renta según cada uno de los
métodos anteriormente mostrados y coméntelos.</p>
</div>
<p><strong>Deciles</strong></p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="casos.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracción de los valores de corte</span></span>
<span id="cb50-2"><a href="casos.html#cb50-2" aria-hidden="true" tabindex="-1"></a>breaks_d <span class="ot">&lt;-</span> deciles<span class="sc">$</span>brks</span>
<span id="cb50-3"><a href="casos.html#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="casos.html#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Creación de etiquetas básicas para cada clase</span></span>
<span id="cb50-5"><a href="casos.html#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Creación de una función específica para crear etiquetas formateadas</span></span>
<span id="cb50-6"><a href="casos.html#cb50-6" aria-hidden="true" tabindex="-1"></a>label_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb50-7"><a href="casos.html#cb50-7" aria-hidden="true" tabindex="-1"></a>  l <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb50-8"><a href="casos.html#cb50-8" aria-hidden="true" tabindex="-1"></a>  eur <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">prettyNum</span>(<span class="fu">round</span>(x, <span class="dv">0</span>),</span>
<span id="cb50-9"><a href="casos.html#cb50-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimal.mark =</span> <span class="st">&quot;,&quot;</span>,</span>
<span id="cb50-10"><a href="casos.html#cb50-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">big.mark =</span> <span class="st">&quot;.&quot;</span></span>
<span id="cb50-11"><a href="casos.html#cb50-11" aria-hidden="true" tabindex="-1"></a>  ), <span class="st">&quot; €&quot;</span>)</span>
<span id="cb50-12"><a href="casos.html#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="casos.html#cb50-13" aria-hidden="true" tabindex="-1"></a>  labels <span class="ot">&lt;-</span> <span class="fu">paste</span>(eur[<span class="sc">-</span>l], <span class="st">&quot;-&quot;</span>, eur[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb50-14"><a href="casos.html#cb50-14" aria-hidden="true" tabindex="-1"></a>  labels[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;&lt;&quot;</span>, eur[<span class="dv">1</span>])</span>
<span id="cb50-15"><a href="casos.html#cb50-15" aria-hidden="true" tabindex="-1"></a>  labels[l <span class="sc">-</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;&gt;&quot;</span>, eur[l <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb50-16"><a href="casos.html#cb50-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(labels)</span>
<span id="cb50-17"><a href="casos.html#cb50-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb50-18"><a href="casos.html#cb50-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-19"><a href="casos.html#cb50-19" aria-hidden="true" tabindex="-1"></a>labels_d <span class="ot">&lt;-</span> <span class="fu">label_fun</span>(breaks_d)</span>
<span id="cb50-20"><a href="casos.html#cb50-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-21"><a href="casos.html#cb50-21" aria-hidden="true" tabindex="-1"></a>munis_renta_clean<span class="sc">$</span>Deciles <span class="ot">&lt;-</span> <span class="fu">cut</span>(munis_renta_clean<span class="sc">$</span><span class="st">`</span><span class="at">2019</span><span class="st">`</span>,</span>
<span id="cb50-22"><a href="casos.html#cb50-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> breaks_d,</span>
<span id="cb50-23"><a href="casos.html#cb50-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> labels_d,</span>
<span id="cb50-24"><a href="casos.html#cb50-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">include.lowest =</span> <span class="cn">TRUE</span></span>
<span id="cb50-25"><a href="casos.html#cb50-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb50-26"><a href="casos.html#cb50-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-27"><a href="casos.html#cb50-27" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(munis_renta_clean) <span class="sc">+</span></span>
<span id="cb50-28"><a href="casos.html#cb50-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cambio la variable a representar para crear el mapa</span></span>
<span id="cb50-29"><a href="casos.html#cb50-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Deciles), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb50-30"><a href="casos.html#cb50-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cambio el scale, ya no es continua</span></span>
<span id="cb50-31"><a href="casos.html#cb50-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">hcl.colors</span>(<span class="fu">length</span>(labels_d),</span>
<span id="cb50-32"><a href="casos.html#cb50-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Inferno&quot;</span>,</span>
<span id="cb50-33"><a href="casos.html#cb50-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">rev =</span> <span class="cn">TRUE</span></span>
<span id="cb50-34"><a href="casos.html#cb50-34" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb50-35"><a href="casos.html#cb50-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:mapa-deciles"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/mapa-deciles-1.png" alt="Mapa por deciles de renta media por persona (2019)" width="60%" />
<p class="caption">
Figura 5.12: Mapa por deciles de renta media por persona (2019)
</p>
</div>
<p>El mapa de la Fig. <a href="casos.html#fig:mapa-deciles">5.12</a> ya permite observar patrones
geográficos, donde se ve una clara diferencia entre la Comunidades Autónomas del
Norte y las del Sur. Veamos una representación distinta usando otras clases
diferentes.</p>
<p><strong>Tramos equidistantes</strong></p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="casos.html#cb51-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-2"><a href="casos.html#cb51-2" aria-hidden="true" tabindex="-1"></a>breaks_e <span class="ot">&lt;-</span> equal<span class="sc">$</span>brks</span>
<span id="cb51-3"><a href="casos.html#cb51-3" aria-hidden="true" tabindex="-1"></a>labels_e <span class="ot">&lt;-</span> <span class="fu">label_fun</span>(breaks_e)</span>
<span id="cb51-4"><a href="casos.html#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="casos.html#cb51-5" aria-hidden="true" tabindex="-1"></a>munis_renta_clean<span class="sc">$</span>Equal <span class="ot">&lt;-</span> <span class="fu">cut</span>(munis_renta_clean<span class="sc">$</span><span class="st">`</span><span class="at">2019</span><span class="st">`</span>,</span>
<span id="cb51-6"><a href="casos.html#cb51-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> breaks_e,</span>
<span id="cb51-7"><a href="casos.html#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> labels_e,</span>
<span id="cb51-8"><a href="casos.html#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">include.lowest =</span> <span class="cn">TRUE</span></span>
<span id="cb51-9"><a href="casos.html#cb51-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-10"><a href="casos.html#cb51-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-11"><a href="casos.html#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(munis_renta_clean) <span class="sc">+</span></span>
<span id="cb51-12"><a href="casos.html#cb51-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cambiamos la variable que usamos para crear el mapa</span></span>
<span id="cb51-13"><a href="casos.html#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Equal), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb51-14"><a href="casos.html#cb51-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">hcl.colors</span>(<span class="fu">length</span>(labels_e),</span>
<span id="cb51-15"><a href="casos.html#cb51-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Inferno&quot;</span>,</span>
<span id="cb51-16"><a href="casos.html#cb51-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">rev =</span> <span class="cn">TRUE</span></span>
<span id="cb51-17"><a href="casos.html#cb51-17" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb51-18"><a href="casos.html#cb51-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:mapa-equal"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/mapa-equal-1.png" alt="Mapa por tramos de renta equidistantes de renta media por persona (2019)" width="60%" />
<p class="caption">
Figura 5.13: Mapa por tramos de renta equidistantes de renta media por persona (2019)
</p>
</div>
<p>El mapa de la Fig. <a href="casos.html#fig:mapa-equal">5.13</a>, sin embargo, se parece más al mapa de
la Fig. <a href="casos.html#fig:maparenta2">5.11</a> con los datos sin clasificar, donde el peso visual
se concentra más bien en los municipios con rentas mucho más altas que el resto
(por encima de 18.000 €).</p>
<p><strong>Fisher-Jenks</strong></p>
<p>Véase a continuación el mismo mapa usando la clasificación Fisher-Jenks:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="casos.html#cb52-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-2"><a href="casos.html#cb52-2" aria-hidden="true" tabindex="-1"></a>breaks_f <span class="ot">&lt;-</span> fisher<span class="sc">$</span>brks</span>
<span id="cb52-3"><a href="casos.html#cb52-3" aria-hidden="true" tabindex="-1"></a>labels_f <span class="ot">&lt;-</span> <span class="fu">label_fun</span>(breaks_f)</span>
<span id="cb52-4"><a href="casos.html#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="casos.html#cb52-5" aria-hidden="true" tabindex="-1"></a>munis_renta_clean<span class="sc">$</span><span class="st">`</span><span class="at">Fisher-Jenks</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">cut</span>(munis_renta_clean<span class="sc">$</span><span class="st">`</span><span class="at">2019</span><span class="st">`</span>,</span>
<span id="cb52-6"><a href="casos.html#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> breaks_f,</span>
<span id="cb52-7"><a href="casos.html#cb52-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> labels_f,</span>
<span id="cb52-8"><a href="casos.html#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">include.lowest =</span> <span class="cn">TRUE</span></span>
<span id="cb52-9"><a href="casos.html#cb52-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-10"><a href="casos.html#cb52-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-11"><a href="casos.html#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(munis_renta_clean) <span class="sc">+</span></span>
<span id="cb52-12"><a href="casos.html#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cambiamos la variable que usamos para crear el mapa</span></span>
<span id="cb52-13"><a href="casos.html#cb52-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="st">`</span><span class="at">Fisher-Jenks</span><span class="st">`</span>), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb52-14"><a href="casos.html#cb52-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">hcl.colors</span>(<span class="fu">length</span>(labels_f),</span>
<span id="cb52-15"><a href="casos.html#cb52-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Inferno&quot;</span>,</span>
<span id="cb52-16"><a href="casos.html#cb52-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">rev =</span> <span class="cn">TRUE</span></span>
<span id="cb52-17"><a href="casos.html#cb52-17" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb52-18"><a href="casos.html#cb52-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:mapa-fisher"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/mapa-fisher-1.png" alt="Mapa por tramos según Fisher-Jenks" width="60%" />
<p class="caption">
Figura 5.14: Mapa por tramos según Fisher-Jenks
</p>
</div>
<p>En el mapa de la Fig. <a href="casos.html#fig:mapa-fisher">5.14</a> se puede observar de una manera más
clara un clúster adicional de renta en la zona de Asturias y el norte de León.
Además, gracias a la escala de colores puede intuirse que este clúster de renta
no presenta valores tan altos como los observados en País Vasco o Madrid.</p>
<p>En conclusión, en el momento de realizar una visualización de datos es
importante conocer el dato a representar, así como entender algunas propiedades
básicas de la distribución subyacente. También se ha podido observar que hay
ciertas decisiones estéticas (datos continuos vs. agrupados, escala de colores)
que tienen una influencia significativa en cómo se percibe la información
representada. Es responsabilidad del investigador encargado de crear de la
visualización el conocer todos estos factores y aplicarlos de manera
conveniente.</p>
</div>
<div id="caso-3.-delitos-cometidos-en-valencia-en-el-año-2010" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Caso 3. Delitos cometidos en Valencia en el año 2010</h2>
<p>Las técnicas de análisis de patrones de puntos analizan la distribución de
eventos geolocalizados que surgen al azar. La diferencia fundamental con otros
análisis que comprenden también el uso de localizaciones (como las temperaturas
mínimas medidas por estaciones meteorológicas) es que en este caso los puntos
representan eventos conocidos y aleatorios (por ejemplo, los delitos ocurridos
en una ciudad, accidentes de tráfico o incendios en una región). A diferencia de
otros eventos, como el ejemplo de las temperaturas mínimas (Sección
<a href="casos.html#tempmin">5.1</a>), la ausencia de datos no se debe a la ausencia de medición (es
decir, no existe una estación de monitoreo en ese lugar), si no a que no se ha
producido el evento en dicha localización.</p>
<p><strong>Objetivo de aprendizaje</strong>:</p>
<p>El alumno debe ser capaz de conocer los datos de tipo patrones de puntos,
identificarlos y representarlos adecuadamente.</p>
<div class="exercise">
<p><span id="exr:ex24" class="exercise"><strong>Ejercicio 5.26  (Patrones de puntos: Creación del proyecto) </strong></span>Cree un proyecto para trabajar todo lo referente al caso.</p>
</div>
<div class="solution">
<p><span id="unlabeled-div-2" class="solution"><em>Solución</em>. </span>Véase la solución del Ejercicio <a href="casos.html#exr:ex-crea">5.1</a></p>
</div>
<div class="exercise">
<p><span id="exr:ex25" class="exercise"><strong>Ejercicio 5.27  (Importación de los datos de crímenes) </strong></span>Importe los datos <code>crime-data-Valencia.csv</code> y guárdelos en un objeto llamado
<code>crimen</code>.</p>
</div>
<div class="solution">
<p><span id="sol25" class="solution"><em>Solución</em>. </span>Use la librería <strong>readr</strong>.</p>
</div>
<p>El primer paso consiste en importar la base de datos de crímenes en la ciudad de
Valencia en el año 2010. El archivo está en formato csv, por lo que usaremos el
paquete <strong>readr</strong> <span class="citation">(<a href="#ref-R-readr" role="doc-biblioref">Wickham, Hester, and Bryan 2022</a>)</span> para importar los datos:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="casos.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb53-2"><a href="casos.html#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb53-3"><a href="casos.html#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="casos.html#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co"># En este caso el archivo está en la carpeta &quot;data&quot; de nuestro proyecto</span></span>
<span id="cb53-5"><a href="casos.html#cb53-5" aria-hidden="true" tabindex="-1"></a>crimen <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/crime-data-Valencia.csv&quot;</span>)</span></code></pre></div>
<div class="exercise">
<p><span id="exr:ex26" class="exercise"><strong>Ejercicio 5.28  (Descripción de los datos: Crímenes en Valencia) </strong></span>¿Qué información contiene el archivo importado?</p>
</div>
<div class="solution">
<p><span id="sol26" class="solution"><em>Solución</em>. </span>Use la función <code>summary()</code> en el objeto <code>crimen</code> para obtener información de los
datos.</p>
</div>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="casos.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(crimen)</span>
<span id="cb54-2"><a href="casos.html#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    crime_id          crime_type         crime_date             year     </span></span>
<span id="cb54-3"><a href="casos.html#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Length:5338        Length:5338        Length:5338        Min.   :2010  </span></span>
<span id="cb54-4"><a href="casos.html#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Class :character   Class :character   Class :character   1st Qu.:2010  </span></span>
<span id="cb54-5"><a href="casos.html#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Mode  :character   Mode  :character   Mode  :character   Median :2010  </span></span>
<span id="cb54-6"><a href="casos.html#cb54-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                                           Mean   :2010  </span></span>
<span id="cb54-7"><a href="casos.html#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                                           3rd Qu.:2010  </span></span>
<span id="cb54-8"><a href="casos.html#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                                           Max.   :2010  </span></span>
<span id="cb54-9"><a href="casos.html#cb54-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    crime_lat       crime_lon      </span></span>
<span id="cb54-10"><a href="casos.html#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Min.   :39.42   Min.   :-0.4261  </span></span>
<span id="cb54-11"><a href="casos.html#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1st Qu.:39.46   1st Qu.:-0.3876  </span></span>
<span id="cb54-12"><a href="casos.html#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Median :39.47   Median :-0.3747  </span></span>
<span id="cb54-13"><a href="casos.html#cb54-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Mean   :39.47   Mean   :-0.3722  </span></span>
<span id="cb54-14"><a href="casos.html#cb54-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:39.48   3rd Qu.:-0.3600  </span></span>
<span id="cb54-15"><a href="casos.html#cb54-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Max.   :39.53   Max.   :-0.3231</span></span></code></pre></div>
<p>Este archivo contiene en total
5.338 registros, y
proporciona 6 campos asociados a cada registro.</p>
<p>Entre los campos disponibles, destacamos los campos <code>crime_lon</code> y <code>crime_lat</code>:
Son las coordenadas en las que se produjo el crimen.</p>
<div class="exercise">
<p><span id="exr:ex27" class="exercise"><strong>Ejercicio 5.29  (Identificación del CRS de los datos proporcionados) </strong></span>Determine el CRS en el que se encuentran las coordenadas del conjunto de datos
<code>crimen</code>, a partir de los campos <code>crime_lon</code> y <code>crime_lat</code></p>
</div>
<table>
<caption><span id="tab:coods-lonlat">Tabla 5.2: </span>Crímenes en Valencia; Coordenadas</caption>
<thead>
<tr class="header">
<th align="right">crime_lon</th>
<th align="right">crime_lat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-0.3826325</td>
<td align="right">39.46332</td>
</tr>
<tr class="even">
<td align="right">-0.3906850</td>
<td align="right">39.43517</td>
</tr>
<tr class="odd">
<td align="right">-0.3747971</td>
<td align="right">39.47927</td>
</tr>
<tr class="even">
<td align="right">-0.3992082</td>
<td align="right">39.47982</td>
</tr>
<tr class="odd">
<td align="right">-0.3596011</td>
<td align="right">39.46740</td>
</tr>
<tr class="even">
<td align="right">-0.3552423</td>
<td align="right">39.47461</td>
</tr>
</tbody>
</table>
<p>Obsérvese que, las coordenadas parecen corresponder con longitudes y latitudes,
ya que como se explicó el rango posible de valores es <span class="math inline">\([-180, 180]\)</span> (para
longitudes) y <span class="math inline">\([-90, 90]\)</span> (para latitudes):</p>
<div class="exercise">
<p><span id="exr:ex28" class="exercise"><strong>Ejercicio 5.30  (Proyección y representación de localizaciones) </strong></span>Convierta el objeto <code>crimen</code> a un objecto <code>sf</code> llamado <code>crimen_sf</code>, teniendo en
cuenta el sistema CRS más adecuado. A modo de recordatorio, el CRS
correspondiente a coordenadas geográficas longitud/latitud es <strong>EPSG:4326</strong>.</p>
<p>Una vez obtenido el objeto <code>sf</code>, si lo desea puede usar una imagen de fondo con
la función <code>esp_getTiles</code> de la librería <strong>mapSpain</strong>.</p>
</div>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="casos.html#cb55-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-2"><a href="casos.html#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb55-3"><a href="casos.html#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Objeto sf sin CRS</span></span>
<span id="cb55-4"><a href="casos.html#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="casos.html#cb55-5" aria-hidden="true" tabindex="-1"></a>crimen_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(</span>
<span id="cb55-6"><a href="casos.html#cb55-6" aria-hidden="true" tabindex="-1"></a>  crimen,</span>
<span id="cb55-7"><a href="casos.html#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">c</span>(</span>
<span id="cb55-8"><a href="casos.html#cb55-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;crime_lon&quot;</span>,</span>
<span id="cb55-9"><a href="casos.html#cb55-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;crime_lat&quot;</span></span>
<span id="cb55-10"><a href="casos.html#cb55-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb55-11"><a href="casos.html#cb55-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="dv">4326</span>)</span>
<span id="cb55-12"><a href="casos.html#cb55-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-13"><a href="casos.html#cb55-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-14"><a href="casos.html#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Comprobamos con un mapa base</span></span>
<span id="cb55-15"><a href="casos.html#cb55-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-16"><a href="casos.html#cb55-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapSpain)</span>
<span id="cb55-17"><a href="casos.html#cb55-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb55-18"><a href="casos.html#cb55-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-19"><a href="casos.html#cb55-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Usamos imagen como mapa de fondo</span></span>
<span id="cb55-20"><a href="casos.html#cb55-20" aria-hidden="true" tabindex="-1"></a>tile <span class="ot">&lt;-</span> <span class="fu">esp_getTiles</span>(crimen_sf, <span class="st">&quot;IDErioja&quot;</span>,</span>
<span id="cb55-21"><a href="casos.html#cb55-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">zoommin =</span> <span class="dv">1</span>,</span>
<span id="cb55-22"><a href="casos.html#cb55-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">crop =</span> <span class="cn">TRUE</span></span>
<span id="cb55-23"><a href="casos.html#cb55-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-24"><a href="casos.html#cb55-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-25"><a href="casos.html#cb55-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb55-26"><a href="casos.html#cb55-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_spatraster</span>(tile) <span class="sc">+</span></span>
<span id="cb55-27"><a href="casos.html#cb55-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb55-28"><a href="casos.html#cb55-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> crimen_sf,</span>
<span id="cb55-29"><a href="casos.html#cb55-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb55-30"><a href="casos.html#cb55-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.3</span>,</span>
<span id="cb55-31"><a href="casos.html#cb55-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.3</span></span>
<span id="cb55-32"><a href="casos.html#cb55-32" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:crimen1"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/crimen1-1.png" alt="Crímenes en Valencia" width="60%" />
<p class="caption">
Figura 5.15: Crímenes en Valencia
</p>
</div>
<p><strong>¿Hay algún patrón en la ocurrencia de crímenes?</strong></p>
<p>En la Fig. <a href="casos.html#fig:crimen1">5.15</a> podemos intuir ciertos patrones en la ocurrencia
de crímenes. Por ejemplo, parecen concentrarse en zonas céntricas y no hay
crímenes registrados en la zona del puerto.</p>
<p>Resulta interesante analizar el patrón espacial de estos delitos. Por otra
parte, en el análisis de patrones de puntos es necesario delimitar la ventana
espacial de observación (owin). En este caso será el municipio de Valencia, que
podemos extraer del paquete <strong>mapSpain</strong>.</p>
<p>El paquete <strong>spatstat</strong> (<span class="citation"><a href="#ref-spatstat_2005" role="doc-biblioref">Baddeley and Turner</a> (<a href="#ref-spatstat_2005" role="doc-biblioref">2005</a>)</span>) es el paquete de referencia cuando se
trabaja con patrones de puntos.</p>
<div class="exercise">
<p><span id="exr:ex30" class="exercise"><strong>Ejercicio 5.31  (Análisis de patrones con spatstat) </strong></span>Analice la existencia de patrones espaciales en los delitos registrados en el
año 2010.</p>
</div>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="casos.html#cb56-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-2"><a href="casos.html#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraemos Valencia con mapSpain</span></span>
<span id="cb56-3"><a href="casos.html#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="casos.html#cb56-4" aria-hidden="true" tabindex="-1"></a>valencia <span class="ot">&lt;-</span> <span class="fu">esp_get_munic</span>(<span class="at">munic =</span> <span class="st">&quot;^Valencia$&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb56-5"><a href="casos.html#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Necesitamos proyectar, en este caso usamos ETRS89-UTM huso 30 EPSG:25830</span></span>
<span id="cb56-6"><a href="casos.html#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">25830</span>)</span>
<span id="cb56-7"><a href="casos.html#cb56-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-8"><a href="casos.html#cb56-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-9"><a href="casos.html#cb56-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-10"><a href="casos.html#cb56-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat)</span>
<span id="cb56-11"><a href="casos.html#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Necesitamos un recinto de observación: owin</span></span>
<span id="cb56-12"><a href="casos.html#cb56-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-13"><a href="casos.html#cb56-13" aria-hidden="true" tabindex="-1"></a>val_owin <span class="ot">&lt;-</span> <span class="fu">as.owin</span>(valencia)</span>
<span id="cb56-14"><a href="casos.html#cb56-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-15"><a href="casos.html#cb56-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraemos las coordenadas de los crímenes. Han de estar en el mismo CRS</span></span>
<span id="cb56-16"><a href="casos.html#cb56-16" aria-hidden="true" tabindex="-1"></a><span class="co"># que el owin</span></span>
<span id="cb56-17"><a href="casos.html#cb56-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-18"><a href="casos.html#cb56-18" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> crimen_sf <span class="sc">%&gt;%</span></span>
<span id="cb56-19"><a href="casos.html#cb56-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Proyectamos</span></span>
<span id="cb56-20"><a href="casos.html#cb56-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">25830</span>) <span class="sc">%&gt;%</span></span>
<span id="cb56-21"><a href="casos.html#cb56-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_coordinates</span>()</span>
<span id="cb56-22"><a href="casos.html#cb56-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-23"><a href="casos.html#cb56-23" aria-hidden="true" tabindex="-1"></a>mydata_ppp <span class="ot">&lt;-</span> <span class="fu">ppp</span>(</span>
<span id="cb56-24"><a href="casos.html#cb56-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">as.numeric</span>(coords[, <span class="dv">1</span>]),</span>
<span id="cb56-25"><a href="casos.html#cb56-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">as.numeric</span>(coords[, <span class="dv">2</span>]),</span>
<span id="cb56-26"><a href="casos.html#cb56-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">window =</span> val_owin</span>
<span id="cb56-27"><a href="casos.html#cb56-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-28"><a href="casos.html#cb56-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-29"><a href="casos.html#cb56-29" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mydata_ppp)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:objeto-ppp"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/objeto-ppp-1.png" alt="Patrones de puntos en los crímenes de Valencia (2010)" width="60%" />
<p class="caption">
Figura 5.16: Patrones de puntos en los crímenes de Valencia (2010)
</p>
</div>
<div class="exercise">
<p><span id="exr:ex31" class="exercise"><strong>Ejercicio 5.32  (Información de objetos ppp) </strong></span>¿Qué información contiene nuestro objeto <code>mydata_ppp</code>?</p>
</div>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="casos.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mydata_ppp)</span>
<span id="cb57-2"><a href="casos.html#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Planar point pattern:  5332 points</span></span>
<span id="cb57-3"><a href="casos.html#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Average intensity 3.917619e-05 points per square unit</span></span>
<span id="cb57-4"><a href="casos.html#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb57-5"><a href="casos.html#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; *Pattern contains duplicated points*</span></span>
<span id="cb57-6"><a href="casos.html#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb57-7"><a href="casos.html#cb57-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Coordinates are given to 1 decimal place</span></span>
<span id="cb57-8"><a href="casos.html#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; i.e. rounded to the nearest multiple of 0.1 units</span></span>
<span id="cb57-9"><a href="casos.html#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb57-10"><a href="casos.html#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Window: polygonal boundary</span></span>
<span id="cb57-11"><a href="casos.html#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 separate polygons (no holes)</span></span>
<span id="cb57-12"><a href="casos.html#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;            vertices      area relative.area</span></span>
<span id="cb57-13"><a href="casos.html#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; polygon 1         4   1977930       0.01450</span></span>
<span id="cb57-14"><a href="casos.html#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; polygon 2        82 131953000       0.97000</span></span>
<span id="cb57-15"><a href="casos.html#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; polygon 3         7    958085       0.00704</span></span>
<span id="cb57-16"><a href="casos.html#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; polygon 4         7   1214060       0.00892</span></span>
<span id="cb57-17"><a href="casos.html#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; enclosing rectangle: [720573.4, 735116.6] x [4351274, 4382995] units</span></span>
<span id="cb57-18"><a href="casos.html#cb57-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                      (14540 x 31720 units)</span></span>
<span id="cb57-19"><a href="casos.html#cb57-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Window area = 136103000 square units</span></span>
<span id="cb57-20"><a href="casos.html#cb57-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Fraction of frame area: 0.295</span></span>
<span id="cb57-21"><a href="casos.html#cb57-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb57-22"><a href="casos.html#cb57-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; *** 6 illegal points stored in attr(,&quot;rejects&quot;) ***</span></span></code></pre></div>
<p>Es importante determinar si los puntos se distribuyen al azar o tienen algún
patrón. Por ello, lo primero que haremos será representar el objeto <code>mydata_ppp</code>
y superponer unos cuadrantes para su comportamiento.</p>
<div class="exercise">
<p><span id="exr:ex32" class="exercise"><strong>Ejercicio 5.33  (Cálculo de la densidad de los delitos en Valencia en 2010 mediante cuadrantes) </strong></span>Cree unos cuadrantes sobre el objeto <code>mydata_ppp</code> usando la función
<code>quadratcount</code>.</p>
</div>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="casos.html#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Hallamos los cuadrantes</span></span>
<span id="cb58-2"><a href="casos.html#cb58-2" aria-hidden="true" tabindex="-1"></a>cuadrante <span class="ot">&lt;-</span> <span class="fu">quadratcount</span>(mydata_ppp,</span>
<span id="cb58-3"><a href="casos.html#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">nx =</span> <span class="dv">5</span>,</span>
<span id="cb58-4"><a href="casos.html#cb58-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ny =</span> <span class="dv">5</span></span>
<span id="cb58-5"><a href="casos.html#cb58-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-6"><a href="casos.html#cb58-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-7"><a href="casos.html#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Dibujamos el número de crímenes que hay en cada cuadrante</span></span>
<span id="cb58-8"><a href="casos.html#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mydata_ppp, <span class="at">pch =</span> <span class="st">&quot;+&quot;</span>, <span class="at">main =</span> <span class="st">&quot;&quot;</span>, <span class="at">cex =</span> <span class="fl">0.3</span>)</span>
<span id="cb58-9"><a href="casos.html#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cuadrante, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:cuadrante"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/cuadrante-1.png" alt="Crímenes en Valencia por cuadrantes (2010)" width="60%" />
<p class="caption">
Figura 5.17: Crímenes en Valencia por cuadrantes (2010)
</p>
</div>
<p>Como se puede apreciar en la Fig. <a href="casos.html#fig:cuadrante">5.17</a> hay cuadrantes que
registran cero crímenes y otros que registran hasta 2.860 crímenes.</p>
<div class="exercise">
<p><span id="exr:ex33" class="exercise"><strong>Ejercicio 5.34  (Estimación de la densidad de los delitos en Valencia en 2010 mediante de patrones de puntos) </strong></span>Analice la densidad de crímenes en Valencia usando la función <code>density()</code>.</p>
</div>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="casos.html#cb59-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-2"><a href="casos.html#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Permite ver la variación local de la intensidad, graficando la estimación kernel de la intensidad.</span></span>
<span id="cb59-3"><a href="casos.html#cb59-3" aria-hidden="true" tabindex="-1"></a>densidad <span class="ot">&lt;-</span> <span class="fu">density</span>(mydata_ppp)</span>
<span id="cb59-4"><a href="casos.html#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="casos.html#cb59-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(densidad, <span class="at">main =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb59-6"><a href="casos.html#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(mydata_ppp, <span class="at">pch =</span> <span class="st">&quot;+&quot;</span>, <span class="at">cex =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:intensidad-ppp"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/intensidad-ppp-1.png" alt="Estimación kernel de la intensidad de crímenes en la ciudad de Valencia" width="60%" />
<p class="caption">
Figura 5.18: Estimación kernel de la intensidad de crímenes en la ciudad de Valencia
</p>
</div>
<p>En la Fig. <a href="casos.html#fig:intensidad-ppp">5.18</a> se muestra la estimación kernel de la
densidad de patrones de puntos.</p>
<div class="exercise">
<p><span id="exr:unlabeled-div-3" class="exercise"><strong>Ejercicio 5.35  (Representación alternativa con ggplot2) </strong></span>Recree el mapa de la Fig. <a href="casos.html#fig:intensidad-ppp">5.18</a> con <strong>ggplot2</strong>.</p>
</div>
<p>Es posible recrear el mapa anterior con el paquete <strong>ggplot2</strong>, que nos permite
un mayor control de los parámetros gráficos. Para ello, hemos de convertir el
objeto <code>densidad</code> a un formato espacial, para lo cual usaremos el paquete
<strong>raster.</strong> A continuación, transformamos el ráster en un formato vector <code>sf</code>
mediante las funciones <code>rasterToPolygons()</code> y <code>st_as_sf()</code>:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="casos.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertimas a raster</span></span>
<span id="cb60-2"><a href="casos.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb60-3"><a href="casos.html#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="casos.html#cb60-4" aria-hidden="true" tabindex="-1"></a>dens_raster <span class="ot">&lt;-</span> <span class="fu">raster</span>(densidad)</span>
<span id="cb60-5"><a href="casos.html#cb60-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Y del raster extraemos los polígonos</span></span>
<span id="cb60-6"><a href="casos.html#cb60-6" aria-hidden="true" tabindex="-1"></a>pols <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(<span class="fu">rasterToPolygons</span>(dens_raster))</span>
<span id="cb60-7"><a href="casos.html#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="casos.html#cb60-8" aria-hidden="true" tabindex="-1"></a>pols</span>
<span id="cb60-9"><a href="casos.html#cb60-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 4827 features and 1 field</span></span>
<span id="cb60-10"><a href="casos.html#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span id="cb60-11"><a href="casos.html#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb60-12"><a href="casos.html#cb60-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: 720573.4 ymin: 4351274 xmax: 735003 ymax: 4382995</span></span>
<span id="cb60-13"><a href="casos.html#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; CRS:           NA</span></span>
<span id="cb60-14"><a href="casos.html#cb60-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; First 10 features:</span></span>
<span id="cb60-15"><a href="casos.html#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;           layer                       geometry</span></span>
<span id="cb60-16"><a href="casos.html#cb60-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  2.136709e-09 POLYGON ((730685.5 4382995,...</span></span>
<span id="cb60-17"><a href="casos.html#cb60-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  1.783295e-09 POLYGON ((730799.1 4382995,...</span></span>
<span id="cb60-18"><a href="casos.html#cb60-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  1.488809e-09 POLYGON ((730912.7 4382995,...</span></span>
<span id="cb60-19"><a href="casos.html#cb60-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  5.523748e-09 POLYGON ((730344.6 4382747,...</span></span>
<span id="cb60-20"><a href="casos.html#cb60-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5  4.636122e-09 POLYGON ((730458.2 4382747,...</span></span>
<span id="cb60-21"><a href="casos.html#cb60-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6  3.890395e-09 POLYGON ((730571.8 4382747,...</span></span>
<span id="cb60-22"><a href="casos.html#cb60-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7  3.264586e-09 POLYGON ((730685.5 4382747,...</span></span>
<span id="cb60-23"><a href="casos.html#cb60-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8  2.739928e-09 POLYGON ((730799.1 4382747,...</span></span>
<span id="cb60-24"><a href="casos.html#cb60-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 9  2.300445e-09 POLYGON ((730912.7 4382747,...</span></span>
<span id="cb60-25"><a href="casos.html#cb60-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 1.932566e-09 POLYGON ((731026.3 4382747,...</span></span></code></pre></div>
<p>En este caso, al convertir del formato de <code>spatstat</code> a <code>sf</code>, se ha perdido la
definición del CRS:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="casos.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(pols)</span>
<span id="cb61-2"><a href="casos.html#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Coordinate Reference System: NA</span></span></code></pre></div>
<p>En este tipo de casos excepcionales, es posible forzar el CRS de la siguiente
manera:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="casos.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sabemos que el CRS inicial que usamos cuando creamos el owin</span></span>
<span id="cb62-2"><a href="casos.html#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="co"># era este</span></span>
<span id="cb62-3"><a href="casos.html#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(pols) <span class="ot">&lt;-</span> <span class="fu">st_crs</span>(valencia)</span>
<span id="cb62-4"><a href="casos.html#cb62-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-5"><a href="casos.html#cb62-5" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(pols)</span>
<span id="cb62-6"><a href="casos.html#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Coordinate Reference System:</span></span>
<span id="cb62-7"><a href="casos.html#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   User input: EPSG:25830 </span></span>
<span id="cb62-8"><a href="casos.html#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   wkt:</span></span>
<span id="cb62-9"><a href="casos.html#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; PROJCRS[&quot;ETRS89 / UTM zone 30N&quot;,</span></span>
<span id="cb62-10"><a href="casos.html#cb62-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     BASEGEOGCRS[&quot;ETRS89&quot;,</span></span>
<span id="cb62-11"><a href="casos.html#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         DATUM[&quot;European Terrestrial Reference System 1989&quot;,</span></span>
<span id="cb62-12"><a href="casos.html#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ELLIPSOID[&quot;GRS 1980&quot;,6378137,298.257222101,</span></span>
<span id="cb62-13"><a href="casos.html#cb62-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                 LENGTHUNIT[&quot;metre&quot;,1]]],</span></span>
<span id="cb62-14"><a href="casos.html#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         PRIMEM[&quot;Greenwich&quot;,0,</span></span>
<span id="cb62-15"><a href="casos.html#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433]],</span></span>
<span id="cb62-16"><a href="casos.html#cb62-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         ID[&quot;EPSG&quot;,4258]],</span></span>
<span id="cb62-17"><a href="casos.html#cb62-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     CONVERSION[&quot;UTM zone 30N&quot;,</span></span>
<span id="cb62-18"><a href="casos.html#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         METHOD[&quot;Transverse Mercator&quot;,</span></span>
<span id="cb62-19"><a href="casos.html#cb62-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,9807]],</span></span>
<span id="cb62-20"><a href="casos.html#cb62-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         PARAMETER[&quot;Latitude of natural origin&quot;,0,</span></span>
<span id="cb62-21"><a href="casos.html#cb62-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],</span></span>
<span id="cb62-22"><a href="casos.html#cb62-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,8801]],</span></span>
<span id="cb62-23"><a href="casos.html#cb62-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         PARAMETER[&quot;Longitude of natural origin&quot;,-3,</span></span>
<span id="cb62-24"><a href="casos.html#cb62-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ANGLEUNIT[&quot;degree&quot;,0.0174532925199433],</span></span>
<span id="cb62-25"><a href="casos.html#cb62-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,8802]],</span></span>
<span id="cb62-26"><a href="casos.html#cb62-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         PARAMETER[&quot;Scale factor at natural origin&quot;,0.9996,</span></span>
<span id="cb62-27"><a href="casos.html#cb62-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             SCALEUNIT[&quot;unity&quot;,1],</span></span>
<span id="cb62-28"><a href="casos.html#cb62-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,8805]],</span></span>
<span id="cb62-29"><a href="casos.html#cb62-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         PARAMETER[&quot;False easting&quot;,500000,</span></span>
<span id="cb62-30"><a href="casos.html#cb62-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             LENGTHUNIT[&quot;metre&quot;,1],</span></span>
<span id="cb62-31"><a href="casos.html#cb62-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,8806]],</span></span>
<span id="cb62-32"><a href="casos.html#cb62-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         PARAMETER[&quot;False northing&quot;,0,</span></span>
<span id="cb62-33"><a href="casos.html#cb62-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             LENGTHUNIT[&quot;metre&quot;,1],</span></span>
<span id="cb62-34"><a href="casos.html#cb62-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ID[&quot;EPSG&quot;,8807]]],</span></span>
<span id="cb62-35"><a href="casos.html#cb62-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     CS[Cartesian,2],</span></span>
<span id="cb62-36"><a href="casos.html#cb62-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         AXIS[&quot;(E)&quot;,east,</span></span>
<span id="cb62-37"><a href="casos.html#cb62-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ORDER[1],</span></span>
<span id="cb62-38"><a href="casos.html#cb62-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             LENGTHUNIT[&quot;metre&quot;,1]],</span></span>
<span id="cb62-39"><a href="casos.html#cb62-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         AXIS[&quot;(N)&quot;,north,</span></span>
<span id="cb62-40"><a href="casos.html#cb62-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             ORDER[2],</span></span>
<span id="cb62-41"><a href="casos.html#cb62-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;             LENGTHUNIT[&quot;metre&quot;,1]],</span></span>
<span id="cb62-42"><a href="casos.html#cb62-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     USAGE[</span></span>
<span id="cb62-43"><a href="casos.html#cb62-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         SCOPE[&quot;Engineering survey, topographic mapping.&quot;],</span></span>
<span id="cb62-44"><a href="casos.html#cb62-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         AREA[&quot;Europe between 6Â°W and 0Â°W: Faroe Islands offshore; Ireland - offshore; Jan Mayen - offshore; Norway including Svalbard - offshore; Spain - onshore and offshore.&quot;],</span></span>
<span id="cb62-45"><a href="casos.html#cb62-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         BBOX[35.26,-6,80.53,0]],</span></span>
<span id="cb62-46"><a href="casos.html#cb62-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     ID[&quot;EPSG&quot;,25830]]</span></span></code></pre></div>
<p>Una vez que se dispone del objeto espacial <code>pols</code> completo, es posible usar
<strong>ggplot2</strong> de la manera habitual</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="casos.html#cb63-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-2"><a href="casos.html#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extramos nuevamente una imagen de Valencia</span></span>
<span id="cb63-3"><a href="casos.html#cb63-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-4"><a href="casos.html#cb63-4" aria-hidden="true" tabindex="-1"></a>tile2 <span class="ot">&lt;-</span> <span class="fu">esp_getTiles</span>(valencia, <span class="st">&quot;IDErioja&quot;</span>, <span class="at">zoommin =</span> <span class="dv">1</span>)</span>
<span id="cb63-5"><a href="casos.html#cb63-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-6"><a href="casos.html#cb63-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb63-7"><a href="casos.html#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Añadimos imagen</span></span>
<span id="cb63-8"><a href="casos.html#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_spatraster</span>(tile2) <span class="sc">+</span></span>
<span id="cb63-9"><a href="casos.html#cb63-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Añadimos polígonos con la intensidad</span></span>
<span id="cb63-10"><a href="casos.html#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb63-11"><a href="casos.html#cb63-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> pols, <span class="fu">aes</span>(<span class="at">fill =</span> layer),</span>
<span id="cb63-12"><a href="casos.html#cb63-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="cn">NA</span>, <span class="at">size =</span> <span class="fl">0.01</span></span>
<span id="cb63-13"><a href="casos.html#cb63-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb63-14"><a href="casos.html#cb63-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Añadimos localización exacta</span></span>
<span id="cb63-15"><a href="casos.html#cb63-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb63-16"><a href="casos.html#cb63-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> crimen_sf, <span class="at">col =</span> <span class="st">&quot;grey90&quot;</span>,</span>
<span id="cb63-17"><a href="casos.html#cb63-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.3</span>,</span>
<span id="cb63-18"><a href="casos.html#cb63-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.1</span></span>
<span id="cb63-19"><a href="casos.html#cb63-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb63-20"><a href="casos.html#cb63-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Estética del mapa</span></span>
<span id="cb63-21"><a href="casos.html#cb63-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(</span>
<span id="cb63-22"><a href="casos.html#cb63-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">colours =</span> <span class="fu">hcl.colors</span>(<span class="dv">50</span>, <span class="st">&quot;Inferno&quot;</span>,</span>
<span id="cb63-23"><a href="casos.html#cb63-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">alpha =</span> <span class="fl">0.9</span>, <span class="at">rev =</span> <span class="cn">TRUE</span></span>
<span id="cb63-24"><a href="casos.html#cb63-24" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb63-25"><a href="casos.html#cb63-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_math</span>(),</span>
<span id="cb63-26"><a href="casos.html#cb63-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">n.breaks =</span> <span class="dv">10</span></span>
<span id="cb63-27"><a href="casos.html#cb63-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb63-28"><a href="casos.html#cb63-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb63-29"><a href="casos.html#cb63-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&quot;Intensidad&quot;</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-28"></span>
<img src="Visualización_geolocalización_datos_files/figure-html/unnamed-chunk-28-1.png" alt="Estimación kernel con ggplot2" width="60%" />
<p class="caption">
Figura 5.19: Estimación kernel con ggplot2
</p>
</div>
<p>Nótese que los conocimientos teóricos necesarios para llevar a cabo este tipo de
estimación están fuera del ámbito de este manual. El ejercicio anterior se
presenta a modo meramente ilustrativo.</p>

</div>
</div>
<h3>Referencias</h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-spatstat_2005" class="csl-entry">
Baddeley, Adrian, and Rolf Turner. 2005. <span>“<span class="nocase">spatstat</span>: An <span>R</span> Package for Analyzing Spatial Point Patterns.”</span> <em>Journal of Statistical Software</em> 12 (6): 1–42. <a href="https://doi.org/10.18637/jss.v012.i06">https://doi.org/10.18637/jss.v012.i06</a>.
</div>
<div id="ref-R-classint" class="csl-entry">
Bivand, Roger. 2020. <em><span class="nocase">classInt</span>: Choose Univariate Class Intervals</em>. <a href="https://CRAN.R-project.org/package=classInt">https://CRAN.R-project.org/package=classInt</a>.
</div>
<div id="ref-R-mapsf" class="csl-entry">
Giraud, Timothée. 2022. <em><span class="nocase">mapsf</span>: Thematic Cartography</em>. <a href="https://CRAN.R-project.org/package=mapsf">https://CRAN.R-project.org/package=mapsf</a>.
</div>
<div id="ref-R-gstat" class="csl-entry">
Pebesma, Edzer. 2004. <span>“Multivariable Geostatistics in <span>S</span>: The <span class="nocase">gstat</span> Package.”</span> <em>Computers &amp; Geosciences</em> 30: 683–91.
</div>
<div id="ref-R-climaemet" class="csl-entry">
Pizarro, Manuel, Diego Hernangómez, and Gema Fernández-Avilés. 2021. <em><span class="nocase">climaemet</span>: Climate <span>AEMET</span> Tools</em>. <a href="https://doi.org/10.5281/zenodo.5205573">https://doi.org/10.5281/zenodo.5205573</a>.
</div>
<div id="ref-R-geor" class="csl-entry">
Ribeiro Jr, Paulo J., Peter J. Diggle, Martin Schlather, Roger Bivand, and Brian Ripley. 2020. <em><span class="nocase">geoR</span>: Analysis of Geostatistical Data</em>. <a href="https://CRAN.R-project.org/package=geoR">https://CRAN.R-project.org/package=geoR</a>.
</div>
<div id="ref-R-tmap" class="csl-entry">
Tennekes, Martijn. 2018. <span>“<span class="nocase">tmap</span>: Thematic Maps in <span>R</span>.”</span> <em>Journal of Statistical Software</em> 84 (6): 1–39. <a href="https://doi.org/10.18637/jss.v084.i06">https://doi.org/10.18637/jss.v084.i06</a>.
</div>
<div id="ref-R-ggplot" class="csl-entry">
Wickham, Hadley. 2016. <em><span class="nocase">ggplot2</span>: Elegant Graphics for Data Analysis</em>. Springer-Verlag New York. <a href="https://ggplot2.tidyverse.org">https://ggplot2.tidyverse.org</a>.
</div>
<div id="ref-R-tidyverse" class="csl-entry">
Wickham, Hadley, Mara Averick, Jennifer Bryan, Winston Chang, Lucy D’Agostino McGowan, Romain François, Garrett Grolemund, et al. 2019. <span>“Welcome to the <span class="nocase">tidyverse</span>.”</span> <em>Journal of Open Source Software</em> 4 (43): 1686. <a href="https://doi.org/10.21105/joss.01686">https://doi.org/10.21105/joss.01686</a>.
</div>
<div id="ref-R-readr" class="csl-entry">
Wickham, Hadley, Jim Hester, and Jennifer Bryan. 2022. <em><span class="nocase">readr</span>: Read Rectangular Text Data</em>. <a href="https://CRAN.R-project.org/package=readr">https://CRAN.R-project.org/package=readr</a>.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>Las fechas seleccionadas coinciden con el periodo en el que
la tormenta Filomena tuvo su auge en la Península Ibérica.<a href="casos.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="dep-esp.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="referencias.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["Visualización_geolocalización_datos.pdf", "Visualización_geolocalización_datos.epub"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
