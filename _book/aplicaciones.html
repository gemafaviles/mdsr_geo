<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 5 Aplicaciones | Visualización y geolocalización de datos</title>
  <meta name="description" content="Máster en Data Science &amp; Business Analytics (con R Software)" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 5 Aplicaciones | Visualización y geolocalización de datos" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Máster en Data Science &amp; Business Analytics (con R Software)" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 5 Aplicaciones | Visualización y geolocalización de datos" />
  
  <meta name="twitter:description" content="Máster en Data Science &amp; Business Analytics (con R Software)" />
  

<meta name="author" content="Gema Fernández-Avilés" />
<meta name="author" content="Diego Hernangómez" />


<meta name="date" content="2022-01-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="estadística-espacial.html"/>
<link rel="next" href="referencias.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Visualización y geolocalización de datos</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Introducción</a></li>
<li class="chapter" data-level="1" data-path="la-revolución-de-los-geodatos.html"><a href="la-revolución-de-los-geodatos.html"><i class="fa fa-check"></i><b>1</b> La revolución de los geodatos</a></li>
<li class="chapter" data-level="2" data-path="datos-geográficos.html"><a href="datos-geográficos.html"><i class="fa fa-check"></i><b>2</b> Datos geográficos</a>
<ul>
<li class="chapter" data-level="2.1" data-path="datos-geográficos.html"><a href="datos-geográficos.html#contexto-general"><i class="fa fa-check"></i><b>2.1</b> Contexto general</a></li>
<li class="chapter" data-level="2.2" data-path="datos-geográficos.html"><a href="datos-geográficos.html#conceptos-clave"><i class="fa fa-check"></i><b>2.2</b> Conceptos clave</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="formatos.html"><a href="formatos.html"><i class="fa fa-check"></i><b>3</b> Formatos de datos espaciales</a>
<ul>
<li class="chapter" data-level="3.1" data-path="formatos.html"><a href="formatos.html#tipos-de-ficheros-completar"><i class="fa fa-check"></i><b>3.1</b> Tipos de ficheros (COMPLETAR)</a></li>
<li class="chapter" data-level="3.2" data-path="formatos.html"><a href="formatos.html#datos-de-vectores"><i class="fa fa-check"></i><b>3.2</b> Datos de vectores</a></li>
<li class="chapter" data-level="3.3" data-path="formatos.html"><a href="formatos.html#datos-raster"><i class="fa fa-check"></i><b>3.3</b> Datos raster</a></li>
<li class="chapter" data-level="3.4" data-path="formatos.html"><a href="formatos.html#CRS"><i class="fa fa-check"></i><b>3.4</b> Sistema de Referencia de Coordenadas (CRS)</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="formatos.html"><a href="formatos.html#tipos-de-crs"><i class="fa fa-check"></i><b>3.4.1</b> Tipos de CRS</a></li>
<li class="chapter" data-level="3.4.2" data-path="formatos.html"><a href="formatos.html#trabajando-con-proyecciones-en-r"><i class="fa fa-check"></i><b>3.4.2</b> Trabajando con proyecciones en R</a></li>
<li class="chapter" data-level="3.4.3" data-path="formatos.html"><a href="formatos.html#quecrsuso"><i class="fa fa-check"></i><b>3.4.3</b> ¿Qué proyección uso?</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="estadística-espacial.html"><a href="estadística-espacial.html"><i class="fa fa-check"></i><b>4</b> Estadística espacial</a>
<ul>
<li class="chapter" data-level="4.1" data-path="estadística-espacial.html"><a href="estadística-espacial.html#antes-de-continuar-dependencia-espacial."><i class="fa fa-check"></i><b>4.1</b> Antes de continuar… dependencia espacial.</a></li>
<li class="chapter" data-level="4.2" data-path="estadística-espacial.html"><a href="estadística-espacial.html#datos-espaciales"><i class="fa fa-check"></i><b>4.2</b> Datos espaciales</a></li>
<li class="chapter" data-level="4.3" data-path="estadística-espacial.html"><a href="estadística-espacial.html#clasificación-de-datos-espaciales"><i class="fa fa-check"></i><b>4.3</b> Clasificación de datos espaciales</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="aplicaciones.html"><a href="aplicaciones.html"><i class="fa fa-check"></i><b>5</b> Aplicaciones</a>
<ul>
<li class="chapter" data-level="5.1" data-path="aplicaciones.html"><a href="aplicaciones.html#temperaturas-mínimas-en-españa"><i class="fa fa-check"></i><b>5.1</b> Temperaturas mínimas en España</a></li>
<li class="chapter" data-level="5.2" data-path="aplicaciones.html"><a href="aplicaciones.html#renta-media-por-municipios"><i class="fa fa-check"></i><b>5.2</b> Renta media por municipios</a></li>
<li class="chapter" data-level="5.3" data-path="aplicaciones.html"><a href="aplicaciones.html#análisis-de-patrones-de-puntos"><i class="fa fa-check"></i><b>5.3</b> Análisis de patrones de puntos</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="referencias.html"><a href="referencias.html"><i class="fa fa-check"></i>Referencias</a></li>
<li class="appendix"><span><b>Anexo</b></span></li>
<li class="chapter" data-level="A" data-path="crsproy.html"><a href="crsproy.html"><i class="fa fa-check"></i><b>A</b> Tipos de CRS proyectados</a>
<ul>
<li class="chapter" data-level="A.1" data-path="crsproy.html"><a href="crsproy.html#por-tipo-de-superficie-de-proyección"><i class="fa fa-check"></i><b>A.1</b> Por tipo de superficie de proyección</a></li>
<li class="chapter" data-level="A.2" data-path="crsproy.html"><a href="crsproy.html#por-métrica-a-preservar"><i class="fa fa-check"></i><b>A.2</b> Por métrica a preservar</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="./">Máster en Data Science & Business Analytics (con R Software)</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Visualización y geolocalización de datos</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="aplicaciones" class="section level1" number="5">
<h1><span class="header-section-number">Capítulo 5</span> Aplicaciones</h1>
<p><em><strong>NOTA</strong>: En las siguientes aplicaciones se asumen que los datos se localizan
en la carpeta <code>data</code> del proyecto de R-Studio en el que se esté trabajando.</em></p>
<div id="temperaturas-mínimas-en-españa" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Temperaturas mínimas en España</h2>
<p><strong>Objetivo de aprendizaje</strong></p>
<p>Este caso práctico muestra como leer y graficar datos espaciales en R. Para
ello, vamos a trabajar con los datos de temperatura mínima registradas en España
por las estaciones metereológicas de la AEMET.</p>
<p><em>Tarea 1: Abrimos RStudio</em></p>
<p>El presente análisis se va a realizar empleando RStudio, por lo que empezaremos
abriendo el programa y creando un nuevo proyecto de R en <em>File&gt;New Proyect</em>.</p>
<p><em>Tarea 2: Importamos y describimos los datos objeto de estudio</em></p>
<p>El conjunto de datos proporcionado <code>(tempmin.csv</code>) contiene el nivel de
temperatura del aire en España entre el 6 y el 10 de Enero de
2021<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>. Estos datos han sido descargados usando la librería
<code>climaemet</code> <span class="citation">(<a href="#ref-R-climaemet" role="doc-biblioref">Pizarro, Hernangómez, &amp; Fernández-Avilés, 2021</a>)</span> y han sido posteriormente tratados para su uso en
esta práctica.</p>
<p>El primer paso consiste en importar la base de datos de temperatura mínima. El
archivo está en formato csv, por lo cual es un fichero de texto plano. Podemos
usar varias funciones para realizar la importación, en este caso vamos a emplear
paquetes del <code>tidyverse</code> para realizar todo el tratamiento de datos:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="aplicaciones.html#cb25-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-2"><a href="aplicaciones.html#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb25-3"><a href="aplicaciones.html#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="aplicaciones.html#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># cada uno debe seleccionar el directorio donde tiene los datos, de ahí</span></span>
<span id="cb25-5"><a href="aplicaciones.html#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="co"># que sea conveniente trabajar con proyectos</span></span>
<span id="cb25-6"><a href="aplicaciones.html#cb25-6" aria-hidden="true" tabindex="-1"></a>tmin <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/tempmin.csv&quot;</span>)</span></code></pre></div>
<p><strong>Q1: ¿Qué información tiene <code>tmin</code>?</strong></p>
<table>
<caption><span id="tab:tmin-head">Tabla 5.1: </span>Detalle del objeto tmin</caption>
<thead>
<tr class="header">
<th align="left">fecha</th>
<th align="left">indicativo</th>
<th align="right">tmin</th>
<th align="right">longitud</th>
<th align="right">latitud</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">2021-01-06</td>
<td align="left">4358X</td>
<td align="right">-4.7</td>
<td align="right">-5.880556</td>
<td align="right">38.95556</td>
</tr>
<tr class="even">
<td align="left">2021-01-06</td>
<td align="left">4220X</td>
<td align="right">-7.0</td>
<td align="right">-4.616389</td>
<td align="right">39.08861</td>
</tr>
<tr class="odd">
<td align="left">2021-01-06</td>
<td align="left">6106X</td>
<td align="right">4.7</td>
<td align="right">-4.748333</td>
<td align="right">37.02944</td>
</tr>
<tr class="even">
<td align="left">2021-01-06</td>
<td align="left">9698U</td>
<td align="right">-6.8</td>
<td align="right">0.865278</td>
<td align="right">42.20528</td>
</tr>
<tr class="odd">
<td align="left">2021-01-06</td>
<td align="left">4410X</td>
<td align="right">-3.4</td>
<td align="right">-6.385556</td>
<td align="right">38.91583</td>
</tr>
<tr class="even">
<td align="left">2021-01-06</td>
<td align="left">1331A</td>
<td align="right">1.0</td>
<td align="right">-7.031389</td>
<td align="right">43.52472</td>
</tr>
</tbody>
</table>
<p>Podemos observar que la tabla generada contiene 5 columnas distintas:</p>
<ul>
<li><p><code>fecha</code>: Indicando la fecha de observación.</p></li>
<li><p><code>indicativo</code>: Es el identificador de la estación de la AEMET que registró el
dato.</p></li>
<li><p><code>tmin</code>: Dato de temperatura mínima registrada en cada fecha por la estación
correspondiente en grados centígrados.</p></li>
<li><p><code>longitud,latitud</code>: Coordenadas geográficas de la estación</p></li>
</ul>
<p><em>Tarea 3. Convertir</em> <code>tmin</code> <em>a un objeto de la clase espacial</em> <code>geoR</code></p>
<p>Para convertir un objeto a geodata (el formato requerido por <code>geoR</code>),
proporcionaremos una tabla con las coordenadas y los valores a incluir en cada
coordenada. En este ejemplo, vamos a emplear sólamente los datos
correspondientes al <strong>8 de enero.</strong></p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="aplicaciones.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb26-2"><a href="aplicaciones.html#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(geoR)</span>
<span id="cb26-3"><a href="aplicaciones.html#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="aplicaciones.html#cb26-4" aria-hidden="true" tabindex="-1"></a>tmin_geoR <span class="ot">&lt;-</span> tmin <span class="sc">%&gt;%</span></span>
<span id="cb26-5"><a href="aplicaciones.html#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fecha <span class="sc">==</span> <span class="st">&quot;2021-01-08&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-6"><a href="aplicaciones.html#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Seleccionamos las columnas de interés</span></span>
<span id="cb26-7"><a href="aplicaciones.html#cb26-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(longitud, latitud, tmin) <span class="sc">%&gt;%</span></span>
<span id="cb26-8"><a href="aplicaciones.html#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Y creamos el objeto geodata</span></span>
<span id="cb26-9"><a href="aplicaciones.html#cb26-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.geodata</span>(</span>
<span id="cb26-10"><a href="aplicaciones.html#cb26-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">coords.col =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb26-11"><a href="aplicaciones.html#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data.col =</span> <span class="dv">3</span></span>
<span id="cb26-12"><a href="aplicaciones.html#cb26-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb26-13"><a href="aplicaciones.html#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="aplicaciones.html#cb26-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-15"><a href="aplicaciones.html#cb26-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tmin_geoR)</span>
<span id="cb26-16"><a href="aplicaciones.html#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Number of data points: 211 </span></span>
<span id="cb26-17"><a href="aplicaciones.html#cb26-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb26-18"><a href="aplicaciones.html#cb26-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Coordinates summary</span></span>
<span id="cb26-19"><a href="aplicaciones.html#cb26-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      longitud  latitud</span></span>
<span id="cb26-20"><a href="aplicaciones.html#cb26-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; min -9.291389 35.27639</span></span>
<span id="cb26-21"><a href="aplicaciones.html#cb26-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; max  4.215556 43.78611</span></span>
<span id="cb26-22"><a href="aplicaciones.html#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb26-23"><a href="aplicaciones.html#cb26-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Distance summary</span></span>
<span id="cb26-24"><a href="aplicaciones.html#cb26-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         min         max </span></span>
<span id="cb26-25"><a href="aplicaciones.html#cb26-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  0.01024389 13.85144264 </span></span>
<span id="cb26-26"><a href="aplicaciones.html#cb26-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb26-27"><a href="aplicaciones.html#cb26-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Data summary</span></span>
<span id="cb26-28"><a href="aplicaciones.html#cb26-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        Min.     1st Qu.      Median        Mean     3rd Qu.        Max. </span></span>
<span id="cb26-29"><a href="aplicaciones.html#cb26-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; -14.9000000  -4.6000000  -0.5000000  -0.6293839   3.5000000  13.6000000</span></span>
<span id="cb26-30"><a href="aplicaciones.html#cb26-30" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tmin_geoR)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-9"></span>
<img src="_main_files/figure-html/unnamed-chunk-9-1.png" alt="Objetos en geoR" width="60%" />
<p class="caption">
Figura 5.1: Objetos en geoR
</p>
</div>
<p><em>Tarea 4. Convertir</em> <code>tmin</code> <em>a un objeto de la clase espacial</em> <code>sf</code></p>
<p>En esta tarea, convertiremos los datos de tmin en un objeto espacial <code>sf</code>, es
decir, datos espaciales de tipo vector.</p>
<p>Los datos de <code>tmin</code> contienen coordenadas geográficas longitud/latitud, asi que
como vimos en la sección <strong>Sistema de Referencia de Coordenadas (CRS)</strong> el CRS a
emplear ha de ser un CRS geográfico. Usaremos el código EPSG <strong>4326</strong>, que
corresponde a coordenadas geográficas y suele ser el habitual en este tipo de
situaciones.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="aplicaciones.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb27-2"><a href="aplicaciones.html#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="aplicaciones.html#cb27-3" aria-hidden="true" tabindex="-1"></a>tmin_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(tmin,</span>
<span id="cb27-4"><a href="aplicaciones.html#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;longitud&quot;</span>, <span class="st">&quot;latitud&quot;</span>),</span>
<span id="cb27-5"><a href="aplicaciones.html#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">crs =</span> <span class="dv">4326</span></span>
<span id="cb27-6"><a href="aplicaciones.html#cb27-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-7"><a href="aplicaciones.html#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="aplicaciones.html#cb27-8" aria-hidden="true" tabindex="-1"></a>tmin_sf</span>
<span id="cb27-9"><a href="aplicaciones.html#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 1066 features and 3 fields</span></span>
<span id="cb27-10"><a href="aplicaciones.html#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: POINT</span></span>
<span id="cb27-11"><a href="aplicaciones.html#cb27-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb27-12"><a href="aplicaciones.html#cb27-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -9.291389 ymin: 35.27639 xmax: 4.215556 ymax: 43.78611</span></span>
<span id="cb27-13"><a href="aplicaciones.html#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  WGS 84</span></span>
<span id="cb27-14"><a href="aplicaciones.html#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1,066 x 4</span></span>
<span id="cb27-15"><a href="aplicaciones.html#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    fecha      indicativo  tmin             geometry</span></span>
<span id="cb27-16"><a href="aplicaciones.html#cb27-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  * &lt;date&gt;     &lt;chr&gt;      &lt;dbl&gt;          &lt;POINT [°]&gt;</span></span>
<span id="cb27-17"><a href="aplicaciones.html#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1 2021-01-06 4358X       -4.7 (-5.880556 38.95556)</span></span>
<span id="cb27-18"><a href="aplicaciones.html#cb27-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  2 2021-01-06 4220X       -7   (-4.616389 39.08861)</span></span>
<span id="cb27-19"><a href="aplicaciones.html#cb27-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3 2021-01-06 6106X        4.7 (-4.748333 37.02944)</span></span>
<span id="cb27-20"><a href="aplicaciones.html#cb27-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  4 2021-01-06 9698U       -6.8  (0.865278 42.20528)</span></span>
<span id="cb27-21"><a href="aplicaciones.html#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  5 2021-01-06 4410X       -3.4 (-6.385556 38.91583)</span></span>
<span id="cb27-22"><a href="aplicaciones.html#cb27-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  6 2021-01-06 1331A        1   (-7.031389 43.52472)</span></span>
<span id="cb27-23"><a href="aplicaciones.html#cb27-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  7 2021-01-06 1690A       -0.1 (-7.859722 42.32528)</span></span>
<span id="cb27-24"><a href="aplicaciones.html#cb27-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  8 2021-01-06 8489X       -8   (-0.255833 40.43333)</span></span>
<span id="cb27-25"><a href="aplicaciones.html#cb27-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  9 2021-01-06 8025         2    (-0.494167 38.3725)</span></span>
<span id="cb27-26"><a href="aplicaciones.html#cb27-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10 2021-01-06 9784P      -10       (0.224722 42.63)</span></span>
<span id="cb27-27"><a href="aplicaciones.html#cb27-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # ... with 1,056 more rows</span></span></code></pre></div>
<p><em>Tarea 5: Dibujemos las estaciones de monitoreo de la temperaria mínima en un
mapa de España. Ámbito espacial.</em></p>
<p>Vamos, además, a incluir una capa de las comunidades autónomas de España. Para
ello usaremos un paquete API que nos proporciona esta información en formato
<code>sf</code>:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="aplicaciones.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapSpain)</span>
<span id="cb28-2"><a href="aplicaciones.html#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sf object</span></span>
<span id="cb28-3"><a href="aplicaciones.html#cb28-3" aria-hidden="true" tabindex="-1"></a>esp <span class="ot">&lt;-</span> <span class="fu">esp_get_ccaa</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="aplicaciones.html#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># No vamos a usar Canarias en este análisis</span></span>
<span id="cb28-5"><a href="aplicaciones.html#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ine.ccaa.name <span class="sc">!=</span> <span class="st">&quot;Canarias&quot;</span>)</span>
<span id="cb28-6"><a href="aplicaciones.html#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="aplicaciones.html#cb28-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-8"><a href="aplicaciones.html#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(esp<span class="sc">$</span>geometry) <span class="co"># Dibujamo el mapa de España menos las Islas Canarias</span></span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-11"></span>
<img src="_main_files/figure-html/unnamed-chunk-11-1.png" alt="Mapa de España (Sin Canarias)" width="60%" />
<p class="caption">
Figura 5.2: Mapa de España (Sin Canarias)
</p>
</div>
<p><strong>Q2: ¿Tengo el Sistema de referencia de coordenadas (CRS) de las estaciones de
monitoreo en la misma proyección que el contorno de España?</strong></p>
<p>Como se comentó en la sección <strong>Sistema de Referencia de Coordenadas (CRS)</strong>,
cuando se emplean datos geográficos provenientes de varias fuentes, es necesario
asegurarse de que ambos objetos están usando el mismo CRS. Vamos a comprobarlo:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="aplicaciones.html#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(tmin_sf) <span class="sc">==</span> <span class="fu">st_crs</span>(esp)</span>
<span id="cb29-2"><a href="aplicaciones.html#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>Vemos que no lo están, por lo que vamos a proyectar las coordenadas a un CRS
común. En este caso usaremos el CRS de referencia de <code>tmin_sf</code>:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="aplicaciones.html#cb30-1" aria-hidden="true" tabindex="-1"></a>esp2 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(esp, <span class="fu">st_crs</span>(tmin_sf))</span>
<span id="cb30-2"><a href="aplicaciones.html#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="aplicaciones.html#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="fu">st_crs</span>(tmin_sf) <span class="sc">==</span> <span class="fu">st_crs</span>(esp2)</span>
<span id="cb30-4"><a href="aplicaciones.html#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>Dibujamos las estaciones de monitoreo con el contorno de España. Vamos a usar el
paquete <code>ggplot2</code> como referencia, sin embargo existen varios paquetes
especializados en mapas temáticos, como pueden ser <code>tmap</code> o <code>mapsf</code>.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="aplicaciones.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb31-2"><a href="aplicaciones.html#cb31-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-3"><a href="aplicaciones.html#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(esp2) <span class="sc">+</span></span>
<span id="cb31-4"><a href="aplicaciones.html#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Para graficar objetos sf debemos usar geom_sf()</span></span>
<span id="cb31-5"><a href="aplicaciones.html#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb31-6"><a href="aplicaciones.html#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> tmin_sf) <span class="sc">+</span></span>
<span id="cb31-7"><a href="aplicaciones.html#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb31-8"><a href="aplicaciones.html#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb31-9"><a href="aplicaciones.html#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Estaciones de monitoreo AEMET en  España&quot;</span>,</span>
<span id="cb31-10"><a href="aplicaciones.html#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;excluyendo las Islas Canarias&quot;</span></span>
<span id="cb31-11"><a href="aplicaciones.html#cb31-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb31-12"><a href="aplicaciones.html#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb31-13"><a href="aplicaciones.html#cb31-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-14"><a href="aplicaciones.html#cb31-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">12</span>,</span>
<span id="cb31-15"><a href="aplicaciones.html#cb31-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">&quot;bold&quot;</span></span>
<span id="cb31-16"><a href="aplicaciones.html#cb31-16" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb31-17"><a href="aplicaciones.html#cb31-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(</span>
<span id="cb31-18"><a href="aplicaciones.html#cb31-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">size =</span> <span class="dv">8</span>,</span>
<span id="cb31-19"><a href="aplicaciones.html#cb31-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">face =</span> <span class="st">&quot;italic&quot;</span></span>
<span id="cb31-20"><a href="aplicaciones.html#cb31-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb31-21"><a href="aplicaciones.html#cb31-21" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-13"></span>
<img src="_main_files/figure-html/unnamed-chunk-13-1.png" alt="Estaciones de AEMET en la Península Ibérica" width="60%" />
<p class="caption">
Figura 5.3: Estaciones de AEMET en la Península Ibérica
</p>
</div>
<p><em>Tarea 6: Representamos la variable temperatura mínima <code>tmin</code> para el día 8 de
enero de 2021.</em></p>
<p>En la siguiente tarea, seleccionaremos los datos correspondientes al <strong>8 de
enero de 2021</strong> y crearemos un mapa temático en el que representaremos los
valores de temperatura mínima registrados en cada estación mediante un código de
colores.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="aplicaciones.html#cb32-1" aria-hidden="true" tabindex="-1"></a>tmin_8enero <span class="ot">&lt;-</span> tmin_sf <span class="sc">%&gt;%</span></span>
<span id="cb32-2"><a href="aplicaciones.html#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># seleccionamos el día y la variable</span></span>
<span id="cb32-3"><a href="aplicaciones.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(fecha <span class="sc">==</span> <span class="st">&quot;2021-01-08&quot;</span>)</span>
<span id="cb32-4"><a href="aplicaciones.html#cb32-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-5"><a href="aplicaciones.html#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="aplicaciones.html#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(tmin_8enero[<span class="st">&quot;tmin&quot;</span>],</span>
<span id="cb32-7"><a href="aplicaciones.html#cb32-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Temperatura mínima (8-enero-2021)&quot;</span>,</span>
<span id="cb32-8"><a href="aplicaciones.html#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">8</span></span>
<span id="cb32-9"><a href="aplicaciones.html#cb32-9" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:plot-base-tmin"></span>
<img src="_main_files/figure-html/plot-base-tmin-1.png" alt="Mapa de puntos con temperatura mínima" width="60%" />
<p class="caption">
Figura 5.4: Mapa de puntos con temperatura mínima
</p>
</div>
<p>Podemos utilizar el ámbito espacial, el contorno de España para graficar y
contar la historia de la Filomena un poco mejor.</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:spatial-plots"></span>
<img src="_main_files/figure-html/spatial-plots-1.png" alt="Mapa completo con temperatura mínima" width="60%" />
<p class="caption">
Figura 5.5: Mapa completo con temperatura mínima
</p>
</div>
<p><em>Tarea 7: Interpolación de la variable temperatura mínima <code>tmin</code> para el día 8
de enero de 2021 con IDW</em></p>
<p><strong>Q3</strong>: El mapa ha quedado muy claro. Vemos como los datos nos cuentan la
historia de Filomena en aquellos sitios donde se tomaron mediciones, pero
<strong>¿podríamos tener un mapa de interpolación para tener una estimación de la
temperatura mínima en las partes donde la AEMET no tiene estación de
monitoreo?</strong></p>
<p>Tal y como se avanzó en teoría, parece lógico pensar que aquellos puntos que
estén cerca tendrán valores similares así que tomemos ventaja de la dependencia
espacial y utilicemos un método determinista, como la Distancia Inversa
Ponderada, comúnmente conocido por su acrónimo inglés IDW (Inverse distance
weighted), el cual es uno de los métodos más simples para llevar para llevar a
cabo una interpolación espacial.</p>
<p>En este tipo de análisis, es crucial que el CRS sea el apropiado. En este caso,
ya definimos el CRS como un CRS geográfico (es decir, usando coordenadas de
longitud y latitud). Sin embargo, para el ejercicio de interpolación es más
adecuado usar un CRS local (que provoque pocas deformaciones en la proyección de
España) y en alguna unidad de distancia, como metros (ya vimos que en los CRS
geográficos las unidades son grados).</p>
<p>Si usamos el paquete <code>crsuggest</code> podemos observar los CRS sugeridos:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="aplicaciones.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(crsuggest)</span>
<span id="cb33-2"><a href="aplicaciones.html#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="aplicaciones.html#cb33-3" aria-hidden="true" tabindex="-1"></a>sugiere <span class="ot">&lt;-</span> <span class="fu">suggest_crs</span>(tmin_8enero, <span class="at">units =</span> <span class="st">&quot;m&quot;</span>, <span class="at">limit =</span> <span class="dv">5</span>)</span>
<span id="cb33-4"><a href="aplicaciones.html#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="aplicaciones.html#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Usamos la sugerencia del paquete</span></span>
<span id="cb33-6"><a href="aplicaciones.html#cb33-6" aria-hidden="true" tabindex="-1"></a>crs_sugerido <span class="ot">&lt;-</span> <span class="fu">st_crs</span>(sugiere[<span class="dv">1</span>, ]<span class="sc">$</span>crs_proj4)</span>
<span id="cb33-7"><a href="aplicaciones.html#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="aplicaciones.html#cb33-8" aria-hidden="true" tabindex="-1"></a>esp3 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(esp2, crs_sugerido)</span>
<span id="cb33-9"><a href="aplicaciones.html#cb33-9" aria-hidden="true" tabindex="-1"></a>tmin_8enero3 <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(tmin_8enero, crs_sugerido)</span></code></pre></div>
<p><strong>Q4: ¿Dónde vamos a interpolar? ¿En que puntos?</strong></p>
<p>Para realizar la interpolación, necesitamos generar una malla que representará
las celdas de las que queremos obtener el valor interpolado.</p>
<p>Dado que hemos proyectado nuestros datos a un CRS cuya unidad son los metros,
podemos definir el tamaño de cada celda en metros cuadrados. En este caso vamos
a usar celdas de 100 kms cuadrados (10 x 10 kms):</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="aplicaciones.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">9876</span>) <span class="co"># Con esto aseguramos que el grid generado siempre es igual</span></span>
<span id="cb34-2"><a href="aplicaciones.html#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="aplicaciones.html#cb34-3" aria-hidden="true" tabindex="-1"></a>malla_sf <span class="ot">&lt;-</span> <span class="fu">st_make_grid</span>(</span>
<span id="cb34-4"><a href="aplicaciones.html#cb34-4" aria-hidden="true" tabindex="-1"></a>  esp3,</span>
<span id="cb34-5"><a href="aplicaciones.html#cb34-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">cellsize =</span> <span class="dv">8000</span></span>
<span id="cb34-6"><a href="aplicaciones.html#cb34-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p>Graficamos la superficie para ver exactamente qué hemos construido:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="aplicaciones.html#cb35-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-2"><a href="aplicaciones.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(esp3) <span class="sc">+</span></span>
<span id="cb35-3"><a href="aplicaciones.html#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb35-4"><a href="aplicaciones.html#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb35-5"><a href="aplicaciones.html#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> malla_sf,</span>
<span id="cb35-6"><a href="aplicaciones.html#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.1</span>,</span>
<span id="cb35-7"><a href="aplicaciones.html#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb35-8"><a href="aplicaciones.html#cb35-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="cn">NA</span></span>
<span id="cb35-9"><a href="aplicaciones.html#cb35-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb35-10"><a href="aplicaciones.html#cb35-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb35-11"><a href="aplicaciones.html#cb35-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> tmin_8enero3,</span>
<span id="cb35-12"><a href="aplicaciones.html#cb35-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">fill =</span> <span class="st">&quot;AEMET Stations&quot;</span>), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb35-13"><a href="aplicaciones.html#cb35-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;blue&quot;</span></span>
<span id="cb35-14"><a href="aplicaciones.html#cb35-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb35-15"><a href="aplicaciones.html#cb35-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">adjustcolor</span>(<span class="st">&quot;blue&quot;</span>, <span class="at">alpha.f =</span> <span class="fl">0.2</span>)) <span class="sc">+</span></span>
<span id="cb35-16"><a href="aplicaciones.html#cb35-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb35-17"><a href="aplicaciones.html#cb35-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb35-18"><a href="aplicaciones.html#cb35-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb35-19"><a href="aplicaciones.html#cb35-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Cuadrícula espacial para interpolar&quot;</span>,</span>
<span id="cb35-20"><a href="aplicaciones.html#cb35-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb35-21"><a href="aplicaciones.html#cb35-21" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-15"></span>
<img src="_main_files/figure-html/unnamed-chunk-15-1.png" alt="Malla de puntos para interpolación" width="60%" />
<p class="caption">
Figura 5.6: Malla de puntos para interpolación
</p>
</div>
<p>Se puede observar claramente cada una de las celdas que hemos creado. La
interpolación asignará un valor a cada uno de ellas.</p>
<p>A continuación podemos llevar a cabo la interpolación usando el paquete <code>gstat</code>.
Además, en lugar de celdas (polígonos) es necesario usar puntos en la
interpolación. Calcularemos, por tanto, un punto representativo de cada celda,
el centroide, que es el punto resultante de realizar la media arimética de las
coordenadas de loss puntos que componen los lados de cada celda</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="aplicaciones.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculamos centroide</span></span>
<span id="cb36-2"><a href="aplicaciones.html#cb36-2" aria-hidden="true" tabindex="-1"></a>malla_sf_cent <span class="ot">&lt;-</span> <span class="fu">st_centroid</span>(malla_sf, <span class="at">of_largest_polygon =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-3"><a href="aplicaciones.html#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="aplicaciones.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gstat)</span>
<span id="cb36-5"><a href="aplicaciones.html#cb36-5" aria-hidden="true" tabindex="-1"></a>tmin_idw <span class="ot">&lt;-</span> <span class="fu">idw</span>(</span>
<span id="cb36-6"><a href="aplicaciones.html#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Indicamos la variable que queremos interpolar</span></span>
<span id="cb36-7"><a href="aplicaciones.html#cb36-7" aria-hidden="true" tabindex="-1"></a>  tmin <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb36-8"><a href="aplicaciones.html#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Indicamos el conjunto de datos donde está la variable</span></span>
<span id="cb36-9"><a href="aplicaciones.html#cb36-9" aria-hidden="true" tabindex="-1"></a>  tmin_8enero3,</span>
<span id="cb36-10"><a href="aplicaciones.html#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Indicamos la malla de destino, en sf</span></span>
<span id="cb36-11"><a href="aplicaciones.html#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">newdata =</span> malla_sf_cent,</span>
<span id="cb36-12"><a href="aplicaciones.html#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">idp =</span> <span class="fl">2.0</span> <span class="co"># Especifica la potencia de la IDW</span></span>
<span id="cb36-13"><a href="aplicaciones.html#cb36-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-14"><a href="aplicaciones.html#cb36-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [inverse distance weighted interpolation]</span></span>
<span id="cb36-15"><a href="aplicaciones.html#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tmin_idw)</span>
<span id="cb36-16"><a href="aplicaciones.html#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 6 features and 2 fields</span></span>
<span id="cb36-17"><a href="aplicaciones.html#cb36-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: POINT</span></span>
<span id="cb36-18"><a href="aplicaciones.html#cb36-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb36-19"><a href="aplicaciones.html#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: 146290.9 ymin: 69457.31 xmax: 186290.9 ymax: 69457.31</span></span>
<span id="cb36-20"><a href="aplicaciones.html#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; CRS:           +proj=lcc +lat_1=40 +lat_0=40 +lon_0=0 +k_0=0.9988085293 +x_0=600000 +y_0=600000 +a=6378298.3 +rf=294.73 +pm=madrid +units=m +no_defs</span></span>
<span id="cb36-21"><a href="aplicaciones.html#cb36-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   var1.pred var1.var                  geometry</span></span>
<span id="cb36-22"><a href="aplicaciones.html#cb36-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  2.518621       NA POINT (146290.9 69457.31)</span></span>
<span id="cb36-23"><a href="aplicaciones.html#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  2.586930       NA POINT (154290.9 69457.31)</span></span>
<span id="cb36-24"><a href="aplicaciones.html#cb36-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  2.656846       NA POINT (162290.9 69457.31)</span></span>
<span id="cb36-25"><a href="aplicaciones.html#cb36-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  2.728395       NA POINT (170290.9 69457.31)</span></span>
<span id="cb36-26"><a href="aplicaciones.html#cb36-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5  2.801600       NA POINT (178290.9 69457.31)</span></span>
<span id="cb36-27"><a href="aplicaciones.html#cb36-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6  2.876486       NA POINT (186290.9 69457.31)</span></span></code></pre></div>
<p><em>Tarea 8. Mapa de contorno</em></p>
<p>Representamos la interpolación con un mapa y mapa de contorno muy utilizado para
representar datos espaciales. Para ello, vamos a usar el paquete <code>raster</code>
convirtiendo nuestro objeto interpolado.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="aplicaciones.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convertimos de sf a SpatiaPixels</span></span>
<span id="cb37-2"><a href="aplicaciones.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Esto funciona porque nuestros puntos sf están espaciados regularmente</span></span>
<span id="cb37-3"><a href="aplicaciones.html#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="aplicaciones.html#cb37-4" aria-hidden="true" tabindex="-1"></a>tmin_pixels <span class="ot">&lt;-</span> tmin_idw <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="aplicaciones.html#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as</span>(<span class="st">&quot;Spatial&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb37-6"><a href="aplicaciones.html#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as</span>(<span class="st">&quot;SpatialPixels&quot;</span>)</span>
<span id="cb37-7"><a href="aplicaciones.html#cb37-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-8"><a href="aplicaciones.html#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="aplicaciones.html#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(raster)</span>
<span id="cb37-10"><a href="aplicaciones.html#cb37-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Creamos un raster de nuestros pixels</span></span>
<span id="cb37-11"><a href="aplicaciones.html#cb37-11" aria-hidden="true" tabindex="-1"></a>rast_esp <span class="ot">&lt;-</span> <span class="fu">raster</span>(tmin_pixels)</span>
<span id="cb37-12"><a href="aplicaciones.html#cb37-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-13"><a href="aplicaciones.html#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Transferimos valores del objeto sf al raster</span></span>
<span id="cb37-14"><a href="aplicaciones.html#cb37-14" aria-hidden="true" tabindex="-1"></a>rast_esp2 <span class="ot">&lt;-</span> <span class="fu">rasterize</span>(</span>
<span id="cb37-15"><a href="aplicaciones.html#cb37-15" aria-hidden="true" tabindex="-1"></a>  tmin_idw,</span>
<span id="cb37-16"><a href="aplicaciones.html#cb37-16" aria-hidden="true" tabindex="-1"></a>  rast_esp,</span>
<span id="cb37-17"><a href="aplicaciones.html#cb37-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">field =</span> <span class="st">&quot;var1.pred&quot;</span>, <span class="do">## valores de predicción</span></span>
<span id="cb37-18"><a href="aplicaciones.html#cb37-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">fun =</span> mean</span>
<span id="cb37-19"><a href="aplicaciones.html#cb37-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-20"><a href="aplicaciones.html#cb37-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-21"><a href="aplicaciones.html#cb37-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Además, podemos recortar el raster a la forma de España</span></span>
<span id="cb37-22"><a href="aplicaciones.html#cb37-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-23"><a href="aplicaciones.html#cb37-23" aria-hidden="true" tabindex="-1"></a>rast_esp_mask <span class="ot">&lt;-</span> <span class="fu">mask</span>(rast_esp2, esp3)</span>
<span id="cb37-24"><a href="aplicaciones.html#cb37-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-25"><a href="aplicaciones.html#cb37-25" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(rast_esp_mask, <span class="at">col =</span> colores)</span>
<span id="cb37-26"><a href="aplicaciones.html#cb37-26" aria-hidden="true" tabindex="-1"></a><span class="fu">contour</span>(rast_esp2, <span class="at">add =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-17"></span>
<img src="_main_files/figure-html/unnamed-chunk-17-1.png" alt="Mapa raster con lineas de nivel" width="60%" />
<p class="caption">
Figura 5.7: Mapa raster con lineas de nivel
</p>
</div>
<p>Podemos realizar el mismo mapa usando <code>ggplot2</code> y la función
<code>geom_contour_filled</code>:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="aplicaciones.html#cb38-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-2"><a href="aplicaciones.html#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Creo una tabla para geom contour</span></span>
<span id="cb38-3"><a href="aplicaciones.html#cb38-3" aria-hidden="true" tabindex="-1"></a>coordenadas <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(tmin_idw)</span>
<span id="cb38-4"><a href="aplicaciones.html#cb38-4" aria-hidden="true" tabindex="-1"></a>valor <span class="ot">&lt;-</span> tmin_idw<span class="sc">$</span>var1.pred</span>
<span id="cb38-5"><a href="aplicaciones.html#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="aplicaciones.html#cb38-6" aria-hidden="true" tabindex="-1"></a>idw_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb38-7"><a href="aplicaciones.html#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Necesitamos redondear las coordenadas</span></span>
<span id="cb38-8"><a href="aplicaciones.html#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">latitud =</span> <span class="fu">round</span>(coordenadas[, <span class="dv">2</span>], <span class="dv">6</span>),</span>
<span id="cb38-9"><a href="aplicaciones.html#cb38-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">longitud =</span> <span class="fu">round</span>(coordenadas[, <span class="dv">1</span>], <span class="dv">6</span>),</span>
<span id="cb38-10"><a href="aplicaciones.html#cb38-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">tmin =</span> valor</span>
<span id="cb38-11"><a href="aplicaciones.html#cb38-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb38-12"><a href="aplicaciones.html#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="aplicaciones.html#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb38-14"><a href="aplicaciones.html#cb38-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_contour_filled</span>(</span>
<span id="cb38-15"><a href="aplicaciones.html#cb38-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> idw_df,</span>
<span id="cb38-16"><a href="aplicaciones.html#cb38-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> longitud, <span class="at">y =</span> latitud, <span class="at">z =</span> tmin),</span>
<span id="cb38-17"><a href="aplicaciones.html#cb38-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.rm =</span> <span class="cn">TRUE</span>,</span>
<span id="cb38-18"><a href="aplicaciones.html#cb38-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> cortes</span>
<span id="cb38-19"><a href="aplicaciones.html#cb38-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-20"><a href="aplicaciones.html#cb38-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reajustamos la escala de colores</span></span>
<span id="cb38-21"><a href="aplicaciones.html#cb38-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> colores) <span class="sc">+</span></span>
<span id="cb38-22"><a href="aplicaciones.html#cb38-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># CCAA</span></span>
<span id="cb38-23"><a href="aplicaciones.html#cb38-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> esp3, <span class="at">fill =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb38-24"><a href="aplicaciones.html#cb38-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb38-25"><a href="aplicaciones.html#cb38-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb38-26"><a href="aplicaciones.html#cb38-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb38-27"><a href="aplicaciones.html#cb38-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">&quot;Temp. (º)&quot;</span>,</span>
<span id="cb38-28"><a href="aplicaciones.html#cb38-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Temperatura mínima interpolada&quot;</span>,</span>
<span id="cb38-29"><a href="aplicaciones.html#cb38-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">&quot;8 de Enero 2021&quot;</span>,</span>
<span id="cb38-30"><a href="aplicaciones.html#cb38-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Datos: AEMET&quot;</span></span>
<span id="cb38-31"><a href="aplicaciones.html#cb38-31" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-18"></span>
<img src="_main_files/figure-html/unnamed-chunk-18-1.png" alt="Mapa con ggplot2 y lineas de nivel" width="60%" />
<p class="caption">
Figura 5.8: Mapa con ggplot2 y lineas de nivel
</p>
</div>
</div>
<div id="renta-media-por-municipios" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Renta media por municipios</h2>
<p>Esta sección presenta un caso de uso en el que aprenderemos a realizar las
siguientes tareas básicas:</p>
<ul>
<li><p>Importar datos tabulares y datos espaciales.</p></li>
<li><p>Realizar un tratamiento de limpieza de datos y cruzar tablas.</p></li>
<li><p>Hacer mapas temáticos. Aprenderemos también algunas nociones básicas sobre
cómo crear diferentes clases para un conjunto de datos continuo.</p></li>
</ul>
<p>Para ello, partiremos de dos ficheros:</p>
<ol style="list-style-type: decimal">
<li><p>Fichero <code>renta_municipio.csv</code>: Este fichero contiene información de la Renta
Neta per cápita por municipios (en euros), distritos y secciones censales.
Esta información se ha extraído del <a href="https://www.ine.es/experimental/atlas/experimental_atlas.htm">Atlas de distribución de renta de los
hogares</a>
proporcionado por el INE, y ha sido tratado previamente para adaptar la
información al presente ejercicio.</p></li>
<li><p>Fichero <code>municipios.gpkg</code>: Es un fichero que contiene datos espaciales
(polígonos) de los municipios en España en el año 2019. Se ha extraído del
Instituto Geográfico Nacional (IGN) usando el paquete <code>mapSpain</code>.</p></li>
</ol>
<p><em>Tarea 1. Importar los datos a R</em></p>
<p>El primer paso en cualquier tipo de análisis de datos es importar los datos al
software de tratamiento (en nuestro caso, R) y analizarlos para conocer el tipo
de información que contiene:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="aplicaciones.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Usaremos paquetes del tidyverse</span></span>
<span id="cb39-2"><a href="aplicaciones.html#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb39-3"><a href="aplicaciones.html#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb39-4"><a href="aplicaciones.html#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="aplicaciones.html#cb39-5" aria-hidden="true" tabindex="-1"></a>renta <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/renta_municipio.csv&quot;</span>, <span class="at">na =</span> <span class="st">&quot;.&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="aplicaciones.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb40-2"><a href="aplicaciones.html#cb40-2" aria-hidden="true" tabindex="-1"></a>munis <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">&quot;data/municipios.gpkg&quot;</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p><strong>Q1: ¿Qué información tenemos sobre la variable?</strong></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="aplicaciones.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(renta)</span>
<span id="cb41-2"><a href="aplicaciones.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 x 6</span></span>
<span id="cb41-3"><a href="aplicaciones.html#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Unidad                          `2019` `2018` `2017` `2016` `2015`</span></span>
<span id="cb41-4"><a href="aplicaciones.html#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                            &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb41-5"><a href="aplicaciones.html#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 44001 Ababuj                        NA     NA     NA     NA     NA</span></span>
<span id="cb41-6"><a href="aplicaciones.html#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 4400101 Ababuj distrito 01          NA     NA     NA     NA     NA</span></span>
<span id="cb41-7"><a href="aplicaciones.html#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 4400101001 Ababuj sección 01001     NA     NA     NA     NA     NA</span></span>
<span id="cb41-8"><a href="aplicaciones.html#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 40001 Abades                     11429  10731  10314   9816   9904</span></span>
<span id="cb41-9"><a href="aplicaciones.html#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 4000101 Abades distrito 01       11429  10731  10314   9816   9904</span></span>
<span id="cb41-10"><a href="aplicaciones.html#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 4000101001 Abades sección 01001  11429  10731  10314   9816   9904</span></span></code></pre></div>
<p>Podemos comprobar que tenemos información para los años 2015 a 2019. Además, la
columna <code>Unidad</code> contiene un literal con el municipio o sección correspondiente.</p>
<p><strong>Q2: ¿Qué información tenemos sobre el objeto espacial?</strong></p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="aplicaciones.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(munis)</span>
<span id="cb42-2"><a href="aplicaciones.html#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 6 features and 7 fields</span></span>
<span id="cb42-3"><a href="aplicaciones.html#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb42-4"><a href="aplicaciones.html#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb42-5"><a href="aplicaciones.html#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -3.140179 ymin: 36.73817 xmax: -2.057058 ymax: 37.54579</span></span>
<span id="cb42-6"><a href="aplicaciones.html#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  ETRS89</span></span>
<span id="cb42-7"><a href="aplicaciones.html#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   codauto ine.ccaa.name cpro ine.prov.name cmun      name LAU_CODE                           geom</span></span>
<span id="cb42-8"><a href="aplicaciones.html#cb42-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1      01     Andalucía   04       Almería  001      Abla    04001 MULTIPOLYGON (((-2.775594 3...</span></span>
<span id="cb42-9"><a href="aplicaciones.html#cb42-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2      01     Andalucía   04       Almería  002  Abrucena    04002 MULTIPOLYGON (((-2.787566 3...</span></span>
<span id="cb42-10"><a href="aplicaciones.html#cb42-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3      01     Andalucía   04       Almería  003      Adra    04003 MULTIPOLYGON (((-3.051988 3...</span></span>
<span id="cb42-11"><a href="aplicaciones.html#cb42-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4      01     Andalucía   04       Almería  004 Albanchez    04004 MULTIPOLYGON (((-2.181086 3...</span></span>
<span id="cb42-12"><a href="aplicaciones.html#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5      01     Andalucía   04       Almería  005 Alboloduy    04005 MULTIPOLYGON (((-2.572442 3...</span></span>
<span id="cb42-13"><a href="aplicaciones.html#cb42-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6      01     Andalucía   04       Almería  006     Albox    04006 MULTIPOLYGON (((-2.128106 3...</span></span></code></pre></div>
<p>Podemos comprobar que <code>munis</code> es un objeto que contiene Polígonos y varias
columnas, entre ellas dos especialmente relevantes: <code>cpro</code> y <code>cmun</code>, que
corresponden a los códigos de provincia y de municipio respectivamente. Podemos
comprobar que este código también se encuentra en nuestro dataset <code>renta</code>.</p>
<p><em>Tarea 2. Comprobamos campos en común para un municipio: Noblejas</em></p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="aplicaciones.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Miro un municipio: Noblejas</span></span>
<span id="cb43-2"><a href="aplicaciones.html#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="aplicaciones.html#cb43-3" aria-hidden="true" tabindex="-1"></a>renta[<span class="fu">grep</span>(<span class="st">&quot;Noblejas&quot;</span>, renta<span class="sc">$</span>Unidad), ]</span>
<span id="cb43-4"><a href="aplicaciones.html#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 x 6</span></span>
<span id="cb43-5"><a href="aplicaciones.html#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Unidad                            `2019` `2018` `2017` `2016` `2015`</span></span>
<span id="cb43-6"><a href="aplicaciones.html#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                              &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb43-7"><a href="aplicaciones.html#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 45115 Noblejas                     10591  10314   9751   9484   9124</span></span>
<span id="cb43-8"><a href="aplicaciones.html#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 4511501 Noblejas distrito 01       11039  10717  10135   9711   9386</span></span>
<span id="cb43-9"><a href="aplicaciones.html#cb43-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 4511501001 Noblejas sección 01001  11039  10717  10135   9711   9386</span></span>
<span id="cb43-10"><a href="aplicaciones.html#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 4511502 Noblejas distrito 02       10276  10029   9475   9319   8938</span></span>
<span id="cb43-11"><a href="aplicaciones.html#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 4511502001 Noblejas sección 02001  10276  10029   9475   9319   8938</span></span>
<span id="cb43-12"><a href="aplicaciones.html#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-13"><a href="aplicaciones.html#cb43-13" aria-hidden="true" tabindex="-1"></a>munis[<span class="fu">grep</span>(<span class="st">&quot;Noblejas&quot;</span>, munis<span class="sc">$</span>name), <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;cpro&quot;</span>, <span class="st">&quot;cmun&quot;</span>)]</span>
<span id="cb43-14"><a href="aplicaciones.html#cb43-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 1 feature and 3 fields</span></span>
<span id="cb43-15"><a href="aplicaciones.html#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb43-16"><a href="aplicaciones.html#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb43-17"><a href="aplicaciones.html#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -3.489824 ymin: 39.93003 xmax: -3.372611 ymax: 40.05017</span></span>
<span id="cb43-18"><a href="aplicaciones.html#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  ETRS89</span></span>
<span id="cb43-19"><a href="aplicaciones.html#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;          name cpro cmun                           geom</span></span>
<span id="cb43-20"><a href="aplicaciones.html#cb43-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4985 Noblejas   45  115 MULTIPOLYGON (((-3.44681 40...</span></span></code></pre></div>
<p>En el caso de Noblejas, el código completo es 45115. Sin embargo, en el caso de
la tabla <code>renta</code>, debemos extraer ese valor del literal. Para ello debemos
manipular la columna y extraer la primera palabra de la columna <code>Unidad</code>:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="aplicaciones.html#cb44-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-2"><a href="aplicaciones.html#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Creo una función y la aplico a toda la columna</span></span>
<span id="cb44-3"><a href="aplicaciones.html#cb44-3" aria-hidden="true" tabindex="-1"></a>extrae_codigo <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb44-4"><a href="aplicaciones.html#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unlist</span>(<span class="fu">strsplit</span>(x, <span class="st">&quot; &quot;</span>))[<span class="dv">1</span>]</span>
<span id="cb44-5"><a href="aplicaciones.html#cb44-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb44-6"><a href="aplicaciones.html#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="aplicaciones.html#cb44-7" aria-hidden="true" tabindex="-1"></a>renta<span class="sc">$</span>codigo_ine <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="fu">as.character</span>(renta<span class="sc">$</span>Unidad), extrae_codigo)</span>
<span id="cb44-8"><a href="aplicaciones.html#cb44-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-9"><a href="aplicaciones.html#cb44-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(renta[<span class="fu">c</span>(<span class="st">&quot;Unidad&quot;</span>, <span class="st">&quot;codigo_ine&quot;</span>)])</span>
<span id="cb44-10"><a href="aplicaciones.html#cb44-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 6 x 2</span></span>
<span id="cb44-11"><a href="aplicaciones.html#cb44-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Unidad                          codigo_ine</span></span>
<span id="cb44-12"><a href="aplicaciones.html#cb44-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;                           &lt;chr&gt;     </span></span>
<span id="cb44-13"><a href="aplicaciones.html#cb44-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 44001 Ababuj                    44001     </span></span>
<span id="cb44-14"><a href="aplicaciones.html#cb44-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 4400101 Ababuj distrito 01      4400101   </span></span>
<span id="cb44-15"><a href="aplicaciones.html#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 4400101001 Ababuj sección 01001 4400101001</span></span>
<span id="cb44-16"><a href="aplicaciones.html#cb44-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 40001 Abades                    40001     </span></span>
<span id="cb44-17"><a href="aplicaciones.html#cb44-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 4000101 Abades distrito 01      4000101   </span></span>
<span id="cb44-18"><a href="aplicaciones.html#cb44-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 4000101001 Abades sección 01001 4000101001</span></span></code></pre></div>
<p>Ahora, es necesario crear la misma variable en <code>munis</code> para poder realizar el
cruce:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="aplicaciones.html#cb45-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-2"><a href="aplicaciones.html#cb45-2" aria-hidden="true" tabindex="-1"></a>munis<span class="sc">$</span>codigo_ine <span class="ot">&lt;-</span> <span class="fu">paste0</span>(munis<span class="sc">$</span>cpro, munis<span class="sc">$</span>cmun)</span>
<span id="cb45-3"><a href="aplicaciones.html#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="aplicaciones.html#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(munis[, <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;codigo_ine&quot;</span>)])</span>
<span id="cb45-5"><a href="aplicaciones.html#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Simple feature collection with 6 features and 2 fields</span></span>
<span id="cb45-6"><a href="aplicaciones.html#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span id="cb45-7"><a href="aplicaciones.html#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Dimension:     XY</span></span>
<span id="cb45-8"><a href="aplicaciones.html#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Bounding box:  xmin: -3.140179 ymin: 36.73817 xmax: -2.057058 ymax: 37.54579</span></span>
<span id="cb45-9"><a href="aplicaciones.html#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Geodetic CRS:  ETRS89</span></span>
<span id="cb45-10"><a href="aplicaciones.html#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        name codigo_ine                           geom</span></span>
<span id="cb45-11"><a href="aplicaciones.html#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1      Abla      04001 MULTIPOLYGON (((-2.775594 3...</span></span>
<span id="cb45-12"><a href="aplicaciones.html#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  Abrucena      04002 MULTIPOLYGON (((-2.787566 3...</span></span>
<span id="cb45-13"><a href="aplicaciones.html#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3      Adra      04003 MULTIPOLYGON (((-3.051988 3...</span></span>
<span id="cb45-14"><a href="aplicaciones.html#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Albanchez      04004 MULTIPOLYGON (((-2.181086 3...</span></span>
<span id="cb45-15"><a href="aplicaciones.html#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Alboloduy      04005 MULTIPOLYGON (((-2.572442 3...</span></span>
<span id="cb45-16"><a href="aplicaciones.html#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6     Albox      04006 MULTIPOLYGON (((-2.128106 3...</span></span></code></pre></div>
<p><em>Tarea 3: Unimos los objetos renta y mapas con la función <code>left_join</code></em></p>
<p>Ya estamos listos para realizar el cruce. Además, seleccionaremos sólo las
columnas que vamos a usar, en este caso la del año 2019:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="aplicaciones.html#cb46-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-2"><a href="aplicaciones.html#cb46-2" aria-hidden="true" tabindex="-1"></a>munis_renta <span class="ot">&lt;-</span> munis <span class="sc">%&gt;%</span></span>
<span id="cb46-3"><a href="aplicaciones.html#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(renta) <span class="sc">%&gt;%</span></span>
<span id="cb46-4"><a href="aplicaciones.html#cb46-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name, cpro, cmun, <span class="st">`</span><span class="at">2019</span><span class="st">`</span>)</span></code></pre></div>
<p><strong>Cuando crucemos datos espaciales con datos no espaciales en R, es importante
que el primer dataset sea el que contiene los datos espaciales</strong>. Esto es así
porque el objeto resultante “hereda” la clase del primer objeto.</p>
<p><strong>Q3: ¿Qué ocurre si realizáramos el proceso poniendo los datos espaciales en el
lado derecho del join?</strong></p>
<p>A modo de ejemplo, si realizáramos el proceso poniendo los datos espaciales en
el lado derecho del join, los datos finales no serán espaciales:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="aplicaciones.html#cb47-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-2"><a href="aplicaciones.html#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Miramos la clase de munis_renta</span></span>
<span id="cb47-3"><a href="aplicaciones.html#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="aplicaciones.html#cb47-4" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(munis_renta)</span>
<span id="cb47-5"><a href="aplicaciones.html#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;sf&quot;         &quot;data.frame&quot;</span></span>
<span id="cb47-6"><a href="aplicaciones.html#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="aplicaciones.html#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Es un sf, por tanto espacial</span></span>
<span id="cb47-8"><a href="aplicaciones.html#cb47-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-9"><a href="aplicaciones.html#cb47-9" aria-hidden="true" tabindex="-1"></a><span class="co"># ¿Que pasa si realizamos el cruce de la otra manera?</span></span>
<span id="cb47-10"><a href="aplicaciones.html#cb47-10" aria-hidden="true" tabindex="-1"></a>renta <span class="sc">%&gt;%</span></span>
<span id="cb47-11"><a href="aplicaciones.html#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(munis) <span class="sc">%&gt;%</span></span>
<span id="cb47-12"><a href="aplicaciones.html#cb47-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name, cpro, cmun, <span class="st">`</span><span class="at">2019</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb47-13"><a href="aplicaciones.html#cb47-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>()</span>
<span id="cb47-14"><a href="aplicaciones.html#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;tbl_df&quot;     &quot;tbl&quot;        &quot;data.frame&quot;</span></span></code></pre></div>
<p>El resultado es un tibble o data.frame, <strong>¡pero no es espacial!</strong></p>
<p><em>Tarea 4. Histograma de la distribución de la renta</em></p>
<p>Una vez que tenemos los datos unidos podemos realizar algunos análisis básicos,
como la realización de un histograma</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="aplicaciones.html#cb48-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-2"><a href="aplicaciones.html#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb48-3"><a href="aplicaciones.html#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="aplicaciones.html#cb48-4" aria-hidden="true" tabindex="-1"></a>munis_renta <span class="sc">%&gt;%</span></span>
<span id="cb48-5"><a href="aplicaciones.html#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">2019</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb48-6"><a href="aplicaciones.html#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;lightblue&quot;</span>) <span class="sc">+</span></span>
<span id="cb48-7"><a href="aplicaciones.html#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number_auto</span>()) <span class="sc">+</span></span>
<span id="cb48-8"><a href="aplicaciones.html#cb48-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb48-9"><a href="aplicaciones.html#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb48-10"><a href="aplicaciones.html#cb48-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb48-11"><a href="aplicaciones.html#cb48-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;Renta neta media por persona (€)&quot;</span></span>
<span id="cb48-12"><a href="aplicaciones.html#cb48-12" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="_main_files/figure-html/basic-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p>Podemos observar que la renta presenta una distribución Gamma con un gran de
municipios concentrados en zonas medias de renta y pocos municipios en tramos de
rentas altas. Como veremos más adelante, esta distribución va a afectar a la
información que transmite el mapa.</p>
<p><em>Tarea 5. Mapa de coropletas de la distribución de la renta</em></p>
<p>Vamos a realizar ahora un mapa de coropletas mostrando la distribución de la
renta usando los valores brutos de renta sin modificar:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="aplicaciones.html#cb49-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-2"><a href="aplicaciones.html#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(munis_renta) <span class="sc">+</span></span>
<span id="cb49-3"><a href="aplicaciones.html#cb49-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Usamos geom_sf, y como aes() lo que queremos mostrar, en este caso, el</span></span>
<span id="cb49-4"><a href="aplicaciones.html#cb49-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># color del polígono representa la renta. Vamos a retirar los bordes con</span></span>
<span id="cb49-5"><a href="aplicaciones.html#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># color = NA</span></span>
<span id="cb49-6"><a href="aplicaciones.html#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="st">`</span><span class="at">2019</span><span class="st">`</span>), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb49-7"><a href="aplicaciones.html#cb49-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb49-8"><a href="aplicaciones.html#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(</span>
<span id="cb49-9"><a href="aplicaciones.html#cb49-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">big.mark =</span> <span class="st">&quot;.&quot;</span>,</span>
<span id="cb49-10"><a href="aplicaciones.html#cb49-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimal.mark =</span> <span class="st">&quot;,&quot;</span>,</span>
<span id="cb49-11"><a href="aplicaciones.html#cb49-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">suffix =</span> <span class="st">&quot; €&quot;</span></span>
<span id="cb49-12"><a href="aplicaciones.html#cb49-12" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb49-13"><a href="aplicaciones.html#cb49-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb49-14"><a href="aplicaciones.html#cb49-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Renta neta media por persona&quot;</span>,</span>
<span id="cb49-15"><a href="aplicaciones.html#cb49-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Datos: INE&quot;</span></span>
<span id="cb49-16"><a href="aplicaciones.html#cb49-16" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="_main_files/figure-html/maparenta1-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p>Este primer mapa no es demasiado informativo, por los siguientes motivos:</p>
<ul>
<li><p>Existe una serie de municipios para los que no tenemos datos.</p></li>
<li><p>La escala de color no es la más adecuada.</p></li>
<li><p>Dada la distribución de los datos, puede ser adecuado crear grupos de renta
para que el mapa sea más interpretable.</p></li>
</ul>
<p><em>Tarea 6. Eliminamos los municipios sin datos y cambiamos la escala de color</em></p>
<p>Vamos a probar a eliminar los municipios sin datos y a cambiar la escala de
color para ver si mejora la visualización.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="aplicaciones.html#cb50-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-2"><a href="aplicaciones.html#cb50-2" aria-hidden="true" tabindex="-1"></a>munis_renta_clean <span class="ot">&lt;-</span> munis_renta <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="st">`</span><span class="at">2019</span><span class="st">`</span>))</span>
<span id="cb50-3"><a href="aplicaciones.html#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="aplicaciones.html#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(munis_renta_clean) <span class="sc">+</span></span>
<span id="cb50-5"><a href="aplicaciones.html#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="st">`</span><span class="at">2019</span><span class="st">`</span>), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb50-6"><a href="aplicaciones.html#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cambiamos la paleta de colores, vamos a usar una paleta denominada Inferno,</span></span>
<span id="cb50-7"><a href="aplicaciones.html#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ya incluida en base R con hcl.colors</span></span>
<span id="cb50-8"><a href="aplicaciones.html#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="aplicaciones.html#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Como son datos continuos, puedo usar Inferno</span></span>
<span id="cb50-10"><a href="aplicaciones.html#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(</span>
<span id="cb50-11"><a href="aplicaciones.html#cb50-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">colours =</span> <span class="fu">hcl.colors</span>(<span class="dv">20</span>, <span class="st">&quot;Inferno&quot;</span>, <span class="at">rev =</span> <span class="cn">TRUE</span>),</span>
<span id="cb50-12"><a href="aplicaciones.html#cb50-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(</span>
<span id="cb50-13"><a href="aplicaciones.html#cb50-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">big.mark =</span> <span class="st">&quot;.&quot;</span>,</span>
<span id="cb50-14"><a href="aplicaciones.html#cb50-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">decimal.mark =</span> <span class="st">&quot;,&quot;</span>,</span>
<span id="cb50-15"><a href="aplicaciones.html#cb50-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">suffix =</span> <span class="st">&quot; €&quot;</span></span>
<span id="cb50-16"><a href="aplicaciones.html#cb50-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb50-17"><a href="aplicaciones.html#cb50-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb50-18"><a href="aplicaciones.html#cb50-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb50-19"><a href="aplicaciones.html#cb50-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb50-20"><a href="aplicaciones.html#cb50-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Renta neta media por persona&quot;</span>,</span>
<span id="cb50-21"><a href="aplicaciones.html#cb50-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Datos: INE&quot;</span></span>
<span id="cb50-22"><a href="aplicaciones.html#cb50-22" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="_main_files/figure-html/maparenta2-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p>Este mapa nos da algo más de información, y parece intuirse que las rentas más
altas se encuentran en zonas de País Vasco, Madrid y Cataluña. Sin embargo, el
hecho de que la distribución de los datos no sea normal está afectando a la
visualización.</p>
<p><em>Tarea 7. Agrupar los datos en clases para mejorar la visualización</em></p>
<p>Para intentar atajar este problema, podemos dividir nuestros datos en clases,
por ejemplo cuartiles o deciles. Existen varios métodos de clasificación de
datos, que en R se encuentran implementados en el paquete <code>classInt</code>. A
continuación vamos a plantear diversos métodos de clasificación y observar cómo
la “historia” que cuenta el mapa varía en función de dichas clases. En este
ejemplo planteamos los siguientes métodos de clasificación:</p>
<ul>
<li><p>El método de deciles: consiste en crear 10 categorías incluyendo el mismo
número de registros en cada una de ellas.</p></li>
<li><p>El método de intervalos equivalentes: divide el rango de valores en un
número de grupos definido. La distancia de todos los intervalos es idéntica,
por lo que este método no tiene en cuenta la distribución de los registros.</p></li>
<li><p>El método de Fisher-Jenks: desarrollado específicamente para la
clasificación de datos espaciales y su visualización en mapas. Produce
agrupaciones de tal manera que los datos de cada grupo son “cercanas” entre
sí y sustancialmente distintas de los valores de otros grupos.</p></li>
</ul>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="aplicaciones.html#cb51-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-2"><a href="aplicaciones.html#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(classInt)</span>
<span id="cb51-3"><a href="aplicaciones.html#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Vamos a probar 3 métodos de clasificación: Deciles, tramos de Renta</span></span>
<span id="cb51-4"><a href="aplicaciones.html#cb51-4" aria-hidden="true" tabindex="-1"></a><span class="co"># equidistantes y Fisher and Jenks</span></span>
<span id="cb51-5"><a href="aplicaciones.html#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="aplicaciones.html#cb51-6" aria-hidden="true" tabindex="-1"></a>deciles <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(munis_renta_clean<span class="sc">$</span><span class="st">`</span><span class="at">2019</span><span class="st">`</span>,</span>
<span id="cb51-7"><a href="aplicaciones.html#cb51-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">style =</span> <span class="st">&quot;quantile&quot;</span>, <span class="at">n =</span> <span class="dv">10</span></span>
<span id="cb51-8"><a href="aplicaciones.html#cb51-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-9"><a href="aplicaciones.html#cb51-9" aria-hidden="true" tabindex="-1"></a>deciles</span>
<span id="cb51-10"><a href="aplicaciones.html#cb51-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; style: quantile</span></span>
<span id="cb51-11"><a href="aplicaciones.html#cb51-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     [5898,8935.6)   [8935.6,9662.2)  [9662.2,10352.8)   [10352.8,10918)     [10918,11462) </span></span>
<span id="cb51-12"><a href="aplicaciones.html#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               656               656               655               654               655 </span></span>
<span id="cb51-13"><a href="aplicaciones.html#cb51-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   [11462,11998.6) [11998.6,12651.4) [12651.4,13475.8) [13475.8,14618.4)   [14618.4,26367] </span></span>
<span id="cb51-14"><a href="aplicaciones.html#cb51-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               658               656               655               656               656</span></span>
<span id="cb51-15"><a href="aplicaciones.html#cb51-15" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(deciles, <span class="at">pal =</span> <span class="fu">hcl.colors</span>(<span class="dv">20</span>, <span class="st">&quot;Inferno&quot;</span>), <span class="at">main =</span> <span class="st">&quot;Deciles&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/classint-1.png" width="60%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="aplicaciones.html#cb52-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-2"><a href="aplicaciones.html#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="aplicaciones.html#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Tramos equidistantes en términos de renta</span></span>
<span id="cb52-4"><a href="aplicaciones.html#cb52-4" aria-hidden="true" tabindex="-1"></a>equal <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(munis_renta_clean<span class="sc">$</span><span class="st">`</span><span class="at">2019</span><span class="st">`</span>,</span>
<span id="cb52-5"><a href="aplicaciones.html#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">style =</span> <span class="st">&quot;equal&quot;</span>, <span class="at">n =</span> <span class="dv">10</span></span>
<span id="cb52-6"><a href="aplicaciones.html#cb52-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb52-7"><a href="aplicaciones.html#cb52-7" aria-hidden="true" tabindex="-1"></a>equal</span>
<span id="cb52-8"><a href="aplicaciones.html#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; style: equal</span></span>
<span id="cb52-9"><a href="aplicaciones.html#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     [5898,7944.9)   [7944.9,9991.8)  [9991.8,12038.7) [12038.7,14085.6) [14085.6,16132.5) </span></span>
<span id="cb52-10"><a href="aplicaciones.html#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               103              1510              2374              1637               702 </span></span>
<span id="cb52-11"><a href="aplicaciones.html#cb52-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [16132.5,18179.4) [18179.4,20226.3) [20226.3,22273.2) [22273.2,24320.1)   [24320.1,26367] </span></span>
<span id="cb52-12"><a href="aplicaciones.html#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               161                52                14                 3                 1</span></span>
<span id="cb52-13"><a href="aplicaciones.html#cb52-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(equal, <span class="at">pal =</span> <span class="fu">hcl.colors</span>(<span class="dv">20</span>, <span class="st">&quot;Inferno&quot;</span>), <span class="at">main =</span> <span class="st">&quot;Equidistantes&quot;</span>)</span></code></pre></div>
<p><img src="_main_files/figure-html/classint-2.png" width="60%" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="aplicaciones.html#cb53-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-2"><a href="aplicaciones.html#cb53-2" aria-hidden="true" tabindex="-1"></a>fisher <span class="ot">&lt;-</span> <span class="fu">classIntervals</span>(munis_renta_clean<span class="sc">$</span><span class="st">`</span><span class="at">2019</span><span class="st">`</span>,</span>
<span id="cb53-3"><a href="aplicaciones.html#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">style =</span> <span class="st">&quot;fisher&quot;</span>,</span>
<span id="cb53-4"><a href="aplicaciones.html#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fuerzo para mejorar la comparación entre métodos</span></span>
<span id="cb53-5"><a href="aplicaciones.html#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">n =</span> <span class="dv">10</span></span>
<span id="cb53-6"><a href="aplicaciones.html#cb53-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb53-7"><a href="aplicaciones.html#cb53-7" aria-hidden="true" tabindex="-1"></a>fisher</span>
<span id="cb53-8"><a href="aplicaciones.html#cb53-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; style: fisher</span></span>
<span id="cb53-9"><a href="aplicaciones.html#cb53-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       [5898,8743)     [8743,9770.5)    [9770.5,10754)     [10754,11689)     [11689,12668) </span></span>
<span id="cb53-10"><a href="aplicaciones.html#cb53-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               505               904              1005              1159              1032 </span></span>
<span id="cb53-11"><a href="aplicaciones.html#cb53-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     [12668,13803)   [13803,15222.5) [15222.5,17196.5) [17196.5,20063.5)   [20063.5,26367] </span></span>
<span id="cb53-12"><a href="aplicaciones.html#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;               874               651               305               103                19</span></span>
<span id="cb53-13"><a href="aplicaciones.html#cb53-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fisher,</span>
<span id="cb53-14"><a href="aplicaciones.html#cb53-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">pal =</span> <span class="fu">hcl.colors</span>(<span class="dv">20</span>, <span class="st">&quot;Inferno&quot;</span>),</span>
<span id="cb53-15"><a href="aplicaciones.html#cb53-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">&quot;Fisher-Jenks&quot;</span></span>
<span id="cb53-16"><a href="aplicaciones.html#cb53-16" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="_main_files/figure-html/classint-3.png" width="60%" style="display: block; margin: auto;" /></p>
<p>Podemos observar lo siguiente:</p>
<ul>
<li><p>El último decil de renta se corresponde a un rango de entre 15.000 y 25.000
€.</p></li>
<li><p>El método por deciles proporciona unos grupos con valores de renta muy
parecidos entre sí en los valores medios. Esto es debido a la propia
distribución de la variable.</p></li>
<li><p>El método de rangos equidistantes proporciona algunos grupos con un número
muy reducido de municipios.</p></li>
<li><p>El método de Fisher-Jenks puede proporcionar unas clases con unos rangos más
apropiados para los tramos altos de renta.</p></li>
</ul>
<p><em>Tarea 8. Representar los mapas según las clases obtenidas</em></p>
<p>Vamos ahora a realizar 3 mapas distintos, creando clases de renta según cada uno
de los métodos anteriormente mostrados.</p>
<p><strong>Deciles</strong></p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="aplicaciones.html#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraigo los valores de corte</span></span>
<span id="cb54-2"><a href="aplicaciones.html#cb54-2" aria-hidden="true" tabindex="-1"></a>breaks_d <span class="ot">&lt;-</span> deciles<span class="sc">$</span>brks</span>
<span id="cb54-3"><a href="aplicaciones.html#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="aplicaciones.html#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Y creo unas etiquetas básicas para cada clase</span></span>
<span id="cb54-5"><a href="aplicaciones.html#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Creo una función específica para crear etiquetas formateadas</span></span>
<span id="cb54-6"><a href="aplicaciones.html#cb54-6" aria-hidden="true" tabindex="-1"></a>label_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb54-7"><a href="aplicaciones.html#cb54-7" aria-hidden="true" tabindex="-1"></a>  l <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb54-8"><a href="aplicaciones.html#cb54-8" aria-hidden="true" tabindex="-1"></a>  eur <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">prettyNum</span>(<span class="fu">round</span>(x, <span class="dv">0</span>),</span>
<span id="cb54-9"><a href="aplicaciones.html#cb54-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">decimal.mark =</span> <span class="st">&quot;,&quot;</span>,</span>
<span id="cb54-10"><a href="aplicaciones.html#cb54-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">big.mark =</span> <span class="st">&quot;.&quot;</span></span>
<span id="cb54-11"><a href="aplicaciones.html#cb54-11" aria-hidden="true" tabindex="-1"></a>  ), <span class="st">&quot; €&quot;</span>)</span>
<span id="cb54-12"><a href="aplicaciones.html#cb54-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-13"><a href="aplicaciones.html#cb54-13" aria-hidden="true" tabindex="-1"></a>  labels <span class="ot">&lt;-</span> <span class="fu">paste</span>(eur[<span class="sc">-</span>l], <span class="st">&quot;-&quot;</span>, eur[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb54-14"><a href="aplicaciones.html#cb54-14" aria-hidden="true" tabindex="-1"></a>  labels[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;&lt;&quot;</span>, eur[<span class="dv">1</span>])</span>
<span id="cb54-15"><a href="aplicaciones.html#cb54-15" aria-hidden="true" tabindex="-1"></a>  labels[l <span class="sc">-</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">&quot;&gt;&quot;</span>, eur[l <span class="sc">-</span> <span class="dv">1</span>])</span>
<span id="cb54-16"><a href="aplicaciones.html#cb54-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(labels)</span>
<span id="cb54-17"><a href="aplicaciones.html#cb54-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb54-18"><a href="aplicaciones.html#cb54-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-19"><a href="aplicaciones.html#cb54-19" aria-hidden="true" tabindex="-1"></a>labels_d <span class="ot">&lt;-</span> <span class="fu">label_fun</span>(breaks_d)</span>
<span id="cb54-20"><a href="aplicaciones.html#cb54-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-21"><a href="aplicaciones.html#cb54-21" aria-hidden="true" tabindex="-1"></a>munis_renta_clean<span class="sc">$</span>Deciles <span class="ot">&lt;-</span> <span class="fu">cut</span>(munis_renta_clean<span class="sc">$</span><span class="st">`</span><span class="at">2019</span><span class="st">`</span>,</span>
<span id="cb54-22"><a href="aplicaciones.html#cb54-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> breaks_d,</span>
<span id="cb54-23"><a href="aplicaciones.html#cb54-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> labels_d,</span>
<span id="cb54-24"><a href="aplicaciones.html#cb54-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">include.lowest =</span> <span class="cn">TRUE</span></span>
<span id="cb54-25"><a href="aplicaciones.html#cb54-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-26"><a href="aplicaciones.html#cb54-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-27"><a href="aplicaciones.html#cb54-27" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(munis_renta_clean) <span class="sc">+</span></span>
<span id="cb54-28"><a href="aplicaciones.html#cb54-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cambiamos la variable que usamos para crear el mapa</span></span>
<span id="cb54-29"><a href="aplicaciones.html#cb54-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Deciles), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb54-30"><a href="aplicaciones.html#cb54-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Necesito cambiar el scale, ya no es continua</span></span>
<span id="cb54-31"><a href="aplicaciones.html#cb54-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">hcl.colors</span>(<span class="fu">length</span>(labels_d),</span>
<span id="cb54-32"><a href="aplicaciones.html#cb54-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Inferno&quot;</span>,</span>
<span id="cb54-33"><a href="aplicaciones.html#cb54-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">rev =</span> <span class="cn">TRUE</span></span>
<span id="cb54-34"><a href="aplicaciones.html#cb54-34" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb54-35"><a href="aplicaciones.html#cb54-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb54-36"><a href="aplicaciones.html#cb54-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb54-37"><a href="aplicaciones.html#cb54-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Renta neta media por persona&quot;</span>,</span>
<span id="cb54-38"><a href="aplicaciones.html#cb54-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Datos: INE&quot;</span></span>
<span id="cb54-39"><a href="aplicaciones.html#cb54-39" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:mapa-deciles"></span>
<img src="_main_files/figure-html/mapa-deciles-1.png" alt="Mapa por deciles de renta" width="60%" />
<p class="caption">
Figura 5.9: Mapa por deciles de renta
</p>
</div>
<p>El mapa de la Fig. <a href="aplicaciones.html#fig:mapa-deciles">5.9</a> ya nos permite observar patrones
geográficos, donde se ve una clara diferencia entre la Comunidades Autónomas del
Norte y las del Sur. Veamos una representación distina usando otras clases
diferentes:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="aplicaciones.html#cb55-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-2"><a href="aplicaciones.html#cb55-2" aria-hidden="true" tabindex="-1"></a>breaks_e <span class="ot">&lt;-</span> equal<span class="sc">$</span>brks</span>
<span id="cb55-3"><a href="aplicaciones.html#cb55-3" aria-hidden="true" tabindex="-1"></a>labels_e <span class="ot">&lt;-</span> <span class="fu">label_fun</span>(breaks_e)</span>
<span id="cb55-4"><a href="aplicaciones.html#cb55-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-5"><a href="aplicaciones.html#cb55-5" aria-hidden="true" tabindex="-1"></a>munis_renta_clean<span class="sc">$</span>Equal <span class="ot">&lt;-</span> <span class="fu">cut</span>(munis_renta_clean<span class="sc">$</span><span class="st">`</span><span class="at">2019</span><span class="st">`</span>,</span>
<span id="cb55-6"><a href="aplicaciones.html#cb55-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> breaks_e,</span>
<span id="cb55-7"><a href="aplicaciones.html#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> labels_e,</span>
<span id="cb55-8"><a href="aplicaciones.html#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">include.lowest =</span> <span class="cn">TRUE</span></span>
<span id="cb55-9"><a href="aplicaciones.html#cb55-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb55-10"><a href="aplicaciones.html#cb55-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-11"><a href="aplicaciones.html#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(munis_renta_clean) <span class="sc">+</span></span>
<span id="cb55-12"><a href="aplicaciones.html#cb55-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cambiamos la variable que usamos para crear el mapa</span></span>
<span id="cb55-13"><a href="aplicaciones.html#cb55-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> Equal), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb55-14"><a href="aplicaciones.html#cb55-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">hcl.colors</span>(<span class="fu">length</span>(labels_e),</span>
<span id="cb55-15"><a href="aplicaciones.html#cb55-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Inferno&quot;</span>,</span>
<span id="cb55-16"><a href="aplicaciones.html#cb55-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">rev =</span> <span class="cn">TRUE</span></span>
<span id="cb55-17"><a href="aplicaciones.html#cb55-17" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb55-18"><a href="aplicaciones.html#cb55-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb55-19"><a href="aplicaciones.html#cb55-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb55-20"><a href="aplicaciones.html#cb55-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Renta neta media por persona&quot;</span>,</span>
<span id="cb55-21"><a href="aplicaciones.html#cb55-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Datos: INE&quot;</span></span>
<span id="cb55-22"><a href="aplicaciones.html#cb55-22" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:mapa-equal"></span>
<img src="_main_files/figure-html/mapa-equal-1.png" alt="Mapa por tramos de renta equidistantes" width="60%" />
<p class="caption">
Figura 5.10: Mapa por tramos de renta equidistantes
</p>
</div>
<p>El mapa de la Fig. <a href="aplicaciones.html#fig:mapa-deciles">5.9</a>, sin embargo, se parece más al mapa
que hicimos con los datos sin clasificar, donde el peso visual se concentra más
bien en los municipios con rentas mucho más altas que el resto (por encimoa de
18.000 €).</p>
<p>Veamos el mismo mapa usando Fisher-Jenks:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="aplicaciones.html#cb56-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-2"><a href="aplicaciones.html#cb56-2" aria-hidden="true" tabindex="-1"></a>breaks_f <span class="ot">&lt;-</span> fisher<span class="sc">$</span>brks</span>
<span id="cb56-3"><a href="aplicaciones.html#cb56-3" aria-hidden="true" tabindex="-1"></a>labels_f <span class="ot">&lt;-</span> <span class="fu">label_fun</span>(breaks_f)</span>
<span id="cb56-4"><a href="aplicaciones.html#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="aplicaciones.html#cb56-5" aria-hidden="true" tabindex="-1"></a>munis_renta_clean<span class="sc">$</span><span class="st">`</span><span class="at">Fisher-Jenks</span><span class="st">`</span> <span class="ot">&lt;-</span> <span class="fu">cut</span>(munis_renta_clean<span class="sc">$</span><span class="st">`</span><span class="at">2019</span><span class="st">`</span>,</span>
<span id="cb56-6"><a href="aplicaciones.html#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> breaks_f,</span>
<span id="cb56-7"><a href="aplicaciones.html#cb56-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> labels_f,</span>
<span id="cb56-8"><a href="aplicaciones.html#cb56-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">include.lowest =</span> <span class="cn">TRUE</span></span>
<span id="cb56-9"><a href="aplicaciones.html#cb56-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb56-10"><a href="aplicaciones.html#cb56-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-11"><a href="aplicaciones.html#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(munis_renta_clean) <span class="sc">+</span></span>
<span id="cb56-12"><a href="aplicaciones.html#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Cambiamos la variable que usamos para crear el mapa</span></span>
<span id="cb56-13"><a href="aplicaciones.html#cb56-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="st">`</span><span class="at">Fisher-Jenks</span><span class="st">`</span>), <span class="at">color =</span> <span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb56-14"><a href="aplicaciones.html#cb56-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">hcl.colors</span>(<span class="fu">length</span>(labels_f),</span>
<span id="cb56-15"><a href="aplicaciones.html#cb56-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Inferno&quot;</span>,</span>
<span id="cb56-16"><a href="aplicaciones.html#cb56-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">rev =</span> <span class="cn">TRUE</span></span>
<span id="cb56-17"><a href="aplicaciones.html#cb56-17" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">+</span></span>
<span id="cb56-18"><a href="aplicaciones.html#cb56-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb56-19"><a href="aplicaciones.html#cb56-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb56-20"><a href="aplicaciones.html#cb56-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">&quot;Renta neta media por persona&quot;</span>,</span>
<span id="cb56-21"><a href="aplicaciones.html#cb56-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Datos: INE&quot;</span></span>
<span id="cb56-22"><a href="aplicaciones.html#cb56-22" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:mapa-fisher"></span>
<img src="_main_files/figure-html/mapa-fisher-1.png" alt="Mapa por tramos según Fisher-Jenks" width="60%" />
<p class="caption">
Figura 5.11: Mapa por tramos según Fisher-Jenks
</p>
</div>
<p>En el mapa de la Fig. <a href="aplicaciones.html#fig:mapa-deciles">5.9</a> se puede observar de una manera
más clara un cluster adicional de renta en la zona de Asturias y el norte de
León. Además, gracias a la escala de colores puede intuirse que este clúster de
renta no presenta valores tan altos como los observados en País Vasco o Madrid.</p>
<p>En conclusión, en el momento de realizar una visualización de datos es
importante conocer el dato a representar, así como entender algunas propiedades
básicas de la distribución subyacente. También hemos podido observar que hay
ciertas decisiones estéticas (datos continuos vs. agrupados, escala de colores)
que tienen una influencia significativa en cómo se percibe la información
representada. Es responsabilidad del creador de la visualización el conocer
todos estos factores y aplicarlos de manera conveniente.</p>
<p><strong>Q4: Tenemos un mapa de los mismos datos pero la información se presenta de
manera sesgada, ¿puedes identificar los motivos?</strong></p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:trucado"></span>
<img src="_main_files/figure-html/trucado-1.png" alt="Ejemplo de visualización sesgada" width="60%" />
<p class="caption">
Figura 5.12: Ejemplo de visualización sesgada
</p>
</div>
<p>En el mapa de la Fig. <a href="aplicaciones.html#fig:trucado">5.12</a> parece que la renta per cápita de las
comunidades del norte es desproporcionadamente superior a las del sur. Resumimos
aquí los sesgos introducidos en el mapa:</p>
<ul>
<li><p>En primer lugar, se han creado un elevado número de grupos en las zonas de
rentas bajas. De esta manera, la escala del mapa parece estar muy
fragmentada, sin embargo muchos de esos grupos apenas contienen municipios.
A modo de ejemplo, los primeros cuatro grupos únicamente contienen 32
municipios.</p></li>
<li><p>Los grupos no se adaptan a la distribución subyacente de los datos. La
mediana de los datos (11.462 €) estaría situada en la antepenúltima clase,
de manera que los dos grupos de mayor renta contienen el 50% de los
municipios.</p></li>
<li><p>Además, la escala de color se ha manipulado, de manera que los grupos de
mayores renta destaquen más que el resto de manera notoria.</p></li>
</ul>
</div>
<div id="análisis-de-patrones-de-puntos" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Análisis de patrones de puntos</h2>
<p>Las técnicas de análisis de patrones de puntos analizan la distribución de
eventos geolocalizados que surgen al azar. La diferencia fundamental con otros
análisis que comprenden también el uso de localizaciones (como las temperaturas
mínimas medidas por estaciones meteorológicas) es que en este caso los puntos
representan eventos conocidos y aleatorios (por ejemplo, los crímenes ocurridos
en una ciudad, accidentes de tráfico o incendios en una región). A diferencia de
otros eventos, como el ejemplo de las temperaturas mínimas, la ausencia de datos
no se debe a la ausencia de medición (e.g. no existe una estación meteorológica
en ese lugar), si no a que no se ha producido el evento en dicha localización.</p>
<p><strong>Objetivo de aprendizaje</strong>:</p>
<p>El alumno debe ser capaz de conocer los datos de tipo patrones de punto,
identificarlos y representarlos adecuadamente.</p>
<p><em>Tarea 1: Abrimos RStudio</em></p>
<p>El presente análisis se va a realizar empleando RStudio, por lo que empezaremos
abriendo el programa y creando un nuevo script de R en <em>Proyecto&gt;File&gt;New File&gt;R
script</em>.</p>
<p><em>Tarea 2: Importamos y describimos los datos objeto de estudio</em></p>
<p>El primer paso consiste en importar la base de datos de crímenes en la ciudad de
Valencia. El archivo está en formato csv, por lo que usaremos el paquete <code>readr</code>
para importar los datos:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="aplicaciones.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb57-2"><a href="aplicaciones.html#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb57-3"><a href="aplicaciones.html#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="aplicaciones.html#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co"># En este caso el archivo está en la carpeta &quot;data&quot; de nuestro proyecto</span></span>
<span id="cb57-5"><a href="aplicaciones.html#cb57-5" aria-hidden="true" tabindex="-1"></a>crimen <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;data/crime-data-Valencia.csv&quot;</span>)</span>
<span id="cb57-6"><a href="aplicaciones.html#cb57-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-7"><a href="aplicaciones.html#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="aplicaciones.html#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(crimen)</span>
<span id="cb57-9"><a href="aplicaciones.html#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    crime_id          crime_date         crime_time        crime_type            muni          </span></span>
<span id="cb57-10"><a href="aplicaciones.html#cb57-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Length:90247       Length:90247       Length:90247      Length:90247       Length:90247      </span></span>
<span id="cb57-11"><a href="aplicaciones.html#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Class :character   Class :character   Class1:hms        Class :character   Class :character  </span></span>
<span id="cb57-12"><a href="aplicaciones.html#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Mode  :character   Mode  :character   Class2:difftime   Mode  :character   Mode  :character  </span></span>
<span id="cb57-13"><a href="aplicaciones.html#cb57-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                        Mode  :numeric                                         </span></span>
<span id="cb57-14"><a href="aplicaciones.html#cb57-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                                                                               </span></span>
<span id="cb57-15"><a href="aplicaciones.html#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                                                                                               </span></span>
<span id="cb57-16"><a href="aplicaciones.html#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       year          month             week            day           week_day    </span></span>
<span id="cb57-17"><a href="aplicaciones.html#cb57-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Min.   :2010   Min.   : 1.000   Min.   : 1.00   Min.   :  1.0   Min.   :1.000  </span></span>
<span id="cb57-18"><a href="aplicaciones.html#cb57-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1st Qu.:2013   1st Qu.: 4.000   1st Qu.:14.00   1st Qu.: 96.0   1st Qu.:3.000  </span></span>
<span id="cb57-19"><a href="aplicaciones.html#cb57-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Median :2016   Median : 7.000   Median :27.00   Median :187.0   Median :5.000  </span></span>
<span id="cb57-20"><a href="aplicaciones.html#cb57-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Mean   :2015   Mean   : 6.537   Mean   :26.65   Mean   :183.6   Mean   :4.323  </span></span>
<span id="cb57-21"><a href="aplicaciones.html#cb57-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:2018   3rd Qu.: 9.000   3rd Qu.:38.00   3rd Qu.:266.0   3rd Qu.:6.000  </span></span>
<span id="cb57-22"><a href="aplicaciones.html#cb57-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Max.   :2020   Max.   :12.000   Max.   :53.00   Max.   :366.0   Max.   :7.000  </span></span>
<span id="cb57-23"><a href="aplicaciones.html#cb57-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  week_day_name        crime_hour      crime_lon         crime_lat        atm_dist       </span></span>
<span id="cb57-24"><a href="aplicaciones.html#cb57-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Length:90247       Min.   : 0.00   Min.   :-0.4296   Min.   :39.42   Min.   :   1.549  </span></span>
<span id="cb57-25"><a href="aplicaciones.html#cb57-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Class :character   1st Qu.: 5.00   1st Qu.:-0.3883   1st Qu.:39.46   1st Qu.: 380.535  </span></span>
<span id="cb57-26"><a href="aplicaciones.html#cb57-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Mode  :character   Median :14.00   Median :-0.3749   Median :39.47   Median : 630.867  </span></span>
<span id="cb57-27"><a href="aplicaciones.html#cb57-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                     Mean   :12.52   Mean   :-0.3724   Mean   :39.47   Mean   : 790.228  </span></span>
<span id="cb57-28"><a href="aplicaciones.html#cb57-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                     3rd Qu.:19.00   3rd Qu.:-0.3593   3rd Qu.:39.48   3rd Qu.: 986.897  </span></span>
<span id="cb57-29"><a href="aplicaciones.html#cb57-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                     Max.   :23.00   Max.   :-0.3208   Max.   :39.53   Max.   :4838.847  </span></span>
<span id="cb57-30"><a href="aplicaciones.html#cb57-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    bank_dist           bar_dist          cafe_dist        industrial_dist   market_dist      </span></span>
<span id="cb57-31"><a href="aplicaciones.html#cb57-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Min.   :   1.713   Min.   :   0.489   Min.   :   1.342   Min.   :   0.1   Min.   :   1.821  </span></span>
<span id="cb57-32"><a href="aplicaciones.html#cb57-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1st Qu.: 133.908   1st Qu.: 149.879   1st Qu.: 133.274   1st Qu.: 268.4   1st Qu.: 487.874  </span></span>
<span id="cb57-33"><a href="aplicaciones.html#cb57-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Median : 228.003   Median : 292.246   Median : 264.504   Median : 509.6   Median : 869.516  </span></span>
<span id="cb57-34"><a href="aplicaciones.html#cb57-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Mean   : 305.315   Mean   : 392.072   Mean   : 360.275   Mean   : 675.2   Mean   :1008.414  </span></span>
<span id="cb57-35"><a href="aplicaciones.html#cb57-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.: 384.706   3rd Qu.: 507.701   3rd Qu.: 462.982   3rd Qu.: 909.9   3rd Qu.:1263.405  </span></span>
<span id="cb57-36"><a href="aplicaciones.html#cb57-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Max.   :3411.537   Max.   :4352.380   Max.   :4237.915   Max.   :4703.9   Max.   :4855.407  </span></span>
<span id="cb57-37"><a href="aplicaciones.html#cb57-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  nightclub_dist      police_dist          pub_dist        restaurant_dist      taxi_dist       </span></span>
<span id="cb57-38"><a href="aplicaciones.html#cb57-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Min.   :   1.189   Min.   :   0.688   Min.   :   1.489   Min.   :   0.427   Min.   :   2.441  </span></span>
<span id="cb57-39"><a href="aplicaciones.html#cb57-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1st Qu.: 468.164   1st Qu.: 455.810   1st Qu.: 190.150   1st Qu.:  73.401   1st Qu.: 393.438  </span></span>
<span id="cb57-40"><a href="aplicaciones.html#cb57-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Median : 810.185   Median : 706.094   Median : 383.330   Median : 147.797   Median : 651.644  </span></span>
<span id="cb57-41"><a href="aplicaciones.html#cb57-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Mean   : 930.501   Mean   : 875.246   Mean   : 496.472   Mean   : 223.875   Mean   : 717.381  </span></span>
<span id="cb57-42"><a href="aplicaciones.html#cb57-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:1256.269   3rd Qu.:1105.625   3rd Qu.: 665.599   3rd Qu.: 272.288   3rd Qu.: 931.083  </span></span>
<span id="cb57-43"><a href="aplicaciones.html#cb57-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Max.   :4700.567   Max.   :4765.745   Max.   :4168.869   Max.   :3746.536   Max.   :4284.239  </span></span>
<span id="cb57-44"><a href="aplicaciones.html#cb57-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     grid_id         grid_lon          grid_lat    </span></span>
<span id="cb57-45"><a href="aplicaciones.html#cb57-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Min.   :  8.0   Min.   :-0.4288   Min.   :39.42  </span></span>
<span id="cb57-46"><a href="aplicaciones.html#cb57-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  1st Qu.:173.0   1st Qu.:-0.3898   1st Qu.:39.46  </span></span>
<span id="cb57-47"><a href="aplicaciones.html#cb57-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Median :215.0   Median :-0.3731   Median :39.47  </span></span>
<span id="cb57-48"><a href="aplicaciones.html#cb57-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Mean   :210.8   Mean   :-0.3724   Mean   :39.47  </span></span>
<span id="cb57-49"><a href="aplicaciones.html#cb57-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  3rd Qu.:248.0   3rd Qu.:-0.3620   3rd Qu.:39.48  </span></span>
<span id="cb57-50"><a href="aplicaciones.html#cb57-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;  Max.   :398.0   Max.   :-0.3230   Max.   :39.53</span></span></code></pre></div>
<p><strong>Q1: ¿Qué información contiene nuestros datos?</strong></p>
<p>Este archivo contiene en total
90.247 registros, y
proporciona 28 campos asociados a cada registro.</p>
<p>Entre los campos disponibles, destacamos los campos <code>crime_lon</code> y <code>crime_lat</code>:
Son las coordenadas en las que se produjo el crimen.</p>
<p><strong>Q2: ¿En qué CRS se encuentran las coordenadas?</strong></p>
<p>Si nos fijamos, las coordenadas parecen corresponder con longitudes y latitudes,
ya que como se explicó el rango posible de valores es <span class="math inline">\([-180, 180]\)</span> (para
longitudes) y <span class="math inline">\([-90, 90]\)</span> (para latitudes):</p>
<table>
<caption><span id="tab:coods-lonlat">Tabla 5.2: </span>Crímenes en Valencia; Coordenadas</caption>
<thead>
<tr class="header">
<th align="right">crime_lon</th>
<th align="right">crime_lat</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">-0.3826325</td>
<td align="right">39.46332</td>
</tr>
<tr class="even">
<td align="right">-0.3906850</td>
<td align="right">39.43517</td>
</tr>
<tr class="odd">
<td align="right">-0.3747971</td>
<td align="right">39.47927</td>
</tr>
<tr class="even">
<td align="right">-0.3992082</td>
<td align="right">39.47982</td>
</tr>
<tr class="odd">
<td align="right">-0.3596011</td>
<td align="right">39.46740</td>
</tr>
<tr class="even">
<td align="right">-0.3552423</td>
<td align="right">39.47461</td>
</tr>
</tbody>
</table>
<p>Por lo tanto, podemos convertir la tabla en un objecto <code>sf</code> teniendo en cuenta
esta información. A modo de recordatorio, el CRS correspondiente a coordenadas
geográficas longitud/latitud es <strong>EPSG:4326</strong>.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="aplicaciones.html#cb58-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-2"><a href="aplicaciones.html#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb58-3"><a href="aplicaciones.html#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Objeto sf sin CRS</span></span>
<span id="cb58-4"><a href="aplicaciones.html#cb58-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-5"><a href="aplicaciones.html#cb58-5" aria-hidden="true" tabindex="-1"></a>crimen_sf <span class="ot">&lt;-</span> <span class="fu">st_as_sf</span>(</span>
<span id="cb58-6"><a href="aplicaciones.html#cb58-6" aria-hidden="true" tabindex="-1"></a>  crimen,</span>
<span id="cb58-7"><a href="aplicaciones.html#cb58-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">coords =</span> <span class="fu">c</span>(</span>
<span id="cb58-8"><a href="aplicaciones.html#cb58-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;crime_lon&quot;</span>,</span>
<span id="cb58-9"><a href="aplicaciones.html#cb58-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;crime_lat&quot;</span></span>
<span id="cb58-10"><a href="aplicaciones.html#cb58-10" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb58-11"><a href="aplicaciones.html#cb58-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">crs =</span> <span class="fu">st_crs</span>(<span class="dv">4326</span>)</span>
<span id="cb58-12"><a href="aplicaciones.html#cb58-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-13"><a href="aplicaciones.html#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="aplicaciones.html#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Comprobamos con un mapa base</span></span>
<span id="cb58-15"><a href="aplicaciones.html#cb58-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-16"><a href="aplicaciones.html#cb58-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapSpain)</span>
<span id="cb58-17"><a href="aplicaciones.html#cb58-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb58-18"><a href="aplicaciones.html#cb58-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-19"><a href="aplicaciones.html#cb58-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Usamos imagen como mapa de fondo</span></span>
<span id="cb58-20"><a href="aplicaciones.html#cb58-20" aria-hidden="true" tabindex="-1"></a>tile <span class="ot">&lt;-</span> <span class="fu">esp_getTiles</span>(crimen_sf, <span class="st">&quot;IDErioja&quot;</span>,</span>
<span id="cb58-21"><a href="aplicaciones.html#cb58-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">zoommin =</span> <span class="dv">1</span>,</span>
<span id="cb58-22"><a href="aplicaciones.html#cb58-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">crop =</span> <span class="cn">TRUE</span></span>
<span id="cb58-23"><a href="aplicaciones.html#cb58-23" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb58-24"><a href="aplicaciones.html#cb58-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-25"><a href="aplicaciones.html#cb58-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb58-26"><a href="aplicaciones.html#cb58-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_spatraster</span>(tile) <span class="sc">+</span></span>
<span id="cb58-27"><a href="aplicaciones.html#cb58-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb58-28"><a href="aplicaciones.html#cb58-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> crimen_sf,</span>
<span id="cb58-29"><a href="aplicaciones.html#cb58-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb58-30"><a href="aplicaciones.html#cb58-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.3</span>,</span>
<span id="cb58-31"><a href="aplicaciones.html#cb58-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.3</span></span>
<span id="cb58-32"><a href="aplicaciones.html#cb58-32" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:crimen1"></span>
<img src="_main_files/figure-html/crimen1-1.png" alt="Crímenes en Valencia" width="60%" />
<p class="caption">
Figura 5.13: Crímenes en Valencia
</p>
</div>
<p><strong>Q3: ¿Hay algún patrón en la ocurrencia de crímenes?</strong></p>
<p>En la Fig. <a href="aplicaciones.html#fig:crimen1">5.13</a> podemos intuir ciertos patrones en la ocurrencia
de crímenes. Por ejemplo, parecen concentrarse en zonas céntricas y no hay
crímenes registrados en la zona del puerto.</p>
<p>Para el siguiente análisis, vamos a analizar el patrón de crímenes del año 2010.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="aplicaciones.html#cb59-1" aria-hidden="true" tabindex="-1"></a>crimen_2010_sf <span class="ot">&lt;-</span> crimen_sf <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="aplicaciones.html#cb59-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(</span>
<span id="cb59-3"><a href="aplicaciones.html#cb59-3" aria-hidden="true" tabindex="-1"></a>    year <span class="sc">==</span> <span class="st">&quot;2010&quot;</span></span>
<span id="cb59-4"><a href="aplicaciones.html#cb59-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb59-5"><a href="aplicaciones.html#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="aplicaciones.html#cb59-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb59-7"><a href="aplicaciones.html#cb59-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layer_spatraster</span>(tile) <span class="sc">+</span></span>
<span id="cb59-8"><a href="aplicaciones.html#cb59-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(</span>
<span id="cb59-9"><a href="aplicaciones.html#cb59-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> crimen_2010_sf,</span>
<span id="cb59-10"><a href="aplicaciones.html#cb59-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb59-11"><a href="aplicaciones.html#cb59-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">0.3</span>,</span>
<span id="cb59-12"><a href="aplicaciones.html#cb59-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.3</span></span>
<span id="cb59-13"><a href="aplicaciones.html#cb59-13" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:crimen2"></span>
<img src="_main_files/figure-html/crimen2-1.png" alt="Crímenes en Valencia (2010)" width="60%" />
<p class="caption">
Figura 5.14: Crímenes en Valencia (2010)
</p>
</div>
<p><em>Tarea 3: Análisis de patrones con <code>spatstat</code></em></p>
<p>El paquete <code>spatstat</code> (<span class="citation"><a href="#ref-spatstat_2005" role="doc-biblioref">Baddeley &amp; Turner</a> (<a href="#ref-spatstat_2005" role="doc-biblioref">2005</a>)</span>) es el paquete de referencia cuando se
trabaja con patrones de puntos</p>
<p>Siguiendo el anterior ejemplo, vamos a analizar el patrón de crímenes en el año
2010. Además, en el análisis de patrones de puntos es necesario delimitar la
ventana espacial de observación (owin). En este caso será el municipio de
Valencia.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="aplicaciones.html#cb60-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-2"><a href="aplicaciones.html#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraigo Valencia con mapSpain</span></span>
<span id="cb60-3"><a href="aplicaciones.html#cb60-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-4"><a href="aplicaciones.html#cb60-4" aria-hidden="true" tabindex="-1"></a>valencia <span class="ot">&lt;-</span> <span class="fu">esp_get_munic</span>(<span class="at">munic =</span> <span class="st">&quot;^Valencia$&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-5"><a href="aplicaciones.html#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Necesito proyectar, en este caso usamos ETRS89-UTM huso 30 EPSG:25830</span></span>
<span id="cb60-6"><a href="aplicaciones.html#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">25830</span>)</span>
<span id="cb60-7"><a href="aplicaciones.html#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="aplicaciones.html#cb60-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-9"><a href="aplicaciones.html#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="aplicaciones.html#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(spatstat)</span>
<span id="cb60-11"><a href="aplicaciones.html#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Necesitamos un recinto de observación: owin</span></span>
<span id="cb60-12"><a href="aplicaciones.html#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="aplicaciones.html#cb60-13" aria-hidden="true" tabindex="-1"></a>val_owin <span class="ot">&lt;-</span> <span class="fu">as.owin</span>(valencia)</span>
<span id="cb60-14"><a href="aplicaciones.html#cb60-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-15"><a href="aplicaciones.html#cb60-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Extraemos las coordenadas de los crímenes. Han de estar en el mismo CRS</span></span>
<span id="cb60-16"><a href="aplicaciones.html#cb60-16" aria-hidden="true" tabindex="-1"></a><span class="co"># que el owin</span></span>
<span id="cb60-17"><a href="aplicaciones.html#cb60-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-18"><a href="aplicaciones.html#cb60-18" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> crimen_2010_sf <span class="sc">%&gt;%</span></span>
<span id="cb60-19"><a href="aplicaciones.html#cb60-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">25830</span>) <span class="sc">%&gt;%</span></span>
<span id="cb60-20"><a href="aplicaciones.html#cb60-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_coordinates</span>()</span>
<span id="cb60-21"><a href="aplicaciones.html#cb60-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-22"><a href="aplicaciones.html#cb60-22" aria-hidden="true" tabindex="-1"></a>mydata_ppp <span class="ot">&lt;-</span> <span class="fu">ppp</span>(</span>
<span id="cb60-23"><a href="aplicaciones.html#cb60-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">as.numeric</span>(coords[, <span class="dv">1</span>]),</span>
<span id="cb60-24"><a href="aplicaciones.html#cb60-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">as.numeric</span>(coords[, <span class="dv">2</span>]),</span>
<span id="cb60-25"><a href="aplicaciones.html#cb60-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">window =</span> val_owin</span>
<span id="cb60-26"><a href="aplicaciones.html#cb60-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-27"><a href="aplicaciones.html#cb60-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-28"><a href="aplicaciones.html#cb60-28" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mydata_ppp)</span></code></pre></div>
<p><img src="_main_files/figure-html/objeto_ppp-1.png" width="60%" style="display: block; margin: auto;" /></p>
<p><strong>Q4: ¿Qué información contiene nuestro objeto en formato ppp?</strong></p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="aplicaciones.html#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mydata_ppp)</span>
<span id="cb61-2"><a href="aplicaciones.html#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Planar point pattern:  5332 points</span></span>
<span id="cb61-3"><a href="aplicaciones.html#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Average intensity 3.917619e-05 points per square unit</span></span>
<span id="cb61-4"><a href="aplicaciones.html#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb61-5"><a href="aplicaciones.html#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; *Pattern contains duplicated points*</span></span>
<span id="cb61-6"><a href="aplicaciones.html#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb61-7"><a href="aplicaciones.html#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Coordinates are given to 1 decimal place</span></span>
<span id="cb61-8"><a href="aplicaciones.html#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; i.e. rounded to the nearest multiple of 0.1 units</span></span>
<span id="cb61-9"><a href="aplicaciones.html#cb61-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb61-10"><a href="aplicaciones.html#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Window: polygonal boundary</span></span>
<span id="cb61-11"><a href="aplicaciones.html#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 separate polygons (no holes)</span></span>
<span id="cb61-12"><a href="aplicaciones.html#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;            vertices      area relative.area</span></span>
<span id="cb61-13"><a href="aplicaciones.html#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; polygon 1         4   1977930       0.01450</span></span>
<span id="cb61-14"><a href="aplicaciones.html#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; polygon 2        82 131953000       0.97000</span></span>
<span id="cb61-15"><a href="aplicaciones.html#cb61-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; polygon 3         7    958085       0.00704</span></span>
<span id="cb61-16"><a href="aplicaciones.html#cb61-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; polygon 4         7   1214060       0.00892</span></span>
<span id="cb61-17"><a href="aplicaciones.html#cb61-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; enclosing rectangle: [720573.4, 735116.6] x [4351274, 4382995] units</span></span>
<span id="cb61-18"><a href="aplicaciones.html#cb61-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;                      (14540 x 31720 units)</span></span>
<span id="cb61-19"><a href="aplicaciones.html#cb61-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Window area = 136103000 square units</span></span>
<span id="cb61-20"><a href="aplicaciones.html#cb61-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Fraction of frame area: 0.295</span></span>
<span id="cb61-21"><a href="aplicaciones.html#cb61-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb61-22"><a href="aplicaciones.html#cb61-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; *** 6 illegal points stored in attr(,&quot;rejects&quot;) ***</span></span></code></pre></div>
<p><em>Tarea 4: Cálculo de la densidad mediante cuadrantes.</em></p>
<p>Es importante determinar si los puntos se distribuyen al azar o tienen algún
patrón. Por ello, lo primero que haremos será representar el objeto <code>feb_ppp</code> y
superponer unos cuadrantes para su comportamiento (véase Fig.
<a href="aplicaciones.html#fig:cuadrante">5.15</a>).</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="aplicaciones.html#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Hallamos los cuadrantes</span></span>
<span id="cb62-2"><a href="aplicaciones.html#cb62-2" aria-hidden="true" tabindex="-1"></a>cuadrante <span class="ot">&lt;-</span> <span class="fu">quadratcount</span>(mydata_ppp,</span>
<span id="cb62-3"><a href="aplicaciones.html#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">nx =</span> <span class="dv">5</span>,</span>
<span id="cb62-4"><a href="aplicaciones.html#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">ny =</span> <span class="dv">5</span></span>
<span id="cb62-5"><a href="aplicaciones.html#cb62-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb62-6"><a href="aplicaciones.html#cb62-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-7"><a href="aplicaciones.html#cb62-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Dibujamos el número de crímenes que hay en cada cuadrante</span></span>
<span id="cb62-8"><a href="aplicaciones.html#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mydata_ppp, <span class="at">pch =</span> <span class="dv">1</span>, <span class="at">main =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb62-9"><a href="aplicaciones.html#cb62-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cuadrante, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">cex =</span> <span class="fl">1.2</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:cuadrante"></span>
<img src="_main_files/figure-html/cuadrante-1.png" alt="Crímenes en Valencia por cuadrantes (2010)" width="60%" />
<p class="caption">
Figura 5.15: Crímenes en Valencia por cuadrantes (2010)
</p>
</div>
<p>Como se puede apreciar en la Fig. <a href="aplicaciones.html#fig:cuadrante">5.15</a> hay cuadrantes que
registran cero crímenes y otros que registran hasta 2.860 crímenes.</p>
<p><em>Tarea 5: Estimación de la densidad de patrones de puntos.</em></p>
<p>En la Fig. <a href="aplicaciones.html#fig:intensidad-ripley">5.16</a> se muestra la gráfica de la estimación
usando la K de Ripley. Los conocimientos teóricos necesarios para llevar a cabo
este tipo de estimación se verán en el tema <strong>Patrones de Puntos</strong>. El objetivo
de este ejemplo es meramente ilustrativo.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="aplicaciones.html#cb63-1" aria-hidden="true" tabindex="-1"></a>densidad <span class="ot">&lt;-</span> <span class="fu">density</span>(mydata_ppp)</span>
<span id="cb63-2"><a href="aplicaciones.html#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(densidad, <span class="at">main =</span> <span class="st">&quot; &quot;</span>)</span>
<span id="cb63-3"><a href="aplicaciones.html#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(mydata_ppp, <span class="at">pch =</span> <span class="st">&quot;+&quot;</span>, <span class="at">cex =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:intensidad-ripley"></span>
<img src="_main_files/figure-html/intensidad-ripley-1.png" alt="Intensidad de crímenes estimada con la K-Ripley" width="60%" />
<p class="caption">
Figura 5.16: Intensidad de crímenes estimada con la K-Ripley
</p>
</div>

</div>
</div>
<h3>References</h3>
<div id="refs" class="references csl-bib-body hanging-indent" line-spacing="2">
<div id="ref-spatstat_2005" class="csl-entry">
Baddeley, A., &amp; Turner, R. (2005). <span class="nocase">spatstat</span>: An <span>R</span> package for analyzing spatial point patterns. <em>Journal of Statistical Software</em>, <em>12</em>(6), 1–42. <a href="https://doi.org/10.18637/jss.v012.i06">https://doi.org/10.18637/jss.v012.i06</a>
</div>
<div id="ref-R-climaemet" class="csl-entry">
Pizarro, M., Hernangómez, D., &amp; Fernández-Avilés, G. (2021). <em>Climaemet: Climate AEMET tools</em>. <a href="https://doi.org/10.5281/zenodo.5205573">https://doi.org/10.5281/zenodo.5205573</a>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>Las fechas seleccionadas coinciden con el periodo en el que
la tormenta Filomena tuvo su auge en la Península Ibérica.<a href="aplicaciones.html#fnref1" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="estadística-espacial.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="referencias.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf"],
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "section",
"scroll_highlight": true
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
